openapi: 3.0.0
info:
  title: Drybros Backend API
  version: 0.0.1
  description: API documentation for Drybros backend

servers:
  - url: http://localhost:4000

paths:

  /health:
    get:
      summary: Health check
      responses:
        "200":
          description: API health status

  /version:
    get:
      summary: Version info
      responses:
        "200":
          description: App version info


  /roles:
    get:
      summary: List all roles
      tags:
        - Roles
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of roles
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Role"
        "401":
          description: Not authenticated (missing or invalid token)
    post:
      summary: Create a new role
      tags:
        - Roles
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateRoleRequest"
      responses:
        "201":
          description: Role created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoleResponse"
        "400":
          description: Bad request (e.g., role name already exists)
        "401":
          description: Not authenticated (missing or invalid token)

  /roles/{id}:
    get:
      summary: Get role by ID
      tags:
        - Roles
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            pattern: "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
      responses:
        "200":
          description: Role data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoleResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Role not found
    put:
      summary: Update a role
      tags:
        - Roles
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            pattern: "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateRoleRequest"
      responses:
        "200":
          description: Role updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoleResponse"
        "400":
          description: Bad request (e.g., role name already exists)
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Role not found
    delete:
      summary: Delete a role
      tags:
        - Roles
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            pattern: "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
      responses:
        "204":
          description: Role deleted successfully
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Role not found

# AUTH
  /auth/register-admin:
    post:
      summary: Register a new admin user
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterAdminRequest"
      responses:
        "201":
          description: Admin registered successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegisterAdminResponse"
        "400":
          description: Bad request (validation error)
        "409":
          description: Email already in use

  /auth/login:
    post:
      summary: Login user
      description: |
        Authenticates a user and returns access and refresh tokens.
        
        **Rate Limiting & Account Lockout:**
        The system implements escalating account lockout to prevent brute-force attacks:
        - After **5 incorrect password attempts**, the account is locked for **5 minutes**
        - After the lockout expires, if **2 more incorrect attempts** occur, the account is locked for **10 minutes**
        - Each subsequent threshold (every 2 more incorrect attempts) doubles the lockout duration
        - Maximum lockout duration is capped at **30 minutes**
        - Failed attempts counter resets to 0 on successful login
        
        **Lockout Behavior:**
        - If an account is locked, login attempts will return a 429 error with the remaining lockout time
        - The lockout check happens before password verification
        - Successful login automatically resets the failed attempts counter and unlocks the account
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          description: Invalid credentials (incorrect email or password)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "429":
          description: Account temporarily locked due to multiple failed login attempts
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "Account is temporarily locked due to multiple failed login attempts. Please try again in 5 minute(s)."

  /auth/forgot-password:
    post:
      summary: Request password reset
      description: Sends a password reset link to the user's email address. Returns an error if the email does not exist in the system or if the account is inactive.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ForgotPasswordRequest"
      responses:
        "200":
          description: Password reset email sent successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ForgotPasswordResponse"
        "400":
          description: Bad request (validation error or account is inactive)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Email address not found in the system
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /auth/reset-password:
    post:
      summary: Reset password with token
      description: Resets the user's password using the token received via email. Token expiration is configurable (default: 1 hour).
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResetPasswordRequest"
      responses:
        "200":
          description: Password reset successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResetPasswordResponse"
        "400":
          description: Bad request (invalid or expired token, validation error)

  /auth/refresh-token:
    post:
      summary: Refresh access token
      description: |
        Generates a new access token and refresh token using a valid refresh token. Refresh token expires in 8 hours.

        This endpoint supports refresh tokens for:
        - **Users** (ADMIN / MANAGER / OFFICE_STAFF / STAFF) → returns `AuthResponse`
        - **Drivers** → returns `AuthResponse` with `user.role = "DRIVER"` (driver tokens are refreshed too)
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshTokenRequest"
      responses:
        "200":
          description: Tokens refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    oneOf:
                      - $ref: "#/components/schemas/AuthResponse"
                      - $ref: "#/components/schemas/DriverLoginResponse"
        "400":
          description: Bad request (invalid or expired refresh token, validation error)

  /auth/logout:
    post:
      summary: Logout user
      description: |
        Logs out the current authenticated account (User or Driver).
        Since we use stateless JWT tokens, logout is primarily client-side (token removal). The server confirms the logout action.
      tags:
        - Authentication
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Logged out successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LogoutResponse"
        "401":
          description: Not authenticated (missing or invalid token)

  /auth/me:
    get:
      summary: Get current user information
      description: Returns the current authenticated user's information based on the JWT token.
      tags:
        - Authentication
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Current user information
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CurrentUserResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: User not found
        "400":
          description: User account is inactive

  /auth/change-password:
    post:
      summary: Change password
      description: |
        Change password for the authenticated user. Requires previous password verification.
        
        **Security:**
        - User can only change their own password (id must match authenticated user)
        - Previous password must be verified
        - New password must be at least 8 characters
        - Supports User (ADMIN, MANAGER), Staff, and Driver roles
        
        **Note:** This endpoint is for authenticated users to change their password from the profile section.
      tags:
        - Authentication
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangePasswordRequest"
            example:
              id: "550e8400-e29b-41d4-a716-446655440000"
              previousPassword: "oldPassword123"
              newPassword: "newSecurePassword123"
      responses:
        "200":
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password changed successfully"
        "400":
          description: Bad request (validation error, previous password incorrect, or id mismatch)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: User/Staff/Driver not found

# FRANCHISES

  /franchises:
    get:
      summary: List all franchises (with optional pagination)
      description: |
        Get a list of all franchises. Supports optional pagination via query parameters.
        
        **Query Parameters:**
        - `page` (optional): Page number (default: 1)
        - `limit` (optional): Number of items per page (default: 10, max: 100)
        
        **Without pagination parameters:** Returns all franchises (backward compatible)
        
        **With pagination parameters:** Returns paginated results with metadata
      tags:
        - Franchises
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          description: Page number (default: 1)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          description: Number of items per page (default: 10, max: 100)
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        "200":
          description: List of franchises (paginated or all)
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    description: Paginated response (when page/limit provided)
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Franchise"
                      pagination:
                        $ref: "#/components/schemas/PaginationMeta"
                  - type: object
                    description: All franchises (when no pagination params)
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Franchise"
              examples:
                paginated:
                  summary: Paginated response
                  value:
                    data:
                      - id: "550e8400-e29b-41d4-a716-446655440000"
                        code: "FRN-A1B2C3"
                        name: "Downtown Branch"
                        status: "ACTIVE"
                    pagination:
                      page: 1
                      limit: 10
                      total: 25
                      totalPages: 3
                      hasNext: true
                      hasPrev: false
                all:
                  summary: All franchises (no pagination)
                  value:
                    data:
                      - id: "550e8400-e29b-41d4-a716-446655440000"
                        code: "FRN-A1B2C3"
                        name: "Downtown Branch"
        "400":
          description: Bad request - invalid pagination parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
    post:
      summary: Create a new franchise
      description: |
        Create a new franchise. Only ADMIN role can create franchises.
        
        **Auto-Generated Fields:**
        - `code`: Automatically generated in format FRN-XXXXXX (6 random alphanumeric characters)
        - `id`: Auto-generated UUID
        - `isActive`: Defaults to `true`
        
        **Fields:**
        - `name`: Franchise name (required)
        - `region`: Region where franchise is located (required)
        - `address`: Physical address of the franchise (required)
        - `phone`: Contact number (required, validated format)
        - `inchargeName`: Name of the person in charge (required)
        - `managerEmail`: Email address of the manager (required, will be used to create manager user account)
        - `managerPhone`: Phone number of the manager (required, validated format)
        - `storeImage`: Store image URL (optional)
        
        **Manager Account Creation:**
        - A manager user account will be automatically created with MANAGER role
        - Password will be auto-generated and sent to the manager's email
        - Welcome email will be sent with login credentials
      tags:
        - Franchises
      security:
        - bearerAuth: []
      x-roles: ["ADMIN"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateFranchiseRequest"
            example:
              name: "Downtown Branch"
              region: "New York"
              address: "123 Main Street, New York, NY 10001"
              phone: "+1234567890"
              franchiseEmail: "contact.downtown@drybros.com"
              inchargeName: "John Smith"
              managerEmail: "john.smith@drybros.com"
              managerPhone: "+1234567891"
              storeImage: "https://example.com/images/store.jpg"
              legalDocumentsCollected: false
      responses:
        "201":
          description: Franchise created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateFranchiseResponse"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions (only ADMIN can create franchises)

  /franchises/{id}:
    get:
      summary: Get franchise by ID
      tags:
        - Franchises
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Franchise ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Franchise data retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Franchise"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Franchise not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      summary: Update franchise details
      description: |
        Update franchise details. Only ADMIN and MANAGER roles can update franchises.
        
        All fields are optional - only provide the fields you want to update.
      tags:
        - Franchises
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Franchise ID (UUID)
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateFranchiseRequest"
            example:
              name: "Updated Downtown Branch"
              region: "New York City"
              address: "456 Updated Street, New York, NY 10002"
              phone: "+1234567891"
              inchargeName: "Jane Doe"
              storeImage: "https://example.com/images/store-updated.jpg"
              legalDocumentsCollected: true
      responses:
        "200":
          description: Franchise updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateFranchiseResponse"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions
        "404":
          description: Franchise not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      summary: Soft delete franchise
      description: |
        Soft delete a franchise by setting isActive to false. Only ADMIN role can delete franchises.
        
        This operation does not permanently delete the franchise from the database.
      tags:
        - Franchises
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Franchise ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Franchise deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Franchise deleted successfully"
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions (only ADMIN can delete)
        "404":
          description: Franchise not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /franchises/{id}/status:
    patch:
      summary: Update franchise status
      description: |
        Update franchise status. Only ADMIN role can update franchise status.
        
        **Available Statuses:**
        - `ACTIVE`: Franchise is active and operational
        - `BLOCKED`: Franchise is blocked (suspended)
        - `TEMPORARILY_CLOSED`: Franchise is temporarily closed
      tags:
        - Franchises
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Franchise ID (UUID)
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateFranchiseStatusRequest"
            example:
              status: "BLOCKED"
      responses:
        "200":
          description: Franchise status updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateFranchiseResponse"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions (only ADMIN can update status)
        "404":
          description: Franchise not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /franchises/{id}/personnel:
    get:
      summary: Get franchise personnel (staff, drivers, and manager)
      description: |
        Get all staff members, drivers, and manager associated with a specific franchise in a single API call.
        
        Returns:
        - **staff**: All active staff members in the franchise
        - **drivers**: All active drivers in the franchise
        - **manager**: The manager user assigned to this franchise (if exists)
        
        This is a combined endpoint that replaces the separate `/franchises/{id}/staff` and `/franchises/{id}/drivers` endpoints.
      tags:
        - Franchises
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Franchise ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Personnel list retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      staff:
                        type: array
                        items:
                          $ref: "#/components/schemas/PersonnelBasicInfo"
                        description: List of staff members in the franchise (basic info only)
                      drivers:
                        type: array
                        items:
                          $ref: "#/components/schemas/PersonnelBasicInfo"
                        description: List of drivers in the franchise (basic info only)
                      manager:
                        $ref: "#/components/schemas/PersonnelBasicInfo"
                        nullable: true
                        description: Manager user assigned to this franchise (basic info only, null if no manager assigned)
              examples:
                success:
                  summary: Successful response
                  value:
                    data:
                      staff:
                        - id: "550e8400-e29b-41d4-a716-446655440000"
                          name: "John Doe"
                          email: "john.doe@example.com"
                          phone: "+1234567890"
                        - id: "550e8400-e29b-41d4-a716-446655440001"
                          name: "Jane Smith"
                          email: "jane.smith@example.com"
                          phone: "+1234567891"
                      drivers:
                        - id: "770e8400-e29b-41d4-a716-446655440002"
                          name: "Driver Name"
                          email: "driver@example.com"
                          phone: "+1234567891"
                        - id: "770e8400-e29b-41d4-a716-446655440003"
                          name: "Another Driver"
                          email: "driver2@example.com"
                          phone: "+1234567892"
                      manager:
                        id: "880e8400-e29b-41d4-a716-446655440003"
                        name: "Manager Name"
                        email: "manager@example.com"
                        phone: "+1234567892"
        "401":
          description: Unauthorized - missing or invalid token
        "404":
          description: Franchise not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"



  /attendance/monitor:
    get:
      summary: Get attendance monitoring data (dashboard)
      description: |
        Get real-time attendance stats and logs for the current day.
        
        **Access Control:**
        - **Admin**: View All (Drivers, Staff, Managers)
        - **Manager**: View Drivers and Staff
        - **Staff/Office Staff**: View Drivers only
      tags:
        - Attendance
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Attendance monitor data
          content:
            application/json:
              schema:
                type: object
                properties:
                  stats:
                    type: object
                    properties:
                      activeStaffCount:
                        type: integer
                      activeDriverCount:
                        type: integer
                      activeManagerCount:
                        type: integer
                  logs:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        personId:
                          type: string
                          format: uuid
                        name:
                          type: string
                        role:
                          type: string
                        loginTime:
                          type: string
                          format: date-time
                          nullable: true
                        clockInTime:
                          type: string
                          format: date-time
                          nullable: true
                        clockOutTime:
                          type: string
                          format: date-time
                          nullable: true
                        logoutTime:
                          type: string
                          format: date-time
                          nullable: true
                        timeWorked:
                          type: string
                          example: "04:30"
                          nullable: true
                        status:
                          type: string
                          enum: [PRESENT, ABSENT, HALF_DAY, LEAVE]
        "401":
          description: Unauthorized
        "403":
          description: Forbidden

  /attendance/status/{id}:
    get:
      summary: Get attendance status by person ID
      description: Check if a specific person (Driver, Staff, or Manager) is currently clocked in for the day.
      tags:
        - Attendance
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: string
            format: uuid
          required: true
          description: The UUID of the person (Driver ID, Staff ID, or User ID)
      responses:
        "200":
          description: Current attendance status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AttendanceStatus"
        "400":
          description: Invalid ID format
        "401":
          description: Unauthorized




  /staff:
    get:
      summary: List staff members with franchise details
      description: |
        Retrieves a list of staff members with complete details including franchise information. Supports optional pagination and franchise filtering.
        
        **Response includes:**
        - Complete staff member details
        - Franchise information (id, code, name, city, region) for each staff member
        
        **Pagination:**
        - Use `page` query parameter to specify the page number (default: 1)
        - Use `limit` query parameter to specify items per page (default: 10, max: 100)
        - If pagination parameters are not provided, returns all staff members (for backward compatibility)
        
        **Franchise Filtering:**
        - Use `franchiseId` query parameter to filter staff by franchise (optional)
        - If `franchiseId` is not provided, returns staff from all franchises
        
        **Examples:**
        - `/staff` - Get all staff members from all franchises with franchise details (no pagination)
        - `/staff?franchiseId=<uuid>` - Get all staff members for a specific franchise
        - `/staff?page=1&limit=10` - Get first 10 staff members from all franchises
        - `/staff?page=1&limit=10&franchiseId=<uuid>` - Get first 10 staff members for a specific franchise
      tags:
        - Staff
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number (starts from 1)
          example: 1
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Number of items per page (max 100)
          example: 10
        - name: franchiseId
          in: query
          required: false
          description: Filter staff by franchise ID (UUID). If not provided, returns staff from all franchises.
          schema:
            type: string
            format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        "200":
          description: List of staff members (paginated or all)
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/PaginatedStaffResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Staff"
              examples:
                paginated:
                  summary: Paginated response (when page/limit provided)
                  value:
                    data:
                      - id: "550e8400-e29b-41d4-a716-446655440000"
                        name: "John Doe"
                        email: "john.doe@example.com"
                        phone: "+1234567890"
                        franchiseId: "660e8400-e29b-41d4-a716-446655440001"
                        monthlySalary: 50000
                        status: "ACTIVE"
                        isActive: true
                        franchise:
                          id: "660e8400-e29b-41d4-a716-446655440001"
                          code: "FRN-XXXXXX"
                          name: "DryBros Mumbai Central"
                          city: "Mumbai"
                          region: "Mumbai"
                    pagination:
                      page: 1
                      limit: 10
                      total: 50
                      totalPages: 5
                      hasNext: true
                      hasPrev: false
                all_staff:
                  summary: All staff response (when no pagination)
                  value:
                    data:
                      - id: "550e8400-e29b-41d4-a716-446655440000"
                        name: "John Doe"
                        email: "john.doe@example.com"
                        phone: "+1234567890"
                        franchiseId: "660e8400-e29b-41d4-a716-446655440001"
                        monthlySalary: 50000
                        status: "ACTIVE"
                        isActive: true
                        franchise:
                          id: "660e8400-e29b-41d4-a716-446655440001"
                          code: "FRN-XXXXXX"
                          name: "DryBros Mumbai Central"
                          city: "Mumbai"
                          region: "Mumbai"
                      - id: "550e8400-e29b-41d4-a716-446655440001"
                        name: "Jane Smith"
                        email: "jane.smith@example.com"
                        phone: "+1234567891"
                        franchiseId: "660e8400-e29b-41d4-a716-446655440001"
                        monthlySalary: 55000
                        status: "ACTIVE"
                        isActive: true
                        franchise:
                          id: "660e8400-e29b-41d4-a716-446655440001"
                          code: "FRN-XXXXXX"
                          name: "DryBros Mumbai Central"
                          city: "Mumbai"
                          region: "Mumbai"
        "400":
          description: Bad request (invalid pagination parameters or invalid franchiseId format)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid query parameters: page must be a positive integer, limit must be between 1 and 100"
        "401":
          description: Not authenticated (missing or invalid token)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Unauthorized - Invalid or missing authentication token"
    post:
      summary: Create a new staff member
      description: |
        Creates a new staff member and sends a welcome email with login credentials (email and password).
        The email will be sent to the provided email address.
      tags:
        - Staff
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateStaffRequest"
      responses:
        "201":
          description: Staff member created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateStaffResponse"
        "400":
          description: Bad request (validation error)
        "401":
          description: Not authenticated (missing or invalid token)
        "409":
          description: Email or phone number already in use

  /staff/{id}:
    get:
      summary: Get staff member by ID
      tags:
        - Staff
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Staff member data
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Staff"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Staff member not found
    patch:
      summary: Update staff member
      description: |
        Updates a staff member's information. Allows updating any field including reassigning to a different franchise.
        Only provided fields will be updated.
      tags:
        - Staff
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateStaffRequest"
      responses:
        "200":
          description: Staff member updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StaffStatusResponse"
        "400":
          description: Bad request (validation error)
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Staff member not found
        "409":
          description: Email or phone number already in use
    delete:
      summary: Delete staff member
      description: |
        Permanently deletes a staff member from the system. This action is logged in the staff history.
        The staff history records are preserved even after deletion.
      tags:
        - Staff
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Staff member deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Staff member deleted successfully"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Staff member not found

  /staff/{id}/status:
    patch:
      summary: Update staff status
      description: |
        Updates a staff member's status. Can be used to fire, suspend, block, or reactivate a staff member.
        
        **Status Options:**
        - `FIRED` - Terminates the staff member
        - `SUSPENDED` - Suspends the staff member (optionally with an end date)
        - `BLOCKED` - Blocks the staff member from accessing the system
        - `ACTIVE` - Reactivates a previously suspended/blocked/fired staff member
        
        **Note:** When status is `SUSPENDED`, you can optionally provide `suspendedUntil` to set an end date.
        If not provided, the suspension is indefinite.
      tags:
        - Staff
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateStaffStatusRequest"
      responses:
        "200":
          description: Staff status updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StaffStatusResponse"
        "400":
          description: Bad request (validation error or invalid status combination)
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Staff member not found

  /staff/{id}/history:
    get:
      summary: Get staff history
      description: |
        Retrieves the complete activity history for a staff member. This includes all actions like:
        - CREATED - When the staff member was created
        - UPDATED - When any field was updated
        - DELETED - When the staff member was deleted
        - STATUS_CHANGED - When the status was changed
        
        Each history entry includes the action, description, who made the change, and the old/new values.
      tags:
        - Staff
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Staff history retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StaffHistoryResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Staff member not found

  /drivers/login:
    post:
      summary: Driver login (Mobile App)
      description: |
        Login endpoint for drivers using their driver code and password.
        Returns access token and refresh token for authentication.
        
        **Note:** This endpoint is public and does not require authentication.
      tags:
        - Drivers
        - Authentication
      security: []  # Public endpoint, no authentication required
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DriverLoginRequest"
            example:
              driverCode: "DRV-3ZSQIA"
              password: "SecurePass123!"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/DriverLoginResponse"
        "400":
          description: Bad request - invalid credentials or validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "Invalid credentials"

  /drivers/me/location:
    post:
      summary: Update my live location (Driver)
      description: |
        Updates the authenticated driver's current GPS location.
        
        **Authentication:**
        - Requires driver authentication token (from `/drivers/login`)
        
        **Use Cases:**
        - Driver mobile app periodically posts location while clocked-in/on-duty
        - Dispatch/assignment logic uses this for nearest-driver selection
      tags:
        - Drivers
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DriverLocationUpdateRequest"
            example:
              lat: 12.9716
              lng: 77.5946
              accuracyM: 18
              capturedAt: "2026-02-01T10:15:30Z"
      responses:
        "200":
          description: Location updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DriverLocationUpdateResponse"
        "401":
          description: Not authenticated or not a driver token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /drivers/me/profile:
    get:
      summary: Get my driver profile (Mobile)
      description: |
        Returns the authenticated driver's profile plus earnings summary for the mobile app.

        Includes:
        - totalEarnings (lifetime)
        - monthlyEarnings (for provided year/month or current month)
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - name: year
          in: query
          required: false
          description: Year (YYYY). Defaults to current year.
          schema:
            type: integer
            minimum: 2000
            maximum: 2100
        - name: month
          in: query
          required: false
          description: Month (1-12). Defaults to current month.
          schema:
            type: integer
            minimum: 1
            maximum: 12
      responses:
        "200":
          description: Driver profile with earnings retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      firstName:
                        type: string
                      lastName:
                        type: string
                      driverCode:
                        type: string
                      phone:
                        type: string
                      email:
                        type: string
                      earnings:
                        type: object
                        properties:
                          totalEarnings:
                            type: integer
                          year:
                            type: integer
                          month:
                            type: integer
                          monthlyEarnings:
                            type: integer
                          tripsCount:
                            type: integer
        "401":
          description: Not authenticated or not a driver token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /drivers/live-location:
    get:
      summary: Get live locations of drivers
      description: |
        Returns current GPS locations of active drivers. Optionally filter by franchiseId.
        
        Only ADMIN, MANAGER, STAFF, and OFFICE_STAFF roles can access this endpoint.
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - name: franchiseId
          in: query
          required: false
          description: Filter by franchise ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Live locations retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/DriverLiveLocation"
              example:
                data:
                  - id: "779a77f6-5704-4b00-8561-2892c58946a2"
                    firstName: "John"
                    lastName: "Doe"
                    phone: "+1234567890"
                    driverCode: "DRV-3ZSQIA"
                    franchiseId: "550e8400-e29b-41d4-a716-446655440000"
                    currentLat: 12.9716
                    currentLng: 77.5946
                    locationUpdatedAt: "2026-02-01T10:15:30Z"
                    driverTripStatus: "AVAILABLE"
        "401":
          description: Not authenticated (missing or invalid token)

  /drivers:
    get:
      summary: List all drivers
      description: |
        Retrieves a list of all drivers in the system. Supports pagination and franchise filtering.
        
        **Pagination:**
        - Use `page` and `limit` query parameters for paginated results
        - Default: `page=1`, `limit=10`
        - Maximum `limit` is 100
        - Only active drivers are returned (soft-deleted drivers are excluded)
        
        **Franchise Filtering:**
        - Use `franchiseId` query parameter to filter drivers by franchise (optional)
        - If provided, only returns drivers belonging to that franchise

        **Employment Type Filtering:**
        - Use `employmentType` query parameter to filter drivers by employment type (optional)
        - Values: `FULL_TIME`, `PART_TIME`, `CONTRACT`
        
        **Examples:**
        - `/drivers?page=1&limit=10` - Get first 10 drivers
        - `/drivers?franchiseId=550e8400-e29b-41d4-a716-446655440000` - Get all drivers for a specific franchise
        - `/drivers?employmentType=FULL_TIME` - Get all full-time drivers
        - `/drivers?page=1&limit=20&franchiseId=550e8400-e29b-41d4-a716-446655440000` - Get paginated drivers for a specific franchise
        
        **Without Pagination:**
        - If no pagination parameters are provided, returns all active drivers
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          description: Page number (default: 1)
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: limit
          in: query
          required: false
          description: Number of items per page (default: 10, max: 100)
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
            example: 10
        - name: franchiseId
          in: query
          required: false
          description: Filter drivers by franchise ID (UUID)
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
        - name: employmentType
          in: query
          required: false
          description: Filter drivers by employment type
          schema:
            type: string
            enum: [FULL_TIME, PART_TIME, CONTRACT]
            example: "FULL_TIME"
      responses:
        "200":
          description: List of drivers retrieved successfully
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    description: Paginated response (when page/limit provided)
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Driver"
                      pagination:
                        $ref: "#/components/schemas/PaginationInfo"
                  - type: object
                    description: Non-paginated response (when no pagination params)
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Driver"
        "400":
          description: Bad request - invalid pagination parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
  
    post:
      summary: Create a new driver
      description: |
        Create a new driver. Only ADMIN and OFFICE_STAFF roles can create drivers.
        
        **Auto-Generated Fields:**
        - `driverCode`: Automatically generated in format DRV-XXXXXX (6 random alphanumeric characters)
        - `currentRating`: Automatically set to 5.0 (5 stars) for new drivers
        - `performanceStatus`: Automatically calculated as GREEN (excellent performance) for new drivers with 5-star rating
        
        **Email Notification:**
        Upon successful creation, a welcome email is automatically sent to the driver's email address containing:
        - Driver code and password for mobile app login
        - Email and password for web portal login
        - Web login link
        
        **Password:**
        The password provided will be used for both app login (with driver code) and web login (with email).
        The password is hashed before storage.
        
        **Default Values:**
        - New drivers start with a 5-star rating (5.0)
        - Performance category is automatically set to GREEN based on the 5-star rating
        - Status is set to ACTIVE by default
        - Driver trip status is set to AVAILABLE by default
      tags:
        - Drivers
      security:
        - bearerAuth: []
      x-roles: ["ADMIN", "OFFICE_STAFF"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDriverRequest"
            example:
              firstName: "Sandeep"
              lastName: "Krishnan"
              phone: "+919845672310"
              email: "tech.team.protons@gmail.com"
              altPhone: "+919845672311"
              password: "ChainReaction@123"
              emergencyContactName: "Meera Krishnan"
              emergencyContactPhone: "+919812345670"
              emergencyContactRelation: "Wife"
              address: "Vyttila, NH Bypass Road"
              city: "Kochi"
              state: "Kerala"
              pincode: "682019"
              licenseNumber: "KL07-2014-0098765"
              licenseExpDate: "2027-08-31T00:00:00Z"
              bankAccountName: "Sandeep Krishnan"
              bankAccountNumber: "456789123456"
              bankIfscCode: "SBIN0000843"
              aadharCard: true
              license: true
              educationCert: false
              previousExp: true
              carTypes: ["MANUAL", "AUTOMATIC"]
              franchiseId: "74ce561e-fa14-47d1-b9b0-e991db4ced48"
      responses:
        "201":
          description: Driver created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateDriverResponse"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Conflict - phone or email already exists
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions (only ADMIN and OFFICE_STAFF can create drivers)
  
  /drivers/available:
    get:
      summary: Get drivers for trip assignment (all franchise drivers)
      description: |
        Returns **all** drivers in the franchise (or all if no franchiseId):
        - **ACTIVE status** – active drivers only
        - **Not globally banned** – not banned from the system
        - Includes both **AVAILABLE** and **ON_TRIP** drivers
        
        **Sort order (who appears first):**
        1. **AVAILABLE** – drivers not on a trip (driverTripStatus = AVAILABLE)
        2. **Day limit not finished** – remainingDailyLimit > 0 or null
        3. **Performance category** – GREEN first, then YELLOW, then RED
        4. **Performance score** – higher score first within same category
        
        **Franchise Filtering:**
        - Use `franchiseId` query parameter to filter drivers by franchise (optional)
        
        **Use Cases:**
        - Assigning trips: show all drivers, best options first (AVAILABLE + good performance + limit not reached)
        - Driver selection for trip assignment workflow
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - name: franchiseId
          in: query
          required: false
          description: Filter drivers by franchise ID (UUID)
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        "200":
          description: List of available drivers retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    description: All drivers, sorted by AVAILABLE first, then day limit not finished, then performance (GREEN > YELLOW > RED), then score
                    items:
                      allOf:
                        - $ref: "#/components/schemas/Driver"
                        - type: object
                          properties:
                            performance:
                              $ref: "#/components/schemas/DriverPerformanceMetrics"
                            remainingDailyLimit:
                              type: number
                              format: decimal
                              description: Remaining daily limit (null if not initialized)
                              example: 750.50
              example:
                data:
                  - id: "550e8400-e29b-41d4-a716-446655440000"
                    firstName: "John"
                    lastName: "Doe"
                    phone: "+1234567890"
                    email: "john.doe@example.com"
                    driverCode: "DRV-ABC123"
                    status: "ACTIVE"
                    driverTripStatus: "AVAILABLE"
                    currentRating: 4.8
                    remainingDailyLimit: 750.50
                    performance:
                      category: "GREEN"
                      score: 85
                      rating: 4.8
                      complaintCount: 0
                      totalTrips: 50
                      completedTrips: 48
                      rejectedTrips: 1
                      completionRate: 96.0
                      rejectionRate: 2.0
        "401":
          description: Not authenticated (missing or invalid token)
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  
  /drivers/available/green:
    get:
      summary: Get available drivers with GREEN performance
      description: |
        Retrieves a list of drivers who are:
        - **AVAILABLE** (driverTripStatus = AVAILABLE) - not currently on a trip
        - **GREEN** performance category - excellent performance
        - **ACTIVE** status - active drivers only
        - **Not globally banned** - not banned from the system
        
        Drivers are sorted by performance score (highest first).
        
        **Franchise Filtering:**
        - Use `franchiseId` query parameter to filter drivers by franchise (optional)
        - If provided, only returns available GREEN drivers belonging to that franchise
        
        **Use Cases:**
        - Assigning trips to the best available drivers
        - Finding top-performing drivers for priority assignments
        - Driver selection for high-value trips
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - name: franchiseId
          in: query
          required: false
          description: Filter drivers by franchise ID (UUID)
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        "200":
          description: List of available GREEN drivers retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    description: Array of available drivers with GREEN performance
                    items:
                      allOf:
                        - $ref: "#/components/schemas/Driver"
                        - type: object
                          properties:
                            performance:
                              $ref: "#/components/schemas/DriverPerformanceMetrics"
              example:
                data:
                  - id: "550e8400-e29b-41d4-a716-446655440000"
                    firstName: "John"
                    lastName: "Doe"
                    phone: "+1234567890"
                    email: "john.doe@example.com"
                    driverCode: "DRV-ABC123"
                    status: "ACTIVE"
                    driverTripStatus: "AVAILABLE"
                    currentRating: 4.8
                    performance:
                      category: "GREEN"
                      score: 85
                      rating: 4.8
                      complaintCount: 0
                      totalTrips: 50
                      completedTrips: 48
                      rejectedTrips: 1
                      completionRate: 96.0
                      rejectionRate: 2.0
        "401":
          description: Not authenticated (missing or invalid token)
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  
  /drivers/{id}:
    get:
      summary: Get driver by ID
      description: |
        Retrieves detailed information about a specific driver by their ID.
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Driver ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Driver data retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Driver"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Driver not found
    patch:
      summary: Update driver
      description: |
        Update driver details. Main purpose is for reassigning franchises, but can also update other driver information.
        
        **Partial Updates:**
        - All fields are optional
        - Only provided fields will be updated
        - At least one field must be provided
        
        **Franchise Reassignment:**
        - Update `franchiseId` to reassign driver to a different franchise
        
        **Password Update:**
        - If password is provided, it will be hashed before storage
        
        **Validation:**
        - Phone and email must be unique (checked against other drivers)
        - License expiration date must be in the future
        - At least one car type must be provided if `carTypes` is updated
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Driver ID (UUID)
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateDriverRequest"
            example:
              franchiseId: "550e8400-e29b-41d4-a716-446655440001"
              firstName: "John"
              lastName: "Smith"
              phone: "+1234567890"
              city: "Los Angeles"
              status: "ACTIVE"
      responses:
        "200":
          description: Driver updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UpdateDriverResponse"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions (only ADMIN and OFFICE_STAFF can update drivers)
        "404":
          description: Driver not found
        "409":
          description: Conflict - phone or email already exists
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /drivers/{id}:
    delete:
      summary: Soft delete driver
      description: |
        Soft delete a driver by setting `isActive` to `false`. 
        
        **Soft Delete:**
        - Driver is not permanently removed from the database
        - `isActive` field is set to `false`
        - Driver data is preserved for audit/history purposes
        - Can be restored by updating `isActive` back to `true`
        
        **Note:** This is a soft delete operation. The driver record remains in the database but is marked as inactive.
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Driver ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Driver soft deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Driver deleted successfully"
        "400":
          description: Bad request - driver already deleted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions (only ADMIN and OFFICE_STAFF can delete drivers)
        "404":
          description: Driver not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /drivers/{id}/status:
    patch:
      summary: Update driver status
      description: |
        Update driver status for suspend, fire, block, or reactivate operations.
        
        **Status Options:**
        - `ACTIVE`: Reactivate driver (default status)
        - `INACTIVE`: Suspend driver (temporarily disable)
        - `BLOCKED`: Block driver (prevent access)
        - `TERMINATED`: Fire/terminate driver (permanent removal)
        
        **Usage Examples:**
        - To suspend: Set status to `INACTIVE`
        - To fire: Set status to `TERMINATED`
        - To block: Set status to `BLOCKED`
        - To reactivate: Set status to `ACTIVE`
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Driver ID (UUID)
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateDriverStatusRequest"
            examples:
              suspend:
                summary: Suspend driver
                value:
                  status: "INACTIVE"
              fire:
                summary: Fire driver
                value:
                  status: "TERMINATED"
              block:
                summary: Block driver
                value:
                  status: "BLOCKED"
              reactivate:
                summary: Reactivate driver
                value:
                  status: "ACTIVE"
      responses:
        "200":
          description: Driver status updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UpdateDriverStatusResponse"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions (only ADMIN and OFFICE_STAFF can update driver status)
        "404":
          description: Driver not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /drivers/{id}/daily-stats:
    get:
      summary: Get daily earnings stats for a driver
      description: |
        Get daily earnings statistics for a driver including target, amount run, trips count, and incentive calculation.
        
        **Query Parameters:**
        - `date` (optional): Date in YYYY-MM-DD format. Defaults to today if not provided.
        
        **Returns:**
        - Daily target amount
        - Amount run today (sum of completed trip finalAmount)
        - Number of trips completed today
        - Daily incentive (calculated based on config)
        - Remaining amount to achieve target
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Driver ID (UUID)
          schema:
            type: string
            format: uuid
        - name: date
          in: query
          required: false
          description: Date in YYYY-MM-DD format (defaults to today)
          schema:
            type: string
            format: date
            example: "2024-01-20"
      responses:
        "200":
          description: Daily stats retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      driverId:
                        type: string
                        format: uuid
                        example: "779a77f6-5704-4b00-8561-2892c58946a2"
                      date:
                        type: string
                        format: date
                        example: "2024-01-20"
                      dailyTargetAmount:
                        type: number
                        description: Daily target amount for the driver
                        example: 1250
                      amountRunToday:
                        type: number
                        description: Total amount earned today from completed trips
                        example: 1500
                      tripsCountToday:
                        type: number
                        description: Number of completed trips today
                        example: 5
                      incentiveToday:
                        type: number
                        description: Calculated daily incentive
                        example: 250
                      incentiveType:
                        type: string
                        nullable: true
                        description: Type of incentive (full_extra or percentage)
                        example: "full_extra"
                      remainingToAchieve:
                        type: number
                        description: Remaining amount to achieve daily target
                        example: 0
              example:
                data:
                  driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
                  date: "2024-01-20"
                  dailyTargetAmount: 1250
                  amountRunToday: 1500
                  tripsCountToday: 5
                  incentiveToday: 250
                  incentiveType: "full_extra"
                  remainingToAchieve: 0
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Driver not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /drivers/{id}/monthly-stats:
    get:
      summary: Get monthly earnings stats for a driver
      description: |
        Get monthly earnings statistics for a driver including earnings, trips count, bonus, and deduction policy cut.
        
        **Query Parameters:**
        - `year` (required): Year (e.g., 2024)
        - `month` (required): Month (1-12)
        
        **Returns:**
        - Monthly earnings (sum of completed trip finalAmount)
        - Number of trips completed in the month
        - Monthly bonus (calculated based on config)
        - Monthly deduction policy cut (calculated based on config)
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Driver ID (UUID)
          schema:
            type: string
            format: uuid
        - name: year
          in: query
          required: true
          description: Year (e.g., 2024)
          schema:
            type: integer
            minimum: 2000
            maximum: 2100
            example: 2024
        - name: month
          in: query
          required: true
          description: Month (1-12)
          schema:
            type: integer
            minimum: 1
            maximum: 12
            example: 1
      responses:
        "200":
          description: Monthly stats retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      driverId:
                        type: string
                        format: uuid
                        example: "779a77f6-5704-4b00-8561-2892c58946a2"
                      year:
                        type: integer
                        example: 2024
                      month:
                        type: integer
                        example: 1
                      monthlyEarnings:
                        type: number
                        description: Total earnings for the month
                        example: 28000
                      tripsCount:
                        type: number
                        description: Number of completed trips in the month
                        example: 45
                      monthlyBonus:
                        type: number
                        description: Calculated monthly bonus
                        example: 500
                      bonusTier:
                        type: object
                        nullable: true
                        description: Bonus tier applied
                        properties:
                          minEarnings:
                            type: number
                            example: 28000
                          bonus:
                            type: number
                            example: 500
                      monthlyDeductionPolicyCut:
                        type: number
                        description: Deduction policy cut amount
                        example: 0
                      deductionTier:
                        type: object
                        nullable: true
                        description: Deduction tier applied
                        properties:
                          maxEarnings:
                            type: number
                            example: 26000
                          cutPercent:
                            type: number
                            example: 25
              example:
                data:
                  driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
                  year: 2024
                  month: 1
                  monthlyEarnings: 28000
                  tripsCount: 45
                  monthlyBonus: 500
                  bonusTier:
                    minEarnings: 28000
                    bonus: 500
                  monthlyDeductionPolicyCut: 0
                  deductionTier: null
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                missingParams:
                  summary: Missing year or month
                  value:
                    error: "year and month query parameters are required"
                invalidMonth:
                  summary: Invalid month
                  value:
                    error: "Invalid month. Must be between 1 and 12"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Driver not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /drivers/{id}/settlement:
    get:
      summary: Get complete settlement for a driver
      description: |
        Get complete settlement breakdown for a driver including earnings, bonuses, penalties, and policy cuts.
        
        **Query Parameters:**
        - `year` (required): Year (e.g., 2024)
        - `month` (required): Month (1-12)
        
        **Returns:**
        - Monthly earnings
        - Monthly bonus
        - Total penalties
        - Monthly deduction policy cut
        - Net earnings (earnings + bonus - penalties - policy cut)
        - Detailed breakdown
        - List of penalties applied
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Driver ID (UUID)
          schema:
            type: string
            format: uuid
        - name: year
          in: query
          required: true
          description: Year (e.g., 2024)
          schema:
            type: integer
            minimum: 2000
            maximum: 2100
            example: 2024
        - name: month
          in: query
          required: true
          description: Month (1-12)
          schema:
            type: integer
            minimum: 1
            maximum: 12
            example: 1
      responses:
        "200":
          description: Settlement retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      driverId:
                        type: string
                        format: uuid
                      year:
                        type: integer
                      month:
                        type: integer
                      monthlyEarnings:
                        type: number
                        description: Gross earnings for the month
                      tripsCount:
                        type: number
                      monthlyBonus:
                        type: number
                      bonusTier:
                        type: object
                        nullable: true
                      monthlyDeductionPolicyCut:
                        type: number
                      deductionTier:
                        type: object
                        nullable: true
                      totalPenalties:
                        type: number
                        description: Total amount of penalties applied
                      penaltiesCount:
                        type: number
                        description: Number of penalties applied
                      penalties:
                        type: array
                        description: List of penalties applied
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            penaltyName:
                              type: string
                            amount:
                              type: number
                            violationDate:
                              type: string
                              format: date-time
                            description:
                              type: string
                              nullable: true
                      netEarnings:
                        type: number
                        description: Net earnings after all deductions
                      breakdown:
                        type: object
                        description: Detailed breakdown
                        properties:
                          grossEarnings:
                            type: number
                          bonus:
                            type: number
                          penalties:
                            type: number
                          policyCut:
                            type: number
                          net:
                            type: number
              example:
                data:
                  driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
                  year: 2024
                  month: 1
                  monthlyEarnings: 28000
                  tripsCount: 45
                  monthlyBonus: 500
                  bonusTier:
                    minEarnings: 28000
                    bonus: 500
                  monthlyDeductionPolicyCut: 0
                  deductionTier: null
                  totalPenalties: 500
                  penaltiesCount: 2
                  penalties:
                    - id: "550e8400-e29b-41d4-a716-446655440000"
                      penaltyName: "Late report"
                      amount: 200
                      violationDate: "2024-01-15T09:30:00Z"
                      description: "Driver reported late"
                    - id: "660e8400-e29b-41d4-a716-446655440001"
                      penaltyName: "Trip cancelled"
                      amount: 300
                      violationDate: "2024-01-20T14:00:00Z"
                      description: "Driver cancelled trip without notice"
                  netEarnings: 28000
                  breakdown:
                    grossEarnings: 28000
                    bonus: 500
                    penalties: -500
                    policyCut: 0
                    net: 28000
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Driver not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /drivers/{id}/daily-limit:
    get:
      summary: Get driver daily limit information
      description: |
        Get driver's daily limit information including:
        - Daily target amount
        - Remaining daily limit (reduces as trips complete)
        - Used daily limit
        - Cash in hand (amount of cash driver currently has)
        
        **Note:** When a trip payment is collected (CASH or BOTH), the cash amount is added to driver's cash in hand, and the trip amount is deducted from remaining daily limit.
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Driver ID (UUID)
          schema:
            type: string
            format: uuid
            example: "779a77f6-5704-4b00-8561-2892c58946a2"
      responses:
        "200":
          description: Daily limit information retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      driverId:
                        type: string
                        format: uuid
                      driverName:
                        type: string
                        example: "John Doe"
                      dailyTargetAmount:
                        type: number
                        description: Daily target amount set for the driver
                        example: 1250
                      remainingDailyLimit:
                        type: number
                        description: Remaining daily limit (reduces as trips complete)
                        example: 750
                      usedDailyLimit:
                        type: number
                        description: Amount used from daily limit
                        example: 500
                      cashInHand:
                        type: number
                        description: Cash amount currently in driver's hand
                        example: 300
              example:
                data:
                  driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
                  driverName: "John Doe"
                  dailyTargetAmount: 1250
                  remainingDailyLimit: 750
                  usedDailyLimit: 500
                  cashInHand: 300
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Driver not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /drivers/{id}/submit-cash:
    post:
      summary: Submit cash to company
      description: |
        Submit cash to company. This resets the driver's cash in hand to zero.
        
        **Use Case:**
        - Driver collects cash from customers (via CASH or BOTH payment methods)
        - Cash is automatically added to driver's cash in hand when payment is collected
        - When driver submits cash to company, this endpoint resets cash in hand to zero
      tags:
        - Drivers
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Driver ID (UUID)
          schema:
            type: string
            format: uuid
            example: "779a77f6-5704-4b00-8561-2892c58946a2"
      responses:
        "200":
          description: Cash submitted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      driverId:
                        type: string
                        format: uuid
                      message:
                        type: string
                        example: "Cash submitted to company successfully"
                      cashInHand:
                        type: number
                        description: Cash in hand after submission (always 0)
                        example: 0
              example:
                data:
                  driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
                  message: "Cash submitted to company successfully"
                  cashInHand: 0
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Driver not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /drivers/submit-cash-settlement:
    post:
      summary: Submit cash for settlement (specified amount)
      description: |
        Submit a specific amount of cash for settlement. This reduces the driver's cash in hand by the specified amount.
        
        **Use Case:**
        - Driver collects cash from customers (via CASH or BOTH payment methods)
        - Cash is automatically added to driver's cash in hand when payment is collected
        - Driver can submit partial amounts for settlement (not just all cash)
        - This endpoint allows submitting a specific amount while keeping remaining cash with the driver
        
        **Validation:**
        - Driver must exist
        - Settlement amount must be greater than zero
        - Driver must have sufficient cash in hand (settlementAmount <= cashInHand)
        
        **Authorization:** ADMIN or OFFICE_STAFF only.
      tags:
        - Drivers
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SubmitCashForSettlementRequest"
            example:
              driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
              settlementAmount: 500.50
      responses:
        "200":
          description: Cash submitted for settlement successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      driverId:
                        type: string
                        format: uuid
                        description: Driver ID
                      driverName:
                        type: string
                        description: Driver full name
                        example: "John Doe"
                      message:
                        type: string
                        example: "Cash submitted for settlement successfully"
                      previousCash:
                        type: number
                        format: decimal
                        description: Cash in hand before settlement
                        example: 750.50
                      settlementAmount:
                        type: number
                        format: decimal
                        description: Amount submitted for settlement
                        example: 500.50
                      remainingCash:
                        type: number
                        format: decimal
                        description: Cash in hand after settlement
                        example: 250.00
              example:
                data:
                  driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
                  driverName: "John Doe"
                  message: "Cash submitted for settlement successfully"
                  previousCash: 750.50
                  settlementAmount: 500.50
                  remainingCash: 250.00
        "400":
          description: Bad request - invalid input or insufficient cash
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                invalidAmount:
                  summary: Invalid settlement amount
                  value:
                    error: "Settlement amount must be greater than zero"
                insufficientCash:
                  summary: Insufficient cash in hand
                  value:
                    error: "Insufficient cash in hand. Available: 250.00, Requested: 500.50"
        "401":
          description: Not authenticated (missing or invalid token)
        "403":
          description: Forbidden - ADMIN or OFFICE_STAFF required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Driver not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /config/driver-earnings:
    get:
      summary: Get driver earnings configuration
      description: |
        Get the current driver earnings configuration including daily incentive rules, monthly bonus tiers, and deduction policy.
        
        **Returns:**
        - Daily target default
        - Incentive tier 1 (min, max, type)
        - Incentive tier 2 (min, percent)
        - Monthly bonus tiers (array)
        - Monthly deduction tiers (array)
      tags:
        - Configuration
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Earnings config retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      dailyTargetDefault:
                        type: number
                        example: 1250
                      incentiveTier1Min:
                        type: number
                        example: 1250
                      incentiveTier1Max:
                        type: number
                        example: 1550
                      incentiveTier1Type:
                        type: string
                        enum: [full_extra, percent]
                        example: "full_extra"
                      incentiveTier2Min:
                        type: number
                        example: 1550
                      incentiveTier2Percent:
                        type: number
                        example: 20
                      monthlyBonusTiers:
                        type: array
                        description: Monthly bonus tiers
                        items:
                          type: object
                          properties:
                            minEarnings:
                              type: number
                            bonus:
                              type: number
                        example:
                          - minEarnings: 25000
                            bonus: 3000
                          - minEarnings: 28000
                            bonus: 500
                      monthlyDeductionTiers:
                        type: array
                        description: Monthly deduction policy tiers
                        items:
                          type: object
                          properties:
                            maxEarnings:
                              type: number
                            cutPercent:
                              type: number
                        example:
                          - maxEarnings: 26000
                            cutPercent: 25
                          - maxEarnings: 22000
                            cutPercent: 20
                      isActive:
                        type: boolean
                      createdAt:
                        type: string
                        format: date-time
                      updatedAt:
                        type: string
                        format: date-time
              example:
                data:
                  dailyTargetDefault: 1250
                  incentiveTier1Min: 1250
                  incentiveTier1Max: 1550
                  incentiveTier1Type: "full_extra"
                  incentiveTier2Min: 1550
                  incentiveTier2Percent: 20
                  monthlyBonusTiers:
                    - minEarnings: 25000
                      bonus: 3000
                    - minEarnings: 28000
                      bonus: 500
                  monthlyDeductionTiers:
                    - maxEarnings: 26000
                      cutPercent: 25
                    - maxEarnings: 22000
                      cutPercent: 20
                  isActive: true
        "401":
          description: Not authenticated (missing or invalid token)

    post:
      summary: Set driver earnings configuration
      description: |
        Set driver earnings configuration. Only ADMIN can set this configuration.
        This will deactivate any existing active configuration and create a new one.
        
        **Request Body:**
        All fields are optional. Missing fields will use defaults.
        
        **Daily Incentive:**
        - `dailyTargetDefault`: Default daily target amount (default: 1250)
        - `incentiveTier1Min`: Minimum amount for tier 1 (default: 1250)
        - `incentiveTier1Max`: Maximum amount for tier 1 (default: 1550)
        - `incentiveTier1Type`: "full_extra" or "percent" (default: "full_extra")
        - `incentiveTier2Min`: Minimum amount for tier 2 (default: 1550)
        - `incentiveTier2Percent`: Percentage for tier 2 (default: 20)
        
        **Monthly Bonus:**
        - `monthlyBonusTiers`: Array of { minEarnings, bonus }
        
        **Monthly Deduction:**
        - `monthlyDeductionTiers`: Array of { maxEarnings, cutPercent }
      tags:
        - Configuration
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateEarningsConfigRequest"
            example:
              dailyTargetDefault: 1250
              incentiveTier1Min: 1250
              incentiveTier1Max: 1550
              incentiveTier1Type: "full_extra"
              incentiveTier2Min: 1550
              incentiveTier2Percent: 20
              monthlyBonusTiers:
                - minEarnings: 25000
                  bonus: 3000
                - minEarnings: 28000
                  bonus: 500
              monthlyDeductionTiers:
                - maxEarnings: 26000
                  cutPercent: 25
                - maxEarnings: 22000
                  cutPercent: 20
      responses:
        "200":
          description: Earnings config set successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      dailyTargetDefault:
                        type: number
                      incentiveTier1Min:
                        type: number
                      incentiveTier1Max:
                        type: number
                      incentiveTier1Type:
                        type: string
                      incentiveTier2Min:
                        type: number
                      incentiveTier2Percent:
                        type: number
                      monthlyBonusTiers:
                        type: array
                      monthlyDeductionTiers:
                        type: array
                      isActive:
                        type: boolean
                      updatedAt:
                        type: string
                        format: date-time
              example:
                data:
                  id: "550e8400-e29b-41d4-a716-446655440000"
                  dailyTargetDefault: 1250
                  incentiveTier1Min: 1250
                  incentiveTier1Max: 1550
                  incentiveTier1Type: "full_extra"
                  incentiveTier2Min: 1550
                  incentiveTier2Percent: 20
                  monthlyBonusTiers:
                    - minEarnings: 25000
                      bonus: 3000
                    - minEarnings: 28000
                      bonus: 500
                  monthlyDeductionTiers:
                    - maxEarnings: 26000
                      cutPercent: 25
                    - maxEarnings: 22000
                      cutPercent: 20
                  isActive: true
                  createdAt: "2024-01-20T10:00:00Z"
                  updatedAt: "2024-01-20T10:00:00Z"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "403":
          description: Forbidden - only ADMIN can set earnings config
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    patch:
      summary: Update driver earnings configuration
      description: |
        Update driver earnings configuration. Only ADMIN can update this configuration.
        
        **Request Body:**
        All fields are optional. Only provided fields will be updated.
        
        **Daily Incentive:**
        - `dailyTargetDefault`: Default daily target amount
        - `incentiveTier1Min`: Minimum amount for tier 1
        - `incentiveTier1Max`: Maximum amount for tier 1
        - `incentiveTier1Type`: "full_extra" or "percent"
        - `incentiveTier2Min`: Minimum amount for tier 2
        - `incentiveTier2Percent`: Percentage for tier 2 (e.g., 20 for 20%)
        
        **Monthly Bonus:**
        - `monthlyBonusTiers`: Array of { minEarnings, bonus }
        
        **Monthly Deduction:**
        - `monthlyDeductionTiers`: Array of { maxEarnings, cutPercent }
      tags:
        - Configuration
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateEarningsConfigRequest"
            example:
              dailyTargetDefault: 1250
              incentiveTier1Min: 1250
              incentiveTier1Max: 1550
              incentiveTier1Type: "full_extra"
              incentiveTier2Min: 1550
              incentiveTier2Percent: 20
              monthlyBonusTiers:
                - minEarnings: 25000
                  bonus: 3000
                - minEarnings: 28000
                  bonus: 500
              monthlyDeductionTiers:
                - maxEarnings: 26000
                  cutPercent: 25
                - maxEarnings: 22000
                  cutPercent: 20
      responses:
        "200":
          description: Earnings config updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      dailyTargetDefault:
                        type: number
                      incentiveTier1Min:
                        type: number
                      incentiveTier1Max:
                        type: number
                      incentiveTier1Type:
                        type: string
                      incentiveTier2Min:
                        type: number
                      incentiveTier2Percent:
                        type: number
                      monthlyBonusTiers:
                        type: array
                      monthlyDeductionTiers:
                        type: array
                      isActive:
                        type: boolean
                      updatedAt:
                        type: string
                        format: date-time
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "403":
          description: Forbidden - only ADMIN can update earnings config
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /config/driver-earnings/franchises:
    get:
      summary: Get earnings configs by franchises
      description: |
        Fetch driver earnings configuration for one or more franchises.
        Query param `franchiseIds` = comma-separated franchise UUIDs.
      tags:
        - Configuration
      security:
        - bearerAuth: []
      parameters:
        - name: franchiseIds
          in: query
          required: true
          description: Comma-separated franchise UUIDs
          schema:
            type: string
            example: "550e8400-e29b-41d4-a716-446655440001,660e8400-e29b-41d4-a716-446655440002"
      responses:
        "200":
          description: Configs retrieved (array, one per franchise)
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/DriverEarningsConfigResponse"
              example:
                data:
                  - id: "550e8400-e29b-41d4-a716-446655440000"
                    franchiseId: "550e8400-e29b-41d4-a716-446655440001"
                    driverId: null
                    dailyTargetDefault: 1250
                    incentiveTier1Min: 1250
                    incentiveTier1Max: 1550
                    incentiveTier1Type: "full_extra"
                    incentiveTier2Min: 1550
                    incentiveTier2Percent: 20
                    monthlyBonusTiers:
                      - minEarnings: 25000
                        bonus: 3000
                      - minEarnings: 28000
                        bonus: 500
                    monthlyDeductionTiers:
                      - maxEarnings: 26000
                        cutPercent: 25
                      - maxEarnings: 22000
                        cutPercent: 20
                    isActive: true
                    createdAt: "2024-01-20T10:00:00Z"
                    updatedAt: "2024-01-20T10:00:00Z"
        "400":
          description: Bad request - franchiseIds required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)

  /config/driver-earnings/franchise/{franchiseId}:
    get:
      summary: Get earnings config for a franchise
      description: Fetch driver earnings configuration for a single franchise.
      tags:
        - Configuration
      security:
        - bearerAuth: []
      parameters:
        - name: franchiseId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Config retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/DriverEarningsConfigResponse"
              example:
                data:
                  id: "550e8400-e29b-41d4-a716-446655440000"
                  franchiseId: "550e8400-e29b-41d4-a716-446655440001"
                  driverId: null
                  dailyTargetDefault: 1250
                  incentiveTier1Min: 1250
                  incentiveTier1Max: 1550
                  incentiveTier1Type: "full_extra"
                  incentiveTier2Min: 1550
                  incentiveTier2Percent: 20
                  monthlyBonusTiers:
                    - minEarnings: 25000
                      bonus: 3000
                    - minEarnings: 28000
                      bonus: 500
                  monthlyDeductionTiers:
                    - maxEarnings: 26000
                      cutPercent: 25
                    - maxEarnings: 22000
                      cutPercent: 20
                  isActive: true
                  createdAt: "2024-01-20T10:00:00Z"
                  updatedAt: "2024-01-20T10:00:00Z"
        "401":
          description: Not authenticated (missing or invalid token)
    post:
      summary: Set earnings config for a franchise
      description: |
        Set driver earnings configuration for a franchise. Only ADMIN.
        Deactivates existing config for this franchise and creates a new one.
      tags:
        - Configuration
      security:
        - bearerAuth: []
      parameters:
        - name: franchiseId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateEarningsConfigRequest"
      responses:
        "200":
          description: Config set successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/DriverEarningsConfigResponse"
              example:
                data:
                  id: "550e8400-e29b-41d4-a716-446655440000"
                  franchiseId: "550e8400-e29b-41d4-a716-446655440001"
                  driverId: null
                  dailyTargetDefault: 1300
                  incentiveTier1Min: 1300
                  incentiveTier1Max: 1600
                  incentiveTier1Type: "full_extra"
                  incentiveTier2Min: 1600
                  incentiveTier2Percent: 25
                  monthlyBonusTiers:
                    - minEarnings: 25000
                      bonus: 3000
                    - minEarnings: 28000
                      bonus: 500
                  monthlyDeductionTiers:
                    - maxEarnings: 26000
                      cutPercent: 25
                    - maxEarnings: 22000
                      cutPercent: 20
                  isActive: true
                  createdAt: "2024-01-20T10:00:00Z"
                  updatedAt: "2024-01-20T11:00:00Z"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "403":
          description: Forbidden - only ADMIN

  /config/driver-earnings/driver/{driverId}:
    get:
      summary: Get earnings config for a driver
      description: Fetch driver earnings configuration for a single driver.
      tags:
        - Configuration
      security:
        - bearerAuth: []
      parameters:
        - name: driverId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Config retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/DriverEarningsConfigResponse"
              example:
                data:
                  id: "660e8400-e29b-41d4-a716-446655440000"
                  franchiseId: null
                  driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
                  dailyTargetDefault: 1250
                  incentiveTier1Min: 1250
                  incentiveTier1Max: 1550
                  incentiveTier1Type: "full_extra"
                  incentiveTier2Min: 1550
                  incentiveTier2Percent: 20
                  monthlyBonusTiers:
                    - minEarnings: 25000
                      bonus: 3000
                    - minEarnings: 28000
                      bonus: 500
                  monthlyDeductionTiers:
                    - maxEarnings: 26000
                      cutPercent: 25
                    - maxEarnings: 22000
                      cutPercent: 20
                  isActive: true
                  createdAt: "2024-01-20T10:00:00Z"
                  updatedAt: "2024-01-20T10:00:00Z"
        "401":
          description: Not authenticated (missing or invalid token)

  /config/driver-earnings/drivers:
    post:
      summary: Set earnings config for drivers
      description: |
        Set driver earnings configuration for one or more drivers. Only ADMIN.
        Same config is applied to each driver. Body must include `driverIds` array.
      tags:
        - Configuration
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - driverIds
              properties:
                driverIds:
                  type: array
                  items:
                    type: string
                    format: uuid
                  description: Driver UUIDs
                dailyTargetDefault:
                  type: number
                incentiveTier1Min:
                  type: number
                incentiveTier1Max:
                  type: number
                incentiveTier1Type:
                  type: string
                  enum: [full_extra, percent]
                incentiveTier2Min:
                  type: number
                incentiveTier2Percent:
                  type: number
                monthlyBonusTiers:
                  type: array
                monthlyDeductionTiers:
                  type: array
            example:
              driverIds:
                - "779a77f6-5704-4b00-8561-2892c58946a2"
                - "880a77f6-5704-4b00-8561-2892c58946a3"
              dailyTargetDefault: 1250
              incentiveTier1Min: 1250
              incentiveTier1Max: 1550
              incentiveTier1Type: "full_extra"
              incentiveTier2Min: 1550
              incentiveTier2Percent: 20
      responses:
        "200":
          description: Configs set (array, one per driver)
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/DriverEarningsConfigResponse"
              example:
                data:
                  - id: "770e8400-e29b-41d4-a716-446655440000"
                    franchiseId: null
                    driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
                    dailyTargetDefault: 1250
                    incentiveTier1Min: 1250
                    incentiveTier1Max: 1550
                    incentiveTier1Type: "full_extra"
                    incentiveTier2Min: 1550
                    incentiveTier2Percent: 20
                    monthlyBonusTiers:
                      - minEarnings: 25000
                        bonus: 3000
                      - minEarnings: 28000
                        bonus: 500
                    monthlyDeductionTiers:
                      - maxEarnings: 26000
                        cutPercent: 25
                      - maxEarnings: 22000
                        cutPercent: 20
                    isActive: true
                    createdAt: "2024-01-20T10:00:00Z"
                    updatedAt: "2024-01-20T10:00:00Z"
                  - id: "880e8400-e29b-41d4-a716-446655440000"
                    franchiseId: null
                    driverId: "880a77f6-5704-4b00-8561-2892c58946a3"
                    dailyTargetDefault: 1250
                    incentiveTier1Min: 1250
                    incentiveTier1Max: 1550
                    incentiveTier1Type: "full_extra"
                    incentiveTier2Min: 1550
                    incentiveTier2Percent: 20
                    monthlyBonusTiers:
                      - minEarnings: 25000
                        bonus: 3000
                      - minEarnings: 28000
                        bonus: 500
                    monthlyDeductionTiers:
                      - maxEarnings: 26000
                        cutPercent: 25
                      - maxEarnings: 22000
                        cutPercent: 20
                    isActive: true
                    createdAt: "2024-01-20T10:00:00Z"
                    updatedAt: "2024-01-20T10:00:00Z"
        "400":
          description: Bad request - driverIds required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error: "driverIds array is required and must not be empty"
        "401":
          description: Not authenticated (missing or invalid token)
        "403":
          description: Forbidden - only ADMIN


  /customers:
    get:
      summary: List all customers
      tags:
        - Customers
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of customers
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Customer"
        "401":
          description: Not authenticated (missing or invalid token)
    post:
      summary: Create a customer
      tags:
        - Customers
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateCustomerRequest"
      responses:
        "201":
          description: Customer created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomerResponse"
        "401":
          description: Not authenticated (missing or invalid token)

  /customers/{id}:
    get:
      summary: Get customer by ID
      tags:
        - Customers
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Customer UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Customer
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomerResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Customer not found

  /customers/{id}/details:
    get:
      summary: Get customer details with history
      description: |
        Returns customer profile plus history stats:
        - **tripsBooked**: Number of trips booked by this customer
        - **complaintsRaised**: Number of complaints raised by this customer
      tags:
        - Customers
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Customer UUID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Customer details with history
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomerDetailsResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Customer not found

  /trips:
    get:
      summary: Get all trips
      description: |
        Get a list of all trips.

        Supports optional **pagination** and **filters** via query parameters.

        **Query Parameters:**
        - `page` (optional): Page number (default: 1)
        - `limit` (optional): Number of items per page (default: 10, max: 100)
        - `status` (optional): Filter by a single trip status (e.g. `ASSIGNED`)
        - `statuses` (optional): Filter by multiple statuses (comma-separated, e.g. `ASSIGNED,TRIP_STARTED`)
        - `dateFrom` (optional): Filter from date (YYYY-MM-DD) using scheduledAt (or createdAt if scheduledAt is null)
        - `dateTo` (optional): Filter to date (YYYY-MM-DD) using scheduledAt (or createdAt if scheduledAt is null)
        - `franchiseId` (optional): Filter by franchise UUID

        **Without pagination parameters:** Returns an array response `{ data: Trip[] }` (backward compatible)

        **With pagination parameters:** Returns paginated results with metadata
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          description: Page number (default: 1)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          description: Number of items per page (default: 10, max: 100)
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: status
          in: query
          required: false
          description: Filter trips by a single status (mutually exclusive with `statuses`)
          schema:
            type: string
            example: "ASSIGNED"
        - name: statuses
          in: query
          required: false
          description: Filter trips by multiple statuses (comma-separated). If provided, `status` is ignored.
          schema:
            type: string
            example: "ASSIGNED,TRIP_STARTED,TRIP_PROGRESS"
        - name: dateFrom
          in: query
          required: false
          description: Filter trips from this date (YYYY-MM-DD)
          schema:
            type: string
            example: "2026-02-01"
        - name: dateTo
          in: query
          required: false
          description: Filter trips up to this date (YYYY-MM-DD)
          schema:
            type: string
            example: "2026-02-28"
        - name: franchiseId
          in: query
          required: false
          description: Filter trips by franchise UUID
          schema:
            type: string
            format: uuid
            example: "660e8400-e29b-41d4-a716-446655440001"
      responses:
        "200":
          description: List of trips (paginated or all)
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    description: Paginated response (when page/limit provided)
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Trip"
                      pagination:
                        $ref: "#/components/schemas/PaginationMeta"
                  - type: object
                    description: All trips (when no pagination params)
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Trip"
        "401":
          description: Not authenticated (missing or invalid token)
    post:
      summary: Create a trip
      tags:
        - Trips
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTripRequest"
      responses:
        "201":
          description: Trip created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TripResponse"
        "401":
          description: Not authenticated (missing or invalid token)

  /trips/driver/assigned:
    get:
      summary: Get trips assigned to driver
      description: |
        Get a list of trips that are assigned to a specific driver.
        
        Returns trips with status: ASSIGNED, DRIVER_ACCEPTED, DRIVER_ON_THE_WAY, TRIP_STARTED, TRIP_PROGRESS, or IN_PROGRESS.
        
        **Query Parameters:**
        - `driverId` (required): Driver UUID to get assigned trips for
        
        **Use Cases:**
        - Admin/Office staff viewing trips for a specific driver
        - Driver dashboard to view active trips (when driverId is provided)
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: driverId
          in: query
          required: true
          description: Driver UUID
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        "200":
          description: List of assigned trips retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/TripResponse"
        "400":
          description: Bad request - missing or invalid driver ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trips/my-assigned:
    get:
      summary: Get my assigned trips (Driver)
      description: |
        Get a list of trips assigned to the authenticated driver.
        
        This endpoint automatically uses the driver ID from the authentication token, so no driverId parameter is needed.
        
        Returns trips with status: ASSIGNED, DRIVER_ACCEPTED, TRIP_STARTED, or TRIP_PROGRESS.
        
        **Authentication:**
        - Requires driver authentication token (from `/drivers/login`)
        - Driver ID is automatically extracted from the token
        
        **Use Cases:**
        - Driver mobile app to see their assigned trips
        - Driver dashboard to view active trips
        - Real-time trip status for drivers
        
        **Note:** This endpoint is specifically for drivers. For admin/office staff to view trips for any driver, use `/trips/driver/assigned?driverId=...`
      tags:
        - Trips
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of assigned trips retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    description: Array of trips assigned to the authenticated driver
                    items:
                      $ref: "#/components/schemas/Trip"
              example:
                data:
                  - id: "550e8400-e29b-41d4-a716-446655440000"
                    franchiseId: "660e8400-e29b-41d4-a716-446655440001"
                    driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
                    customerId: 1
                    customerName: "John Doe"
                    customerPhone: "+1234567890"
                    tripType: "CITY_ROUND"
                    status: "ASSIGNED"
                    pickupLocation: "ChIJN1t_tDeuEmsRUsoyG83frY4"
                    pickupAddress: "123 Main Street, New York, NY 10001"
                    dropLocation: "ChIJN1t_tDeuEmsRUsoyG83frY5"
                    dropAddress: "456 Oak Avenue, New York, NY 10002"
                    baseAmount: 500
                    extraAmount: 0
                    totalAmount: 500
                    finalAmount: 500
                    paymentStatus: "PENDING"
                    scheduledAt: "2024-01-20T14:30:00Z"
                    createdAt: "2024-01-20T10:00:00Z"
                    updatedAt: "2024-01-20T10:30:00Z"
        "401":
          description: Not authenticated or not a driver token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notAuthenticated:
                  summary: Not authenticated
                  value:
                    error: "Driver authentication required. Please login as a driver."
                notDriverToken:
                  summary: Not a driver token
                  value:
                    error: "Driver authentication required. Please login as a driver."

  /trips/my:
    get:
      summary: Get my trips (Driver) - includes completed
      description: |
        Get **all** trips for the authenticated driver (any status), including completed/cancelled trips.
        
        This endpoint uses the driver ID from the authentication token, so no `driverId` parameter is needed.
        
        **Why this exists (vs `/trips/my-assigned`):**
        - `/trips/my-assigned` is used for "Upcoming Trips" and real-time driver workflow (active-only)
        - `/trips/my` is used for the Trips tab / history where completed trips must be visible
        
        **Authentication:**
        - Requires driver authentication token (from `/drivers/login`)
      tags:
        - Trips
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of trips retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    description: Array of trips for the authenticated driver (any status)
                    items:
                      $ref: "#/components/schemas/Trip"
        "401":
          description: Not authenticated or not a driver token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trip-offers/my-pending:
    get:
      summary: List my pending trip offers (Driver)
      description: |
        Returns active trip offers for the authenticated driver that are still valid (not expired).
        
        **Authentication:**
        - Requires driver authentication token (from `/drivers/login`)
        
        **Use Cases:**
        - REST fallback if socket is not connected
        - Driver app can poll this endpoint to show incoming requests
      tags:
        - Trip Offers
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Pending offers retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/TripOffer"
        "401":
          description: Not authenticated or not a driver token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trip-offers/{id}/accept:
    post:
      summary: Accept a trip offer (Driver)
      description: |
        Accepts a trip offer for the authenticated driver.
        
        This endpoint is **idempotent**: if already accepted, it returns the current state.
      tags:
        - Trip Offers
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip offer ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Offer accepted (or current state returned)
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/TripOffer"
        "401":
          description: Not authenticated or not a driver token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Offer not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trip-offers/{id}/reject:
    post:
      summary: Reject a trip offer (Driver)
      description: |
        Rejects a trip offer for the authenticated driver.
      tags:
        - Trip Offers
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip offer ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Offer rejected successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/TripOffer"
        "401":
          description: Not authenticated or not a driver token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Offer not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /alerts/my:
    get:
      summary: Get my alerts (Driver)
      description: |
        Alerts feed for driver mobile app.
        Includes:
        - Incoming trip requests (pending offers)
        - Trip lifecycle events (accepted/rejected/started/ended)
      tags:
        - Alerts
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          required: false
          description: Max number of recent event items to include (1-200). Default is 50.
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
      responses:
        "200":
          description: Alerts retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                            type:
                              type: string
                              example: "INCOMING_REQUEST"
                            title:
                              type: string
                            message:
                              type: string
                            createdAt:
                              type: string
                              format: date-time
                            tripId:
                              type: string
                              format: uuid
                            offerId:
                              type: string
                              format: uuid
                            metadata:
                              type: object
                      counts:
                        type: object
                        properties:
                          incomingRequests:
                            type: integer
                          recentEvents:
                            type: integer
                          total:
                            type: integer
        "401":
          description: Not authenticated or not a driver token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trips/unassigned:
    get:
      summary: Get unassigned trips
      description: |
        Get a list of trips with PENDING or NOT_ASSIGNED status (trips without a driver assigned).
        Supports optional pagination via query parameters.

        **Query Parameters:**
        - `page` (optional): Page number (default: 1)
        - `limit` (optional): Number of items per page (default: 10, max: 100)

        **Without pagination parameters:** Returns all unassigned trips

        **With pagination parameters:** Returns paginated results with metadata
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          description: Page number (default: 1)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          description: Number of items per page (default: 10, max: 100)
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        "200":
          description: List of unassigned trips (paginated or all)
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    description: Paginated response (when page/limit provided)
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Trip"
                      pagination:
                        $ref: "#/components/schemas/PaginationMeta"
                  - type: object
                    description: All unassigned trips (when no pagination params)
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Trip"
        "401":
          description: Not authenticated (missing or invalid token)

  /trips/assigned:
    get:
      summary: Get assigned trips
      description: |
        Get a list of trips that have a driver assigned. Includes trips with status:
        - **ASSIGNED** - Driver has been assigned to the trip
        - **DRIVER_ACCEPTED** - Driver has accepted the trip
        - **TRIP_STARTED** - Trip has been started
        - **TRIP_PROGRESS** - Trip is in progress
        - **IN_PROGRESS** - Trip is in progress (legacy status)
        - **DRIVER_ON_THE_WAY** - Driver is on the way to pickup
        
        Supports optional pagination and franchise filtering via query parameters.

        **Query Parameters:**
        - `page` (optional): Page number (default: 1)
        - `limit` (optional): Number of items per page (default: 10, max: 100)
        - `franchiseId` (optional): Filter trips by franchise ID (UUID)

        **Without pagination parameters:** Returns all assigned trips

        **With pagination parameters:** Returns paginated results with metadata
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          description: Page number (default: 1)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          description: Number of items per page (default: 10, max: 100)
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: franchiseId
          in: query
          required: false
          description: Filter trips by franchise ID (UUID)
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        "200":
          description: List of assigned trips (paginated or all)
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    description: Paginated response (when page/limit provided)
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Trip"
                      pagination:
                        $ref: "#/components/schemas/PaginationMeta"
                  - type: object
                    description: All assigned trips (when no pagination params)
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Trip"
              example:
                data:
                  - id: "550e8400-e29b-41d4-a716-446655440000"
                    franchiseId: "660e8400-e29b-41d4-a716-446655440001"
                    driverId: "770e8400-e29b-41d4-a716-446655440002"
                    customerId: "880e8400-e29b-41d4-a716-446655440003"
                    customerName: "John Doe"
                    customerPhone: "+1234567890"
                    tripType: "CITY_ROUND"
                    status: "ASSIGNED"
                    pickupLocation: "123 Main St"
                    dropLocation: "456 Oak Ave"
                    scheduledAt: "2026-01-25T10:00:00Z"
                    baseAmount: 500
                    totalAmount: 500
                    finalAmount: 500
                    paymentStatus: "PENDING"
                    createdAt: "2026-01-25T09:00:00Z"
                    Driver:
                      id: "770e8400-e29b-41d4-a716-446655440002"
                      firstName: "Jane"
                      lastName: "Smith"
                      driverCode: "DRV-ABC123"
                    Franchise:
                      id: "660e8400-e29b-41d4-a716-446655440001"
                      name: "Downtown Branch"
                      code: "FRN-001"
        "400":
          description: Bad request - invalid pagination parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trips/{id}:
    get:
      summary: Get trip by ID
      description: |
        Get detailed information about a specific trip by its ID (UUID).
        
        Returns the trip with all related data including:
        - Customer information
        - Franchise information
        - Driver information (if assigned)
        - Trip status and details
        - Payment information
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip ID (UUID)
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        "200":
          description: Trip retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Trip"
        "400":
          description: Bad request - invalid UUID format
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trips/phase1:
    post:
      summary: Create trip - Phase 1 (Customer Data Collection)
      description: |
        Create a trip in Phase 1 with customer data collection. This endpoint:
        - Automatically checks if customer exists by phone number
        - Creates new customer if not found, or updates existing customer with new information
        - Creates trip with REQUESTED status (ready for driver assignment in Phase 2)
        - Stores pickup and destination locations from Google Places API
        - Handles car preferences (gear type and category)
        - Sets confirmation flags (details reconfirmed, fare discussed, price accepted)
      tags:
        - Trips
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTripPhase1Request"
            example:
              customerName: "John Doe"
              customerPhone: "+1234567890"
              customerEmail: "john.doe@example.com"
              pickupLocation: "ChIJN1t_tDeuEmsRUsoyG83frY4"
              pickupAddress: "123 Main Street, New York, NY 10001"
              pickupLocationNote: "Near the blue building, entrance on the right"
              destinationLocation: "ChIJN1t_tDeuEmsRUsoyG83frY5"
              destinationAddress: "456 Oak Avenue, New York, NY 10002"
              destinationNote: "Building entrance, ring doorbell"
              franchiseId: "550e8400-e29b-41d4-a716-446655440000"
              tripType: "CITY_ROUND"
              carGearType: "MANUAL"
              carType: "PREMIUM"
              tripDate: "2024-01-20"
              tripTime: "14:30"
              isDetailsReconfirmed: true
              isFareDiscussed: true
              isPriceAccepted: true
      responses:
        "201":
          description: Trip created successfully in Phase 1
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateTripPhase1Response"
              example:
                data:
                  trip:
                    id: "660e8400-e29b-41d4-a716-446655440000"
                    franchiseId: "550e8400-e29b-41d4-a716-446655440000"
                    customerId: 1
                    customerName: "John Doe"
                    customerPhone: "+1234567890"
                    customerEmail: "john.doe@example.com"
                    tripType: "CITY_ROUND"
                    status: "REQUESTED"
                    pickupLocation: "ChIJN1t_tDeuEmsRUsoyG83frY4"
                    pickupAddress: "123 Main Street, New York, NY 10001"
                    pickupLocationNote: "Near the blue building, entrance on the right"
                    dropLocation: "ChIJN1t_tDeuEmsRUsoyG83frY5"
                    dropAddress: "456 Oak Avenue, New York, NY 10002"
                    dropLocationNote: "Building entrance, ring doorbell"
                    carType: '{"gearType":"MANUAL","category":"PREMIUM"}'
                    scheduledAt: "2024-01-20T14:30:00Z"
                    isDetailsReconfirmed: true
                    isFareDiscussed: true
                    isPriceAccepted: true
                    baseAmount: 0
                    extraAmount: 0
                    totalAmount: 0
                    finalAmount: 0
                    paymentStatus: "PENDING"
                    createdAt: "2024-01-20T10:00:00Z"
                    updatedAt: "2024-01-20T10:00:00Z"
                  customer:
                    id: 1
                    name: "John Doe"
                    phone: "+1234567890"
                    email: "john.doe@example.com"
                    isExisting: false
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                missingCustomerName:
                  summary: Missing customer name
                  value:
                    error: "Customer name is required"
                missingCustomerPhone:
                  summary: Missing customer phone
                  value:
                    error: "Customer phone number is required"
                missingPickupLocation:
                  summary: Missing pickup location
                  value:
                    error: "Pickup location is required"
                missingDestinationLocation:
                  summary: Missing destination location
                  value:
                    error: "Destination location is required"
                invalidCarGearType:
                  summary: Invalid car gear type
                  value:
                    error: "Invalid car gear type"
                invalidCarType:
                  summary: Invalid car type category
                  value:
                    error: "Invalid car type category"
                invalidTripType:
                  summary: Invalid trip type
                  value:
                    error: "Invalid trip type"
        "401":
          description: Not authenticated (missing or invalid token)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trips/assign-driver:
    post:
      summary: Assign driver to trip
      description: |
        Assign a driver to a trip. Only trip ID and driver ID are required; franchise is derived from the trip.
        
        This endpoint validates that:
        - tripId and driverId are provided and valid UUIDs
        - The driver belongs to the trip's franchise
        - The trip is in a valid status for assignment (NOT_ASSIGNED, REQUESTED, or PENDING)
        - The driver is eligible (active, not banned, license valid, no active trips)
        
        **Prerequisites:**
        - Trip must exist
        - Trip must not already have a driver assigned
        - Trip status must be NOT_ASSIGNED, REQUESTED, or PENDING
        - Driver must exist and be active
        - Driver must belong to the same franchise as the trip
        - Driver must not have any active trips
        - Driver must not be globally banned
        - Driver's license must not be expired
        
        **Status Changes:**
        - Trip status: PENDING/NOT_ASSIGNED/REQUESTED → ASSIGNED
        - Driver trip status: AVAILABLE → ON_TRIP
        
        **Use Cases:**
        - Admin/Office staff assigning trips to drivers
        - Bulk trip assignment operations
      tags:
        - Trips
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AssignDriverToTripRequest"
            example:
              tripId: "550e8400-e29b-41d4-a716-446655440000"
              driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
      responses:
        "200":
          description: Driver assigned to trip successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Trip"
              example:
                data:
                  id: "550e8400-e29b-41d4-a716-446655440000"
                  franchiseId: "660e8400-e29b-41d4-a716-446655440001"
                  driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
                  customerId: 1
                  customerName: "John Doe"
                  customerPhone: "+1234567890"
                  tripType: "CITY_ROUND"
                  status: "ASSIGNED"
                  pickupLocation: "ChIJN1t_tDeuEmsRUsoyG83frY4"
                  pickupAddress: "123 Main Street, New York, NY 10001"
                  dropLocation: "ChIJN1t_tDeuEmsRUsoyG83frY5"
                  dropAddress: "456 Oak Avenue, New York, NY 10002"
                  baseAmount: 500
                  extraAmount: 0
                  totalAmount: 500
                  finalAmount: 500
                  paymentStatus: "PENDING"
                  createdAt: "2024-01-20T10:00:00Z"
                  updatedAt: "2024-01-20T10:30:00Z"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                missingTripId:
                  summary: Missing trip ID
                  value:
                    error: "Trip ID is required"
                missingDriverId:
                  summary: Missing driver ID
                  value:
                    error: "Driver ID is required"
                invalidTripId:
                  summary: Invalid trip ID format
                  value:
                    error: "Invalid trip ID format. Expected UUID."
                invalidDriverId:
                  summary: Invalid driver ID format
                  value:
                    error: "Invalid driver ID format. Expected UUID."
                tripNotFound:
                  summary: Trip not found
                  value:
                    error: "Trip not found"
                driverNotFound:
                  summary: Driver not found
                  value:
                    error: "Driver not found"
                driverFranchiseMismatch:
                  summary: Driver belongs to different franchise
                  value:
                    error: "Driver belongs to different franchise"
                tripAlreadyAssigned:
                  summary: Trip already has driver
                  value:
                    error: "Trip already has a driver assigned"
                invalidTripStatus:
                  summary: Invalid trip status
                  value:
                    error: "Cannot assign driver to trip with status: COMPLETED"
                driverNotActive:
                  summary: Driver not active
                  value:
                    error: "Driver is not active"
                driverBanned:
                  summary: Driver is banned
                  value:
                    error: "Driver is globally banned"
                driverLicenseExpired:
                  summary: Driver license expired
                  value:
                    error: "Driver license has expired"
                driverHasActiveTrip:
                  summary: Driver has active trip
                  value:
                    error: "Driver already has an active trip"
        "401":
          description: Not authenticated (missing or invalid token)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Trip or driver not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trips/{id}/request-drivers:
    post:
      summary: Request trip to drivers (manual dispatch)
      description: |
        Manually trigger trip offers to drivers (ALL / SPECIFIC / LIST).
        
        This endpoint is intended for dispatcher UI flows like:
        - "Request now" (offer to all eligible drivers immediately)
        - "Request specific driver"
        - "Request list of drivers"
        
        **Modes:**
        - `ALL` (default): Offers the trip to all drivers in the trip's franchise, in rating-tier priority (5 → 4 → 3 → 2 → 1).
        - `SPECIFIC`: Offers the trip to `driverId` (only if the driver belongs to the trip's franchise).
        - `LIST`: Offers the trip to `driverIds[]` (only drivers that belong to the trip's franchise will receive offers).
        
        **Response:**
        Returns `{ requested: number }` which is the count of *new* offers created.
        If the trip doesn't exist or is already assigned, `requested` will be `0`.
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip ID (UUID)
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RequestTripDriversRequest"
            examples:
              all:
                summary: Request all eligible drivers now
                value:
                  mode: "ALL"
              specific:
                summary: Request a specific driver (if eligible)
                value:
                  mode: "SPECIFIC"
                  driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
              list:
                summary: Request a list of drivers (eligible only)
                value:
                  mode: "LIST"
                  driverIds:
                    - "779a77f6-5704-4b00-8561-2892c58946a2"
                    - "660e8400-e29b-41d4-a716-446655440000"
      responses:
        "200":
          description: Trip offers requested
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RequestTripDriversResponse"
              example:
                data:
                  requested: 5
        "400":
          description: Bad request - invalid UUID or invalid mode payload
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                invalidTripId:
                  summary: Invalid trip ID format
                  value:
                    error: "Invalid Trip ID format. Expected UUID."
                missingDriverIdForSpecific:
                  summary: Missing driverId for SPECIFIC mode
                  value:
                    error: "driverId is required when mode is SPECIFIC"
                missingDriverIdsForList:
                  summary: Missing driverIds for LIST mode
                  value:
                    error: "driverIds is required when mode is LIST"
        "401":
          description: Not authenticated (missing or invalid token)
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trips/{id}/driver-accept:
    patch:
      summary: Driver accepts a trip
      description: |
        Driver accepts a trip that has been assigned to them.
        
        **Prerequisites:**
        - Trip must be in ASSIGNED status
        - Trip must be assigned to the driver making the request
        
        **Status Change:**
        - ASSIGNED → DRIVER_ACCEPTED
        
        **Request Body:**
        - `driverId` (required): Driver UUID (can also be passed as query parameter)
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip UUID
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
        - name: driverId
          in: query
          required: false
          description: Driver UUID (alternative to body parameter)
          schema:
            type: string
            format: uuid
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                driverId:
                  type: string
                  format: uuid
                  description: Driver UUID
                  example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        "200":
          description: Trip accepted by driver
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/TripResponse"
        "400":
          description: Bad request - missing driverId or invalid trip status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "403":
          description: Forbidden - trip not assigned to this driver
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trips/{id}/driver-reject:
    patch:
      summary: Driver rejects a trip
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                driverId:
                  type: integer
              required:
                - driverId
      responses:
        "200":
          description: Trip rejected by driver
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TripResponse"
        "401":
          description: Not authenticated (missing or invalid token)

  /trips/{id}/start-initiate:
    post:
      summary: Initiate trip start (Generate token and send OTP)
      description: |
        Initiate the trip start process by providing odometer reading and car images.
        
        **Trip ID** is taken from the URL path (`/trips/{id}/start-initiate`). Driver and franchise are derived from the trip; do not send them in the body.
        
        This endpoint:
        - Validates trip exists and has a driver assigned
        - Generates a 4-digit OTP
        - Sends OTP to customer via email (if customer email is available)
        - Generates a secure JWT token for verification
        - Stores odometer reading and car images temporarily
        - Returns token that must be used with OTP to complete trip start
        
        **Prerequisites:**
        - Trip must be in ASSIGNED or DRIVER_ACCEPTED status
        - Trip must have a driver assigned
        
        **Flow:**
        1. Driver calls this endpoint with odometer and images (trip ID in URL)
        2. System generates OTP and sends to customer via email
        3. System returns token to driver
        4. Customer receives OTP via email and provides it to driver
        5. Driver calls `/trips/{id}/start-verify` with token and OTP (received from customer)
        6. System verifies and starts the trip
        
        **Note:** OTP is sent to customer's email address. If customer email is not available, the OTP will still be generated and returned in the response message (for manual sharing).
        
        **Status Change:**
        - No status change in this step (trip remains ASSIGNED/DRIVER_ACCEPTED)
        - Trip status changes to TRIP_STARTED only after verification
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip ID (UUID)
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InitiateStartTripRequest"
            example:
              odometerValue: 12345.5
              odometerPic: "https://example.com/images/odometer.jpg"
              carFrontPic: "https://example.com/images/car-front.jpg"
              carBackPic: "https://example.com/images/car-back.jpg"
      responses:
        "200":
          description: Token generated and OTP sent to customer successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                        description: JWT token for OTP verification (expires in 10 minutes)
                        example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      tripId:
                        type: string
                        format: uuid
                        description: Trip ID
                        example: "550e8400-e29b-41d4-a716-446655440000"
                      message:
                        type: string
                        description: Success message
                        example: "OTP sent to customer via email. Please verify with token and OTP to start trip."
                      emailSent:
                        type: boolean
                        description: Whether OTP email was successfully sent to customer
                        example: true
              example:
                data:
                  token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0cmlwSWQiOiI1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAiLCJkcml2ZXJJZCI6Ijc3OWE3N2Y2LTU3MDQtNGIwMC04NTYxLTI4OTJjNTg5NDZhMiIsImZyYW5jaGlzZUlkIjoiNjYwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAxIiwidHlwZSI6InRyaXAtc3RhcnQtdmVyaWZpY2F0aW9uIiwiaWF0IjoxNzA2MDAwMDAwfQ.signature"
                  tripId: "550e8400-e29b-41d4-a716-446655440000"
                  message: "OTP sent to customer via email. Please verify with token and OTP to start trip."
                  emailSent: true
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                missingOdometerValue:
                  summary: Missing odometer value
                  value:
                    error: "odometerValue is required"
                invalidTripStatus:
                  summary: Invalid trip status
                  value:
                    error: "Trip is not in a valid status for starting. Current status: COMPLETED"
                tripNoDriver:
                  summary: Trip has no driver assigned
                  value:
                    error: "Trip has no driver assigned"
        "401":
          description: Not authenticated (missing or invalid token)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trips/{id}/start-verify:
    post:
      summary: Verify token and OTP, then start trip
      description: |
        Verify the token and OTP received from the customer, then start the trip.
        
        This endpoint:
        - Verifies the JWT token (must be valid and not expired)
        - Validates the OTP matches the one sent to customer
        - Updates trip status to TRIP_STARTED
        - Updates driver status to ON_TRIP
        - Clears the OTP after successful verification
        
        **Prerequisites:**
        - Must have called `/trips/{id}/start-initiate` first
        - Token must be valid and not expired (10 minutes validity)
        - OTP must match the one sent to customer
        - Trip must still be in ASSIGNED or DRIVER_ACCEPTED status
        
        **Status Change:**
        - ASSIGNED/DRIVER_ACCEPTED → TRIP_STARTED
        - Driver trip status → ON_TRIP
        
        **Flow:**
        1. Driver receives token from `/trips/{id}/start-initiate`
        2. Customer receives OTP via email
        3. Customer provides OTP to driver
        4. Driver calls this endpoint with token and OTP
        5. System verifies and starts the trip
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip ID (UUID)
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VerifyStartTripRequest"
            example:
              token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
              otp: "1234"
      responses:
        "200":
          description: Trip started successfully after verification
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Trip"
              example:
                data:
                  id: "550e8400-e29b-41d4-a716-446655440000"
                  franchiseId: "660e8400-e29b-41d4-a716-446655440001"
                  driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
                  status: "TRIP_STARTED"
                  startedAt: "2024-01-20T14:30:00Z"
                  startOdometer: 12345.5
                  carImageFront: "https://example.com/images/car-front.jpg"
                  carImageBack: "https://example.com/images/car-back.jpg"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                missingToken:
                  summary: Missing token
                  value:
                    error: "token is required"
                missingOtp:
                  summary: Missing OTP
                  value:
                    error: "otp is required"
                invalidOtp:
                  summary: Invalid OTP
                  value:
                    error: "Invalid OTP"
                invalidToken:
                  summary: Invalid token
                  value:
                    error: "Invalid or expired token"
                tokenTripMismatch:
                  summary: Token trip ID mismatch
                  value:
                    error: "Token trip ID does not match"
                tripStatusChanged:
                  summary: Trip status changed
                  value:
                    error: "Trip status has changed. Current status: TRIP_STARTED"
        "401":
          description: Not authenticated or invalid/expired token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trips/{id}/end-initiate:
    post:
      summary: Initiate trip end (Generate token and send OTP)
      description: |
        Initiate the trip end process by providing odometer reading and image.
        
        **Trip ID** is taken from the URL path (`/trips/{id}/end-initiate`). Driver and franchise are derived from the trip; do not send them in the body.
        
        This endpoint:
        - Validates trip exists and has a driver assigned
        - Validates trip is in TRIP_STARTED/TRIP_PROGRESS/IN_PROGRESS status
        - Validates trip has been started and has start odometer reading
        - Generates a 4-digit OTP
        - Sends OTP to customer via email (if customer email is available)
        - Generates a secure JWT token for verification
        - Stores end odometer reading and odometer image temporarily
        - Returns token that must be used with OTP to complete trip end
        
        **Prerequisites:**
        - Trip must be in TRIP_STARTED, TRIP_PROGRESS, or IN_PROGRESS status
        - Trip must have a driver assigned
        - Trip must have been started (startedAt must exist)
        - Trip must have start odometer reading
        
        **Flow:**
        1. Driver calls this endpoint with odometer and image (trip ID in URL)
        2. System generates OTP and sends to customer via email
        3. System returns token to driver
        4. Customer receives OTP via email and provides it to driver
        5. Driver calls `/trips/{id}/end-verify` with token and OTP (received from customer)
        6. System verifies, calculates distance/time/amount, and ends the trip
        
        **Note:** OTP is sent to customer's email address. If customer email is not available, the OTP will still be generated and returned in the response message (for manual sharing).
        
        **Status Change:**
        - No status change in this step (trip remains TRIP_STARTED/TRIP_PROGRESS/IN_PROGRESS)
        - Trip status changes to TRIP_ENDED only after verification
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip UUID
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InitiateEndTripRequest"
            example:
              odometerValue: 12350.2
              odometerImage: "https://example.com/images/odometer-end.jpg"
      responses:
        "200":
          description: OTP generated and sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                        description: JWT token for verification (valid for 10 minutes)
                        example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0cmlwSWQiOiI1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAiLCJkcml2ZXJJZCI6Ijc3OWE3N2Y2LTU3MDQtNGIwMC04NTYxLTI4OTJjNTg5NDZhMiIsImZyYW5jaGlzZUlkIjoiNjYwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAxIiwidHlwZSI6InRyaXAtZW5kLXZlcmlmaWNhdGlvbiIsImlhdCI6MTcwNjAwMDAwMH0.signature"
                      tripId:
                        type: string
                        format: uuid
                        description: Trip ID
                        example: "550e8400-e29b-41d4-a716-446655440000"
                      message:
                        type: string
                        description: Success message
                        example: "OTP sent to customer via email. Please verify with token and OTP to end trip."
                      emailSent:
                        type: boolean
                        description: Whether OTP email was successfully sent to customer
                        example: true
              example:
                data:
                  token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0cmlwSWQiOiI1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAiLCJkcml2ZXJJZCI6Ijc3OWE3N2Y2LTU3MDQtNGIwMC04NTYxLTI4OTJjNTg5NDZhMiIsImZyYW5jaGlzZUlkIjoiNjYwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAxIiwidHlwZSI6InRyaXAtZW5kLXZlcmlmaWNhdGlvbiIsImlhdCI6MTcwNjAwMDAwMH0.signature"
                  tripId: "550e8400-e29b-41d4-a716-446655440000"
                  message: "OTP sent to customer via email. Please verify with token and OTP to end trip."
                  emailSent: true
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                missingOdometerValue:
                  summary: Missing odometerValue
                  value:
                    error: "odometerValue is required"
                missingOdometerImage:
                  summary: Missing odometerImage
                  value:
                    error: "odometerImage is required"
                tripNoDriver:
                  summary: Trip has no driver assigned
                  value:
                    error: "Trip has no driver assigned"
                invalidStatus:
                  summary: Trip not in valid status
                  value:
                    error: "Trip is not in a valid status for ending. Current status: TRIP_CREATED"
                tripNotStarted:
                  summary: Trip not started
                  value:
                    error: "Trip has not been started yet"
                missingStartOdometer:
                  summary: Start odometer missing
                  value:
                    error: "Start odometer reading is missing"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trips/{id}/end-verify:
    post:
      summary: Verify token and OTP, then calculate trip amount
      description: |
        Verify the token and OTP received from the customer, then calculate the final trip amount.
        
        **This endpoint:**
        - Verifies the JWT token and OTP
        - Calculates distance traveled (endOdometer - startOdometer)
        - Calculates time taken (endTime - startTime)
        - Gets trip type
        - Calculates trip amount based on trip type, distance, duration, and car type
        - Updates trip with calculated amount but keeps trip in progress
        - Returns calculated values
        
        **Important:** This endpoint does NOT end the trip. After calculation:
        1. Driver must collect payment using `/trips/{id}/collect-payment`
        2. Driver must verify payment using `/trips/{id}/verify-payment` to end the trip
        
        **Flow:**
        1. Driver receives token from `/trips/{id}/end-initiate`
        2. Customer receives OTP via email
        3. Customer provides OTP to driver
        4. Driver calls this endpoint with token and OTP
        5. System verifies, calculates distance/time/amount
        6. Driver collects payment using `/trips/{id}/collect-payment`
        7. Driver verifies payment using `/trips/{id}/verify-payment` to end trip
        
        **Calculations:**
        - **Distance:** `endOdometer - startOdometer` (in km)
        - **Time:** `endTime - startTime` (in hours and minutes)
        - **Amount:** Calculated using pricing service based on:
          - Trip type (CITY_ROUND, CITY_DROPOFF, LONG_ROUND, LONG_DROPOFF)
          - Distance traveled
          - Duration
          - Car type (PREMIUM, LUXURY, NORMAL)
        
        **Status Change:**
        - Trip remains in TRIP_PROGRESS status
        - Trip ends only after payment verification
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip UUID
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VerifyEndTripRequest"
            example:
              token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0cmlwSWQiOiI1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAiLCJkcml2ZXJJZCI6Ijc3OWE3N2Y2LTU3MDQtNGIwMC04NTYxLTI4OTJjNTg5NDZhMiIsImZyYW5jaGlzZUlkIjoiNjYwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAxIiwidHlwZSI6InRyaXAtZW5kLXZlcmlmaWNhdGlvbiIsImlhdCI6MTcwNjAwMDAwMH0.signature"
              otp: "5678"
      responses:
        "200":
          description: Trip ended successfully with calculated values
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    description: Trip end calculation results
                    properties:
                      totalAmount:
                        type: number
                        description: Total trip amount in rupees
                        example: 500
                      distanceTraveled:
                        type: number
                        description: Distance traveled in km (rounded to 2 decimal places)
                        example: 200
                      timeTakenHours:
                        type: number
                        description: Time taken in hours (rounded to 2 decimal places)
                        example: 0.3
                      timeTakenMinutes:
                        type: number
                        description: Time taken in minutes (rounded to 2 decimal places)
                        example: 17.79
                      tripType:
                        type: string
                        enum: [CITY_ROUND, CITY_DROPOFF, LONG_ROUND, LONG_DROPOFF]
                        description: Trip type
                        example: "CITY_DROPOFF"
                      calculatedAmount:
                        type: number
                        description: Calculated trip amount in rupees
                        example: 500
              example:
                data:
                  totalAmount: 500
                  distanceTraveled: 200
                  timeTakenHours: 0.3
                  timeTakenMinutes: 17.79
                  tripType: "CITY_DROPOFF"
                  calculatedAmount: 500
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                missingToken:
                  summary: Missing token
                  value:
                    error: "token is required"
                missingOtp:
                  summary: Missing OTP
                  value:
                    error: "otp is required"
                invalidOtp:
                  summary: Invalid OTP
                  value:
                    error: "Invalid OTP"
                invalidToken:
                  summary: Invalid token
                  value:
                    error: "Invalid or expired token"
                tokenTripMismatch:
                  summary: Token trip ID mismatch
                  value:
                    error: "Token trip ID does not match"
                tripStatusChanged:
                  summary: Trip status changed
                  value:
                    error: "Trip status has changed. Current status: TRIP_ENDED"
                missingStartTime:
                  summary: Trip start time missing
                  value:
                    error: "Trip start time is missing"
                missingStartOdometer:
                  summary: Start odometer missing
                  value:
                    error: "Start odometer reading is missing"
                missingEndOdometer:
                  summary: End odometer missing
                  value:
                    error: "End odometer reading is missing"
                invalidOdometer:
                  summary: Invalid odometer reading
                  value:
                    error: "End odometer reading cannot be less than start odometer reading"
        "401":
          description: Not authenticated or invalid/expired token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trips/{id}/collect-payment:
    post:
      summary: Collect payment information from customer
      description: |
        Collect payment information from customer. Supports UPI, Cash, or both payment methods.
        
        **Payment Methods:**
        - `UPI`: Customer pays via UPI (requires upiAmount and optional upiReference)
        - `CASH`: Customer pays in cash (requires cashAmount)
        - `BOTH`: Customer pays partially via UPI and partially in cash (requires both upiAmount and cashAmount)
        
        **Validation:**
        - Payment amount must match the trip's calculated amount
        - Trip must be in TRIP_PROGRESS, TRIP_STARTED, or IN_PROGRESS status
        - Trip must be assigned to the specified driver
        
        **After Payment Collection:**
        - Payment status is set to COMPLETED
        - Trip remains in progress until payment is verified
        - Driver must call `/trips/{id}/verify-payment` to end the trip
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip UUID
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CollectPaymentRequest"
            examples:
              upiOnly:
                summary: UPI payment only
                value:
                  driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
                  paymentMethod: "UPI"
                  upiAmount: 500
                  upiReference: "TXN123456789"
              cashOnly:
                summary: Cash payment only
                value:
                  driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
                  paymentMethod: "CASH"
                  cashAmount: 500
              both:
                summary: Split payment (UPI + Cash)
                value:
                  driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
                  paymentMethod: "BOTH"
                  upiAmount: 300
                  cashAmount: 200
                  upiReference: "TXN123456789"
      responses:
        "200":
          description: Payment collected successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      tripId:
                        type: string
                        format: uuid
                        example: "550e8400-e29b-41d4-a716-446655440000"
                      paymentMethod:
                        type: string
                        enum: [UPI, CASH, BOTH]
                        example: "BOTH"
                      totalPaid:
                        type: number
                        description: Total amount paid
                        example: 500
                      upiAmount:
                        type: number
                        nullable: true
                        description: Amount paid via UPI (if applicable)
                        example: 300
                      cashAmount:
                        type: number
                        nullable: true
                        description: Amount paid in cash (if applicable)
                        example: 200
                      paymentStatus:
                        type: string
                        example: "COMPLETED"
                      message:
                        type: string
                        example: "Payment collected successfully. Please verify payment to end trip."
              example:
                data:
                  tripId: "550e8400-e29b-41d4-a716-446655440000"
                  paymentMethod: "BOTH"
                  totalPaid: 500
                  upiAmount: 300
                  cashAmount: 200
                  paymentStatus: "COMPLETED"
                  message: "Payment collected successfully. Please verify payment to end trip."
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                missingDriverId:
                  summary: Missing driverId
                  value:
                    error: "driverId is required"
                missingPaymentMethod:
                  summary: Missing paymentMethod
                  value:
                    error: "paymentMethod is required. Must be UPI, CASH, or BOTH"
                invalidPaymentMethod:
                  summary: Invalid paymentMethod
                  value:
                    error: "Invalid paymentMethod. Must be UPI, CASH, or BOTH"
                missingUpiAmount:
                  summary: Missing UPI amount
                  value:
                    error: "UPI amount is required and must be greater than 0"
                missingCashAmount:
                  summary: Missing cash amount
                  value:
                    error: "Cash amount is required and must be greater than 0"
                amountMismatch:
                  summary: Payment amount mismatch
                  value:
                    error: "Payment amount (450) does not match trip amount (500)"
        "401":
          description: Not authenticated (missing or invalid token)
        "403":
          description: Forbidden - trip not assigned to this driver
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trips/{id}/verify-payment:
    post:
      summary: Verify payment and end trip
      description: |
        Verify that payment has been collected and end the trip. Sends confirmation email to customer with review form.
        
        **Prerequisites:**
        - Payment must have been collected (paymentStatus = COMPLETED)
        - Trip must be in TRIP_PROGRESS, TRIP_STARTED, or IN_PROGRESS status
        - Trip must be assigned to the specified driver
        
        **After Verification:**
        - Trip status changes to TRIP_ENDED
        - Driver status changes to AVAILABLE
        - Confirmation email sent to customer with review form link
        - Customer can rate driver, trip, and Drybros experience
        
        **Email Includes:**
        - Trip summary (trip ID, driver, pickup/drop locations, duration, amount)
        - Review form link for customer feedback
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip UUID
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                driverId:
                  type: string
                  format: uuid
                  description: Driver ID (UUID)
                  example: "779a77f6-5704-4b00-8561-2892c58946a2"
              required:
                - driverId
            example:
              driverId: "779a77f6-5704-4b00-8561-2892c58946a2"
      responses:
        "200":
          description: Payment verified and trip ended successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      tripId:
                        type: string
                        format: uuid
                        example: "550e8400-e29b-41d4-a716-446655440000"
                      status:
                        type: string
                        example: "TRIP_ENDED"
                      message:
                        type: string
                        example: "Trip ended successfully. Confirmation email sent to customer."
                      emailSent:
                        type: boolean
                        description: Whether confirmation email was sent
                        example: true
              example:
                data:
                  tripId: "550e8400-e29b-41d4-a716-446655440000"
                  status: "TRIP_ENDED"
                  message: "Trip ended successfully. Confirmation email sent to customer."
                  emailSent: true
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                missingDriverId:
                  summary: Missing driverId
                  value:
                    error: "driverId is required"
                paymentNotCompleted:
                  summary: Payment not completed
                  value:
                    error: "Payment not completed. Please collect payment first."
                invalidStatus:
                  summary: Invalid trip status
                  value:
                    error: "Trip is not in a valid status for ending. Current status: TRIP_ENDED"
        "401":
          description: Not authenticated (missing or invalid token)
        "403":
          description: Forbidden - trip not assigned to this driver
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trips/{id}/history:
    get:
      summary: Get trip history for driver
      description: |
        Get complete trip history with timeline of all events for a specific trip.
        
        **Returns:**
        - Trip summary (status, payment info, customer details)
        - **Late detection:** When trip has `scheduledAt` and `startedAt` > `scheduledAt`, `startedLate` is true and `lateByMinutes` gives minutes late; a `trip_started_late` timeline event is included.
        - Chronological timeline of all events:
          - Trip Created
          - Request Accepted
          - Trip Started
          - Started Late (when driver started after scheduled time)
          - Trip On Progress
          - Trip End Initiated
          - Trip Ended
          - Payment Initiated
          - Payment Completed
        
        **Event Types:**
        - `trip_created`: Trip was created
        - `request_accepted`: Driver accepted the trip request
        - `trip_started`: Trip started successfully
        - `trip_started_late`: Driver started the trip after scheduled time (includes `lateByMinutes` in metadata)
        - `trip_on_progress`: Trip is in progress
        - `trip_end_initiated`: Trip end process initiated
        - `trip_ended`: Trip ended successfully
        - `payment_initiated`: Payment collected
        - `payment_end`: Payment verified and trip completed
        
        **Authentication:**
        - Driver can access their own trip history
        - driverId can be provided in query/body or extracted from auth token
      tags:
        - Trips
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip UUID
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
        - name: driverId
          in: query
          required: false
          description: Driver UUID (optional if authenticated as driver)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Trip history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      tripId:
                        type: string
                        format: uuid
                        example: "550e8400-e29b-41d4-a716-446655440000"
                      tripStatus:
                        type: string
                        example: "TRIP_ENDED"
                      paymentStatus:
                        type: string
                        example: "COMPLETED"
                      paymentMode:
                        type: string
                        nullable: true
                        example: "UPI"
                      totalAmount:
                        type: number
                        example: 500
                      finalAmount:
                        type: number
                        example: 500
                      customerName:
                        type: string
                        example: "John Doe"
                      pickupAddress:
                        type: string
                        example: "123 Main St, City"
                      dropAddress:
                        type: string
                        nullable: true
                        example: "456 Oak Ave, City"
                      scheduledAt:
                        type: string
                        format: date-time
                        nullable: true
                        description: Scheduled trip start time
                        example: "2026-01-25T06:30:00Z"
                      startedAt:
                        type: string
                        format: date-time
                        nullable: true
                        example: "2024-01-20T14:30:00Z"
                      endedAt:
                        type: string
                        format: date-time
                        nullable: true
                        example: "2024-01-20T17:00:00Z"
                      startedLate:
                        type: boolean
                        description: True when trip was started after scheduled time
                        example: true
                      lateByMinutes:
                        type: integer
                        nullable: true
                        description: Minutes late (startedAt - scheduledAt) when startedLate is true
                        example: 7
                      timeline:
                        type: array
                        description: Chronological timeline of trip events
                        items:
                          type: object
                          properties:
                            eventType:
                              type: string
                              description: Event type identifier
                              example: "trip_started"
                            eventName:
                              type: string
                              description: Human-readable event name
                              example: "Trip Started"
                            description:
                              type: string
                              description: Event description
                              example: "Trip started successfully"
                            timestamp:
                              type: string
                              format: date-time
                              description: When the event occurred
                              example: "2024-01-20T14:30:00Z"
                            metadata:
                              type: object
                              nullable: true
                              description: Additional event metadata
              example:
                data:
                  tripId: "550e8400-e29b-41d4-a716-446655440000"
                  tripStatus: "TRIP_ENDED"
                  paymentStatus: "COMPLETED"
                  paymentMode: "UPI"
                  totalAmount: 500
                  finalAmount: 500
                  customerName: "John Doe"
                  pickupAddress: "123 Main St, City"
                  dropAddress: "456 Oak Ave, City"
                  startedAt: "2024-01-20T14:30:00Z"
                  endedAt: "2024-01-20T17:00:00Z"
                  timeline:
                    - eventType: "trip_created"
                      eventName: "Trip Created"
                      description: "Trip was created"
                      timestamp: "2024-01-20T10:00:00Z"
                    - eventType: "request_accepted"
                      eventName: "Request Accepted"
                      description: "Driver accepted the trip request"
                      timestamp: "2024-01-20T10:15:00Z"
                    - eventType: "trip_started"
                      eventName: "Trip Started"
                      description: "Trip started successfully"
                      timestamp: "2024-01-20T14:30:00Z"
                    - eventType: "trip_on_progress"
                      eventName: "Trip On Progress"
                      description: "Trip is in progress"
                      timestamp: "2024-01-20T15:00:00Z"
                    - eventType: "trip_end_initiated"
                      eventName: "Trip End Initiated"
                      description: "Trip end process initiated"
                      timestamp: "2024-01-20T16:45:00Z"
                    - eventType: "payment_initiated"
                      eventName: "Payment Initiated"
                      description: "Payment collected via UPI"
                      timestamp: "2024-01-20T16:50:00Z"
                    - eventType: "payment_end"
                      eventName: "Payment Completed"
                      description: "Payment verified and trip completed"
                      timestamp: "2024-01-20T17:00:00Z"
                    - eventType: "trip_ended"
                      eventName: "Trip Ended"
                      description: "Trip ended successfully"
                      timestamp: "2024-01-20T17:00:00Z"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                missingDriverId:
                  summary: Missing driverId
                  value:
                    error: "driverId is required"
        "401":
          description: Not authenticated (missing or invalid token)
        "403":
          description: Forbidden - trip not assigned to this driver
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Trip not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /trip-types:
    get:
      summary: List all trip types (with optional pagination)
      description: |
        Get all active trip type configurations. Supports optional pagination via query parameters.
        
        **Query Parameters:**
        - `page` (optional): Page number (default: 1)
        - `limit` (optional): Number of items per page (default: 10, max: 100)
        
        **Without pagination parameters:** Returns all trip types (backward compatible)
        
        **With pagination parameters:** Returns paginated results with metadata
      tags:
        - Trip Types
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          description: Page number (default: 1)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          description: Number of items per page (default: 10, max: 100)
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        "200":
          description: List of trip types (paginated or all)
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    description: Paginated response (when page/limit provided)
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/TripTypeConfig"
                      pagination:
                        $ref: "#/components/schemas/PaginationMeta"
                  - type: object
                    description: All trip types (when no pagination params)
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/TripTypeConfig"
              examples:
                paginated:
                  summary: Paginated response
                  value:
                    data:
                      - id: "550e8400-e29b-41d4-a716-446655440000"
                        name: "City Round Trip"
                        specialPrice: false
                        basePrice: 400
                        baseHour: 3
                        extraPerHour: 100
                        extraPerHalfHour: 50
                        status: "ACTIVE"
                      - id: "660e8400-e29b-41d4-a716-446655440001"
                        name: "Long Round"
                        specialPrice: true
                        basePrice: null
                        baseHour: null
                        extraPerHour: null
                        distanceSlabs:
                          - from: 0
                            to: 50
                            price: 1000
                          - from: 51
                            to: 100
                            price: 1500
                          - from: 101
                            to: null
                            price: 2000
                        status: "ACTIVE"
                    pagination:
                      page: 1
                      limit: 10
                      total: 4
                      totalPages: 1
                      hasNext: false
                      hasPrev: false
                all:
                  summary: All trip types (no pagination)
                  value:
                    data:
                      - id: "550e8400-e29b-41d4-a716-446655440000"
                        name: "CITY_ROUND"
                        specialPrice: false
                        basePrice: 400
                        baseHour: 3
                        extraPerHour: 100
                      - id: "660e8400-e29b-41d4-a716-446655440001"
                        name: "LONG_ROUND"
                        specialPrice: true
                        basePrice: null
                        baseHour: null
                        extraPerHour: null
                        distanceSlabs:
                          - from: 0
                            to: 50
                            price: 1000
                          - from: 51
                            to: null
                            price: 1500
        "400":
          description: Bad request - invalid pagination parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
    post:
      summary: Create a new trip type
      description: |
        Create a new trip type configuration. Only ADMIN and MANAGER roles can create trip types.
        
        **Two Pricing Modes:**
        
        1. **Standard Pricing** (`specialPrice: false` or omitted):
           - **Required:** `name`, `basePrice`, `baseHour`, `extraPerHour`
           - Time-based pricing with predefined rates
           - Example: "City Round Trip" with base price ₹400 for 3 hours, ₹100 per extra hour
        
        2. **Special Pricing** (`specialPrice: true`):
           - **Required:** `name`, `distanceSlabs` (array of distance-based price slabs)
           - **NOT Required:** `basePrice`, `baseHour`, `extraPerHour`
           - Distance-based slab pricing (driver-negotiable)
           - Example: "Long Round" with slabs: 0-50km = ₹1000, 51-100km = ₹1500, 101km+ = ₹2000
        
        **Optional Fields (both modes):**
        - `extraPerHalfHour`: Extra charge for 30 minutes (standard mode only)
        - `distance`: Base distance in km
        - `description`: Description of the trip type
        - `distanceScopeId`: Distance scope ID (default will be created if not provided)
        - `tripPatternId`: Trip pattern ID (default will be created if not provided)
      tags:
        - Trip Types
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTripTypeRequest"
            examples:
              standardPricing:
                summary: Standard pricing trip type
                value:
                  name: "City Round Trip"
                  specialPrice: false
                  basePrice: 400
                  baseHour: 3
                  distance: 20
                  extraPerHour: 100
                  extraPerHalfHour: 50
                  description: "City round trip pricing"
              specialPricing:
                summary: Special pricing (slab-based) trip type
                value:
                  name: "Long Round"
                  specialPrice: true
                  distanceSlabs:
                    - from: 0
                      to: 50
                      price: 1000
                    - from: 51
                      to: 100
                      price: 1500
                    - from: 101
                      to: null
                      price: 2000
                  description: "Long round trip with distance-based slab pricing"
      responses:
        "201":
          description: Trip type created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/TripTypeConfig"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                emptyName:
                  summary: Empty trip type name
                  value:
                    error: "Trip type name is required and cannot be empty"
                duplicateTripType:
                  summary: Trip type already exists
                  value:
                    error: "Trip type configuration already exists for: City Round Trip"
                invalidPrice:
                  summary: Invalid price
                  value:
                    error: "Base price must be a positive number"
                missingStandardFields:
                  summary: Missing required fields for standard pricing
                  value:
                    error: "basePrice is required when specialPrice is false"
                missingSlabs:
                  summary: Missing distanceSlabs for special pricing
                  value:
                    error: "distanceSlabs is required when specialPrice is true"
                invalidSlab:
                  summary: Invalid slab format
                  value:
                    error: "Slab 'to' distance must be greater than or equal to 'from'"
        "401":
          description: Not authenticated (missing or invalid token)
        "403":
          description: Forbidden - insufficient permissions (only ADMIN and MANAGER can create)

  /trip-types/{id}:
    get:
      summary: Get trip type by ID
      description: |
        Get a specific trip type configuration by its ID.
        Any authenticated user can view trip types.
      tags:
        - Trip Types
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip type ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Trip type retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/TripTypeConfig"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Trip type not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      summary: Update trip type
      description: |
        Update an existing trip type configuration.
        Only ADMIN and MANAGER roles can update trip types.
        All fields are optional - only provide the fields you want to update.
        
        **Note:** When updating `specialPrice` mode, ensure required fields are provided:
        - If switching to `specialPrice = true`, provide `distanceSlabs`
        - If switching to `specialPrice = false`, provide `basePrice`, `baseHour`, `extraPerHour`
      tags:
        - Trip Types
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip type ID (UUID)
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateTripTypeRequest"
            examples:
              updateStandardPricing:
                summary: Update standard pricing fields
                value:
                  basePrice: 450
                  baseHour: 3
                  distance: 25
                  extraPerHour: 120
                  extraPerHalfHour: 60
              updateSpecialPricing:
                summary: Update special pricing (slab-based)
                value:
                  specialPrice: true
                  distanceSlabs:
                    - from: 0
                      to: 50
                      price: 1200
                    - from: 51
                      to: 100
                      price: 1800
                    - from: 101
                      to: null
                      price: 2500
              switchToSpecialPricing:
                summary: Switch from standard to special pricing
                value:
                  specialPrice: true
                  distanceSlabs:
                    - from: 0
                      to: 50
                      price: 1000
                    - from: 51
                      to: null
                      price: 1500
                  basePrice: null
                  baseHour: null
                  extraPerHour: null
      responses:
        "200":
          description: Trip type updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/TripTypeConfig"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "403":
          description: Forbidden - insufficient permissions
        "404":
          description: Trip type not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      summary: Delete trip type
      description: |
        Soft delete a trip type by setting its status to INACTIVE.
        Only ADMIN and MANAGER roles can delete trip types.
      tags:
        - Trip Types
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Trip type ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Trip type deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Trip type deleted successfully"
        "401":
          description: Not authenticated (missing or invalid token)
        "403":
          description: Forbidden - insufficient permissions
        "404":
          description: Trip type not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /complaints:
    get:
      summary: List complaints
      description: |
        Get a list of complaints with optional pagination and filters.
        
        **Query Parameters:**
        - `page` (optional): Page number (default: 1)
        - `limit` (optional): Number of items per page (default: 10, max: 100)
        - `driverId` (optional): Filter by driver ID
        - `staffId` (optional): Filter by staff ID
        - `status` (optional): Filter by status (OPEN, IN_PROGRESS, RESOLVED, CLOSED)
        
        **Without pagination parameters:** Returns all complaints
      tags:
        - Complaints
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: driverId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: staffId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          required: false
          schema:
            type: string
            enum: [OPEN, IN_PROGRESS, RESOLVED, CLOSED]
      responses:
        "200":
          description: List of complaints
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/PaginatedComplaintResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Complaint"
        "401":
          description: Not authenticated (missing or invalid token)
    post:
      summary: Create a complaint
      description: |
        Create a new complaint for a driver or staff member.
        
        **Note:** Either `driverId` or `staffId` must be provided, but not both.
      tags:
        - Complaints
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateComplaintRequest"
      responses:
        "201":
          description: Complaint created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Complaint created successfully"
                  data:
                    $ref: "#/components/schemas/Complaint"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)

  /complaints/{id}:
    get:
      summary: Get complaint by ID
      tags:
        - Complaints
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Complaint retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Complaint"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Complaint not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    patch:
      summary: Update complaint status
      description: |
        Update the status of a complaint. Status values: **OPEN** (pending), **IN_PROGRESS** (on process), **RESOLVED**, **CLOSED**.
        When **status** is **RESOLVED**, you must provide **action** (WARNING or FIRE) and **reason**.
        - **WARNING**: Issue warning to driver/staff. If they already have 2+ warnings, they are auto-fired.
        - **FIRE**: Terminate driver (status=TERMINATED, blacklisted=true) or staff (status=FIRED). Fired/blacklisted cannot login or register.
        Resolved complaints include **resolutionAction** and **resolutionReason** in the response.
      tags:
        - Complaints
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateComplaintStatusRequest"
      responses:
        "200":
          description: Complaint status updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Complaint status updated successfully"
                  data:
                    $ref: "#/components/schemas/Complaint"
        "400":
          description: Bad request - validation error
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Complaint not found

  /attendance:
    get:
      summary: List attendance records
      description: |
        Get a list of attendance records with optional pagination and filters.
        
        **Query Parameters:**
        - `page` (optional): Page number (default: 1)
        - `limit` (optional): Number of items per page (default: 10, max: 100)
        - `driverId` (optional): Filter by driver ID
        - `staffId` (optional): Filter by staff ID
        - `userId` (optional): Filter by user ID (for managers)
        - `startDate` (optional): Filter by start date (ISO 8601)
        - `endDate` (optional): Filter by end date (ISO 8601)
      tags:
        - Attendance
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: driverId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: staffId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: userId
          in: query
          required: false
          description: Filter by user ID (for managers)
          schema:
            type: string
            format: uuid
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
      responses:
        "200":
          description: List of attendance records
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/PaginatedAttendanceResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Attendance"
        "401":
          description: Not authenticated (missing or invalid token)
    post:
      summary: Create attendance record
      description: |
        Create a new attendance record manually. This endpoint allows creating attendance records with all fields.
        
        **Note:** Exactly one of `driverId`, `staffId`, or `userId` must be provided.
        - `driverId`: For drivers
        - `staffId`: For staff members
        - `userId`: For managers (User table)
        
        **Fields:**
        - `date`: Date for the attendance record (required)
        - `loginTime`: Time when user logged in (optional)
        - `clockIn`: Time when user clocked in (optional)
        - `clockOut`: Time when user clocked out (optional)
        - `status`: Attendance status (PRESENT, ABSENT, LATE, HALF_DAY, ON_LEAVE) - defaults to PRESENT
        - `notes`: Optional notes (max 500 characters)
      tags:
        - Attendance
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAttendanceRequest"
      responses:
        "201":
          description: Attendance record created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Attendance record created successfully"
                  data:
                    $ref: "#/components/schemas/Attendance"
        "400":
          description: Bad request - validation error or attendance already exists for this date
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Driver/Staff/User not found

  /attendance/clock-in:
    post:
      summary: Clock in
      description: |
        Record clock in for a driver, staff member, or manager.
        
        Provide `id` (UUID) — the driver, staff, or manager ID. No note is required.
        Clock-in is blocked only when there is an **open session** (already clocked in and not clocked out yet).
      tags:
        - Attendance
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ClockInRequest"
      responses:
        "201":
          description: Clocked in successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Clocked in successfully"
                  data:
                    $ref: "#/components/schemas/ClockAttendanceResponse"
        "400":
          description: Bad request - validation error or already clocked in
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)

  /attendance/clock-out:
    post:
      summary: Clock out
      description: |
        Record clock out for a driver, staff member, or manager.
        
        Provide `id` (UUID) — the driver, staff, or manager ID.
        
        You must clock in before clocking out.
      tags:
        - Attendance
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ClockOutRequest"
      responses:
        "200":
          description: Clocked out successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Clocked out successfully"
                  data:
                    $ref: "#/components/schemas/ClockAttendanceResponse"
        "400":
          description: Bad request - validation error or not clocked in
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)

  /attendance/{id}:
    get:
      summary: Get attendance record by ID
      description: Retrieve a single attendance record by its ID.
      tags:
        - Attendance
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Attendance record ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Attendance record retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Attendance"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Attendance record not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      summary: Update attendance record
      description: |
        Update an existing attendance record. All fields are optional - only provide the fields you want to update.
        
        **Note:** You can update loginTime, clockIn, clockOut, status, and notes.
      tags:
        - Attendance
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Attendance record ID (UUID)
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateAttendanceRequest"
      responses:
        "200":
          description: Attendance record updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Attendance record updated successfully"
                  data:
                    $ref: "#/components/schemas/Attendance"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Attendance record not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      summary: Delete attendance record
      description: Permanently delete an attendance record.
      tags:
        - Attendance
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Attendance record ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Attendance record deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Attendance record deleted successfully"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Attendance record not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /attendance/{id}/status:
    patch:
      summary: Update attendance status
      description: |
        Update the status of an attendance record with an optional description.
        
        This endpoint is specifically designed for updating attendance status and allows you to provide a description explaining the status change.
      tags:
        - Attendance
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Attendance record ID (UUID)
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateAttendanceStatusRequest"
      responses:
        "200":
          description: Attendance status updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Attendance status updated successfully"
                  data:
                    $ref: "#/components/schemas/Attendance"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Attendance record not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /leave-requests:
    get:
      summary: List leave requests
      description: |
        Get a list of leave requests with optional pagination and filters.
        
        **Query Parameters:**
        - `page` (optional): Page number (default: 1)
        - `limit` (optional): Number of items per page (default: 10, max: 100)
        - `driverId` (optional): Filter by driver ID
        - `staffId` (optional): Filter by staff ID
        - `status` (optional): Filter by status (PENDING, APPROVED, REJECTED, CANCELLED)
        - `startDate` (optional): Filter by start date (ISO 8601)
        - `endDate` (optional): Filter by end date (ISO 8601)
      tags:
        - Leave Requests
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: driverId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: staffId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          required: false
          schema:
            type: string
            enum: [PENDING, APPROVED, REJECTED, CANCELLED]
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
      responses:
        "200":
          description: List of leave requests
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/PaginatedLeaveRequestResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/LeaveRequest"
        "401":
          description: Not authenticated (missing or invalid token)
    post:
      summary: Create a leave request
      description: |
        Create a new leave request for a driver or staff member.
        
        **Note:** Either `driverId` or `staffId` must be provided, but not both.
        End date must be after or equal to start date.
      tags:
        - Leave Requests
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateLeaveRequestRequest"
      responses:
        "201":
          description: Leave request created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Leave request created successfully"
                  data:
                    $ref: "#/components/schemas/LeaveRequest"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Not authenticated (missing or invalid token)

  /leave-requests/{id}:
    get:
      summary: Get leave request by ID
      tags:
        - Leave Requests
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Leave request retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/LeaveRequest"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Leave request not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    patch:
      summary: Update leave request status
      description: |
        Update the status of a leave request (APPROVED, REJECTED, CANCELLED).
        When rejecting, you can optionally provide a rejection reason.
      tags:
        - Leave Requests
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateLeaveRequestStatusRequest"
      responses:
        "200":
          description: Leave request status updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Leave request status updated successfully"
                  data:
                    $ref: "#/components/schemas/LeaveRequest"
        "400":
          description: Bad request - validation error
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Leave request not found

  /ratings/public:
    post:
      summary: Submit driver rating (Public - No Authentication)
      description: |
        Submit a driver rating from a customer. This endpoint does not require authentication.
        
        **Rating Fields:**
        - `overallRating`: Overall rating (1-5)
        - `drivingSafety`: Safety rating (1-5)
        - `drivingSmoothness`: Smoothness rating (1-5)
        - `behaviorPoliteness`: Politeness rating (1-5)
        - `experience`: Optional text feedback about the experience
        
        **Note:** If `tripId` is provided, only one rating per trip is allowed.
        The driver's average rating will be automatically updated.
      tags:
        - Driver Ratings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDriverRatingRequest"
            example:
              driverId: "550e8400-e29b-41d4-a716-446655440000"
              tripId: "660e8400-e29b-41d4-a716-446655440001"
              customerName: "John Doe"
              customerPhone: "+1234567890"
              customerEmail: "john.doe@example.com"
              overallRating: 4.5
              experience: "Great driver, very professional and safe"
              drivingSafety: 5
              drivingSmoothness: 4
              behaviorPoliteness: 5
      responses:
        "201":
          description: Rating submitted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Rating submitted successfully"
                  data:
                    $ref: "#/components/schemas/DriverRating"
        "400":
          description: Bad request - validation error or rating already exists
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Driver or trip not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /ratings:
    get:
      summary: List driver ratings (Authenticated)
      description: |
        Get a list of driver ratings with optional pagination and filters.
        Requires authentication.
        
        **Query Parameters:**
        - `page` (optional): Page number (default: 1)
        - `limit` (optional): Number of items per page (default: 10, max: 100)
        - `driverId` (optional): Filter by driver ID
        - `tripId` (optional): Filter by trip ID
      tags:
        - Driver Ratings
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: driverId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: tripId
          in: query
          required: false
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of ratings
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/PaginatedDriverRatingResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/DriverRating"
        "401":
          description: Not authenticated (missing or invalid token)
    post:
      summary: Submit driver rating (Authenticated)
      description: |
        Submit a driver rating. This endpoint requires authentication.
        Same functionality as the public endpoint but for internal use.
      tags:
        - Driver Ratings
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateDriverRatingRequest"
      responses:
        "201":
          description: Rating submitted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Rating submitted successfully"
                  data:
                    $ref: "#/components/schemas/DriverRating"
        "400":
          description: Bad request - validation error
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Driver or trip not found

  /ratings/{id}:
    get:
      summary: Get rating by ID (Authenticated)
      description: |
        Get detailed information about a specific rating by its ID.
        Requires authentication.
      tags:
        - Driver Ratings
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Rating retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/DriverRating"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Rating not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /activities:
    get:
      summary: Get activity logs (Role-based filtering)
      description: |
        Get activity logs with role-based filtering. Different roles see different activities:
        
        **Admin:**
        - Can see all activities across all franchises
        - Can filter by specific franchiseId to see activities of selected franchise
        - Real-time updates available via `/activities/stream`
        
        **Manager:**
        - Sees all activities of their assigned franchise
        - Automatically filtered by franchiseId
        
        **Staff/Office Staff:**
        - Sees driver activities and trip creation/updates
        - Filtered by their franchise
        
        **Driver:**
        - Sees only trip-related activities (assigned, accepted, started, ended, etc.)
        - Filtered by their driverId
        
        **Query Parameters:**
        - `page` (optional): Page number (default: 1)
        - `limit` (optional): Number of items per page (default: 20, max: 100)
        - `franchiseId` (optional): Filter by franchise (Admin only)
        - `driverId` (optional): Filter by driver
        - `staffId` (optional): Filter by staff
        - `tripId` (optional): Filter by trip
        - `action` (optional): Filter by action type
        - `entityType` (optional): Filter by entity type
        - `startDate` (optional): Filter by start date (ISO 8601)
        - `endDate` (optional): Filter by end date (ISO 8601)
      tags:
        - Activity Logs
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: franchiseId
          in: query
          required: false
          description: Filter by franchise ID (Admin can use this to select franchise)
          schema:
            type: string
            format: uuid
        - name: driverId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: staffId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: tripId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: false
          schema:
            type: string
            enum: [TRIP_CREATED, TRIP_ASSIGNED, TRIP_ACCEPTED, TRIP_REJECTED, TRIP_STARTED, TRIP_ENDED, TRIP_CANCELLED, TRIP_STATUS_CHANGED, TRIP_UPDATED, DRIVER_CREATED, DRIVER_UPDATED, DRIVER_STATUS_CHANGED, DRIVER_CLOCK_IN, DRIVER_CLOCK_OUT, STAFF_CREATED, STAFF_UPDATED, STAFF_STATUS_CHANGED, STAFF_CLOCK_IN, STAFF_CLOCK_OUT, COMPLAINT_CREATED, COMPLAINT_RESOLVED, COMPLAINT_STATUS_CHANGED, LEAVE_REQUESTED, LEAVE_APPROVED, LEAVE_REJECTED, LEAVE_CANCELLED, RATING_SUBMITTED, ATTENDANCE_RECORDED, CUSTOMER_CREATED, CUSTOMER_UPDATED, FRANCHISE_CREATED, FRANCHISE_UPDATED, FRANCHISE_STATUS_CHANGED]
        - name: entityType
          in: query
          required: false
          schema:
            type: string
            enum: [TRIP, DRIVER, STAFF, CUSTOMER, FRANCHISE, COMPLAINT, LEAVE_REQUEST, RATING, ATTENDANCE, OTHER]
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
      responses:
        "200":
          description: List of activity logs
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/PaginatedActivityLogResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/ActivityLog"
        "401":
          description: Not authenticated (missing or invalid token)

  /activities/stream:
    get:
      summary: Stream activity logs (Server-Sent Events - Realtime)
      description: |
        Get real-time activity logs using Server-Sent Events (SSE).
        Activities are pushed to the client as they occur.
        
        **Role-based filtering applies automatically:**
        - Admin: Can filter by franchiseId query parameter
        - Manager: Automatically filtered to their franchise
        - Staff: Sees driver activities and trip creations
        - Driver: Sees only trip-related activities
        
        **Usage:**
        - Connect to this endpoint to receive real-time updates
        - Activities are sent as JSON objects in SSE format
        - Connection remains open until client disconnects
        - Heartbeat messages sent every 2 seconds to keep connection alive
      tags:
        - Activity Logs
      security:
        - bearerAuth: []
      parameters:
        - name: franchiseId
          in: query
          required: false
          description: Filter by franchise ID (Admin only - to select specific franchise)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Server-Sent Events stream
          content:
            text/event-stream:
              schema:
                type: string
                example: |
                  data: {"type":"connected","message":"Activity log stream connected"}
                  
                  data: {"type":"activity","data":{"id":"...","action":"TRIP_CREATED",...}}
                  
                  : heartbeat
        "401":
          description: Not authenticated (missing or invalid token)

  /activities/{id}:
    get:
      summary: Get activity log by ID
      description: |
        Get detailed information about a specific activity log entry.
      tags:
        - Activity Logs
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Activity log retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/ActivityLog"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Activity log not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /penalties:
    get:
      summary: List penalties
      description: |
        Get a list of penalties with optional pagination and filters.
        
        **Query Parameters:**
        - `page` (optional): Page number (default: 1)
        - `limit` (optional): Number of items per page (default: 20, max: 100)
        - `isActive` (optional): Filter by active status
        - `type` (optional): Filter by type (`PENALTY` or `DEDUCTION`)
      tags:
        - Penalties
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: isActive
          in: query
          required: false
          schema:
            type: boolean
        - name: type
          in: query
          required: false
          schema:
            type: string
            enum: [PENALTY, DEDUCTION]
      responses:
        "200":
          description: List of penalties
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/PaginatedPenaltyResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Penalty"
        "401":
          description: Not authenticated (missing or invalid token)
    post:
      summary: Create penalty
      description: |
        Create a new penalty. Only ADMIN and MANAGER roles can create penalties.
      tags:
        - Penalties
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreatePenaltyRequest"
      responses:
        "201":
          description: Penalty created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Penalty created successfully"
                  data:
                    $ref: "#/components/schemas/Penalty"
        "400":
          description: Bad request - validation error
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions

  /penalties/{id}:
    get:
      summary: Get penalty by ID
      tags:
        - Penalties
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Penalty retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/Penalty"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Penalty not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    patch:
      summary: Update penalty
      description: Update an existing penalty (ADMIN and MANAGER only).
      tags:
        - Penalties
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdatePenaltyRequest"
      responses:
        "200":
          description: Penalty updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Penalty updated successfully"
                  data:
                    $ref: "#/components/schemas/Penalty"
        "400":
          description: Bad request - validation error
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions
        "404":
          description: Penalty not found
    delete:
      summary: Delete penalty
      description: Delete a penalty (ADMIN and MANAGER only).
      tags:
        - Penalties
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Penalty deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Penalty deleted successfully"
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions
        "404":
          description: Penalty not found

  /penalties/apply/driver/{driverId}:
    post:
      summary: Apply penalty to a driver
      description: |
        Apply a penalty to a specific driver. Only ADMIN and MANAGER roles can apply penalties.
      tags:
        - Penalties
      security:
        - bearerAuth: []
      parameters:
        - name: driverId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ApplyPenaltyToDriverRequest"
      responses:
        "201":
          description: Penalty applied to driver
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Penalty applied to driver successfully"
                  data:
                    $ref: "#/components/schemas/DriverPenalty"
        "400":
          description: Bad request - validation error
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions
        "404":
          description: Driver or penalty not found

  /penalties/apply/drivers:
    post:
      summary: Apply penalty to multiple drivers
      description: |
        Apply a penalty to multiple drivers by IDs, or by franchise.
        Only ADMIN and MANAGER roles can apply penalties.
      tags:
        - Penalties
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ApplyPenaltyToDriversRequest"
      responses:
        "201":
          description: Penalty applied to multiple drivers
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Penalty applied to multiple drivers successfully"
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/DriverPenalty"
        "400":
          description: Bad request - validation error
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions
        "404":
          description: One or more drivers or penalty not found

  /penalties/driver-penalties:
    get:
      summary: List driver penalties
      description: |
        Get a list of penalties applied to drivers, with optional pagination and filters.
        
        **Query Parameters:**
        - `page` (optional): Page number (default: 1)
        - `limit` (optional): Number of items per page (default: 20, max: 100)
        - `driverId` (optional): Filter by driver ID
        - `penaltyId` (optional): Filter by penalty ID
        - `startDate` (optional): Filter by start date (ISO 8601)
        - `endDate` (optional): Filter by end date (ISO 8601)
      tags:
        - Penalties
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: driverId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: penaltyId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date-time
      responses:
        "200":
          description: List of driver penalties
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/PaginatedDriverPenaltyResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/DriverPenalty"
        "401":
          description: Not authenticated (missing or invalid token)

  /penalties/driver-penalties/{id}:
    get:
      summary: Get driver penalty by ID
      tags:
        - Penalties
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Driver penalty retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/DriverPenalty"
        "401":
          description: Not authenticated (missing or invalid token)
        "404":
          description: Driver penalty not found
    patch:
      summary: Update driver penalty
      description: Update fields like amount, reason, or active status (ADMIN and MANAGER only).
      tags:
        - Penalties
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Driver penalty updated successfully
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions
        "404":
          description: Driver penalty not found
    delete:
      summary: Delete driver penalty
      description: Delete a driver penalty record (ADMIN and MANAGER only).
      tags:
        - Penalties
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Driver penalty deleted successfully
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions
        "404":
          description: Driver penalty not found

  /penalties/daily-limit/driver/{driverId}:
    patch:
      summary: Set driver's daily limit
      description: |
        Set the daily target amount for a specific driver (ADMIN and MANAGER only).
      tags:
        - Penalties
      security:
        - bearerAuth: []
      parameters:
        - name: driverId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SetDriverDailyLimitRequest"
      responses:
        "200":
          description: Driver daily limit set successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Driver daily limit set successfully"
                  data:
                    type: object
                    properties:
                      driverId:
                        type: string
                        format: uuid
                      dailyTargetAmount:
                        type: integer
        "400":
          description: Bad request - validation error
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions
        "404":
          description: Driver not found

  /penalties/daily-limit/drivers:
    patch:
      summary: Set drivers' daily limit (bulk)
      description: |
        Set the daily target amount for multiple drivers by IDs or by franchise (ADMIN and MANAGER only).
      tags:
        - Penalties
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SetDriversDailyLimitRequest"
      responses:
        "200":
          description: Drivers' daily limits set successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Drivers' daily limits set successfully"
                  data:
                    type: object
                    properties:
                      updatedCount:
                        type: integer
        "400":
          description: Bad request - validation error
        "401":
          description: Unauthorized - missing or invalid token
        "403":
          description: Forbidden - insufficient permissions
        "404":
          description: One or more drivers or franchise not found
        
  /reviews/public:
    post:
      summary: Submit trip review (public)
      description: Submit a customer trip review without authentication.
      tags:
        - Reviews
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTripReviewRequest"
      responses:
        "201":
          description: Trip review submitted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  data:
                    $ref: "#/components/schemas/TripReview"
        "400":
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Related entity not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /reviews/{id}:
    get:
      summary: Get trip review by ID (public)
      tags:
        - Reviews
      parameters:
        - name: id
          in: path
          required: true
          description: Trip review ID (UUID)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Trip review fetched
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/TripReview"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        
components:
  schemas:
    AttendanceStatus:
      type: object
      properties:
        clockedIn:
          type: boolean
          description: Whether the person is currently clocked in
        clockInTime:
          type: string
          format: date-time
          nullable: true
          description: Time of the first clock-in for the day
        lastClockOutTime:
          type: string
          format: date-time
          nullable: true
          description: Time of the last clock-out for the day
        status:
          type: string
          enum: [PRESENT, ABSENT, HALF_DAY, LEAVE]
          description: Current attendance status
        attendanceId:
          type: string
          format: uuid
          nullable: true
          description: ID of the attendance record

    CreateCustomerRequest:
      type: object
      properties:
        fullName:
          type: string
        phone:
          type: string
        email:
          type: string
        city:
          type: string
        notes:
          type: string
        franchiseId:
          type: integer
      required:
        - fullName
        - phone
        - franchiseId

    Customer:
      type: object
      properties:
        id:
          type: integer
        fullName:
          type: string
        phone:
          type: string
        email:
          type: string
        city:
          type: string
        notes:
          type: string
        franchiseId:
          type: integer

    CustomerResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/Customer"
    
    TripReview:
      type: object
      properties:
        id:
          type: string
          format: uuid
        tripId:
          type: string
          format: uuid
        driverId:
          type: string
          format: uuid
        franchiseId:
          type: string
          format: uuid
        customerId:
          type: string
          format: uuid
        rating:
          type: integer
          minimum: 1
          maximum: 5
        comment:
          type: string
        createdAt:
          type: string
          format: date-time
    
    CreateTripReviewRequest:
      type: object
      required:
        - tripId
        - driverId
        - franchiseId
        - customerId
        - rating
        - comment
      properties:
        tripId:
          type: string
          format: uuid
        driverId:
          type: string
          format: uuid
        franchiseId:
          type: string
          format: uuid
        customerId:
          type: string
          format: uuid
        rating:
          type: integer
          minimum: 1
          maximum: 5
        comment:
          type: string

    CustomerDetailsResponse:
      type: object
      description: Customer profile with history (trips booked, complaints raised)
      properties:
        data:
          type: object
          allOf:
            - $ref: "#/components/schemas/Customer"
            - type: object
              properties:
                tripsBooked:
                  type: integer
                  description: Number of trips booked by this customer
                complaintsRaised:
                  type: integer
                  description: Number of complaints raised by this customer

    CreateTripRequest:
      type: object
      properties:
        franchiseId:
          type: integer
        driverId:
          type: integer
        customerId:
          type: integer
        tripType:
          type: string
          enum: [CITY_ROUND, CITY_DROPOFF, LONG_ROUND, LONG_DROPOFF]
        pickupLocation:
          type: string
        dropLocation:
          type: string
        scheduledAt:
          type: string
          format: date-time
        baseAmount:
          type: number
        extraAmount:
          type: number
      required:
        - franchiseId
        - driverId
        - customerId
        - tripType
        - pickupLocation
        - baseAmount

    AssignDriverToTripRequest:
      type: object
      description: |
        Request body for assigning a driver to a trip. Franchise is derived from the trip; only tripId and driverId are required.
      properties:
        tripId:
          type: string
          format: uuid
          description: Trip ID (UUID)
          example: "550e8400-e29b-41d4-a716-446655440000"
        driverId:
          type: string
          format: uuid
          description: Driver ID (UUID)
          example: "779a77f6-5704-4b00-8561-2892c58946a2"
      required:
        - tripId
        - driverId

    RequestTripDriversRequest:
      type: object
      description: |
        Request body for manually requesting a trip to drivers.
        
        - mode=ALL: no other fields needed
        - mode=SPECIFIC: requires driverId
        - mode=LIST: requires driverIds (non-empty)
      properties:
        mode:
          type: string
          enum: [ALL, SPECIFIC, LIST]
          description: Dispatch request mode
          default: ALL
        driverId:
          type: string
          format: uuid
          description: Driver ID (required when mode is SPECIFIC)
          nullable: true
        driverIds:
          type: array
          description: List of driver IDs (required when mode is LIST)
          nullable: true
          items:
            type: string
            format: uuid

    RequestTripDriversResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            requested:
              type: integer
              description: Number of new trip offers created
              example: 5

    CreateTripPhase1Request:
      type: object
      description: |
        Request body for Phase 1 trip creation with customer data collection.
        This endpoint automatically handles customer creation/update based on phone number.
      properties:
        customerName:
          type: string
          description: Full name of the customer
          example: "John Doe"
          minLength: 1
          maxLength: 100
        customerPhone:
          type: string
          description: Customer phone number (used to check if customer exists)
          example: "+1234567890"
          pattern: "^[+]?[(]?[0-9]{1,4}[)]?[-\\s.]?[(]?[0-9]{1,4}[)]?[-\\s.]?[0-9]{1,9}$"
        customerEmail:
          type: string
          format: email
          description: Customer email address (optional)
          example: "john.doe@example.com"
          nullable: true
        pickupLocation:
          type: string
          description: Google Place ID or coordinates for pickup location
          example: "ChIJN1t_tDeuEmsRUsoyG83frY4"
          minLength: 1
        pickupAddress:
          type: string
          description: Full address for pickup location
          example: "123 Main Street, New York, NY 10001"
          minLength: 1
          maxLength: 500
        pickupLat:
          type: number
          description: Pickup latitude (optional, from Places/Geocoding)
          example: 12.9716
          minimum: -90
          maximum: 90
          nullable: true
        pickupLng:
          type: number
          description: Pickup longitude (optional, from Places/Geocoding)
          example: 77.5946
          minimum: -180
          maximum: 180
          nullable: true
        pickupLocationNote:
          type: string
          description: Additional notes for pickup location (landmarks, details)
          example: "Near the blue building, entrance on the right"
          nullable: true
          maxLength: 500
        destinationLocation:
          type: string
          description: Google Place ID or coordinates for destination location
          example: "ChIJN1t_tDeuEmsRUsoyG83frY5"
          minLength: 1
        destinationAddress:
          type: string
          description: Full address for destination location
          example: "456 Oak Avenue, New York, NY 10002"
          minLength: 1
          maxLength: 500
        destinationLat:
          type: number
          description: Destination latitude (optional, from Places/Geocoding)
          example: 12.9352
          minimum: -90
          maximum: 90
          nullable: true
        destinationLng:
          type: number
          description: Destination longitude (optional, from Places/Geocoding)
          example: 77.6245
          minimum: -180
          maximum: 180
          nullable: true
        destinationNote:
          type: string
          description: Additional notes for destination location (landmarks, details)
          example: "Building entrance, ring doorbell"
          nullable: true
          maxLength: 500
        franchiseId:
          type: string
          format: uuid
          description: Franchise ID (UUID)
          example: "550e8400-e29b-41d4-a716-446655440000"
        tripType:
          type: string
          enum: [CITY_ROUND, CITY_DROPOFF, LONG_ROUND, LONG_DROPOFF]
          description: Type of trip
          example: "CITY_ROUND"
        distance:
          type: number
          description: Distance in kilometers (optional, can be calculated later)
          example: 15.5
          nullable: true
          minimum: 0
        distanceScope:
          type: string
          description: Distance scope identifier (optional)
          example: "LOCAL"
          nullable: true
        carGearType:
          type: string
          enum: [MANUAL, AUTOMATIC]
          description: Car gear type preference
          example: "MANUAL"
        carType:
          type: string
          enum: [PREMIUM, LUXURY, NORMAL]
          description: Car type category preference
          example: "PREMIUM"
        tripDate:
          type: string
          format: date
          description: Trip date in YYYY-MM-DD format
          example: "2024-01-20"
        tripTime:
          type: string
          pattern: "^([0-1][0-9]|2[0-3]):[0-5][0-9]$"
          description: Trip time in HH:mm format (24-hour)
          example: "14:30"
        isDetailsReconfirmed:
          type: boolean
          description: Flag indicating if trip details have been reconfirmed with customer
          example: true
          default: false
        isFareDiscussed:
          type: boolean
          description: Flag indicating if base fare has been discussed with customer
          example: true
          default: false
        isPriceAccepted:
          type: boolean
          description: Flag indicating if customer has accepted the price
          example: true
          default: false
      required:
        - customerName
        - customerPhone
        - pickupLocation
        - pickupAddress
        - destinationLocation
        - destinationAddress
        - franchiseId
        - tripType
        - carGearType
        - carType
        - tripDate
        - tripTime
        - isDetailsReconfirmed
        - isFareDiscussed
        - isPriceAccepted

    CreateTripPhase1Response:
      type: object
      description: Response for Phase 1 trip creation
      properties:
        data:
          type: object
          properties:
            trip:
              type: object
              description: Created trip object
              properties:
                id:
                  type: string
                  format: uuid
                  description: Trip ID (UUID)
                  example: "660e8400-e29b-41d4-a716-446655440000"
                franchiseId:
                  type: string
                  format: uuid
                  description: Franchise ID
                  example: "550e8400-e29b-41d4-a716-446655440000"
                customerId:
                  type: integer
                  nullable: true
                  description: Customer ID (if customer was found/created)
                  example: 1
                customerName:
                  type: string
                  description: Customer name
                  example: "John Doe"
                customerPhone:
                  type: string
                  description: Customer phone number
                  example: "+1234567890"
                customerEmail:
                  type: string
                  nullable: true
                  description: Customer email
                  example: "john.doe@example.com"
                tripType:
                  type: string
                  enum: [CITY_ROUND, CITY_DROPOFF, LONG_ROUND, LONG_DROPOFF]
                  description: Trip type
                  example: "CITY_ROUND"
                status:
                  type: string
                  enum: [REQUESTED, ASSIGNED, DRIVER_ON_THE_WAY, IN_PROGRESS, COMPLETED, CANCELLED_BY_CUSTOMER, CANCELLED_BY_OFFICE, REJECTED_BY_DRIVER, DRIVER_ACCEPTED]
                  description: Trip status (always REQUESTED for Phase 1)
                  example: "REQUESTED"
                pickupLocation:
                  type: string
                  description: Google Place ID or coordinates for pickup
                  example: "ChIJN1t_tDeuEmsRUsoyG83frY4"
                pickupAddress:
                  type: string
                  description: Full pickup address
                  example: "123 Main Street, New York, NY 10001"
                pickupLocationNote:
                  type: string
                  nullable: true
                  description: Pickup location notes
                  example: "Near the blue building, entrance on the right"
                dropLocation:
                  type: string
                  nullable: true
                  description: Google Place ID or coordinates for destination
                  example: "ChIJN1t_tDeuEmsRUsoyG83frY5"
                dropAddress:
                  type: string
                  nullable: true
                  description: Full destination address
                  example: "456 Oak Avenue, New York, NY 10002"
                dropLocationNote:
                  type: string
                  nullable: true
                  description: Destination location notes
                  example: "Building entrance, ring doorbell"
                carType:
                  type: string
                  description: Car type stored as JSON string with gearType and category
                  example: '{"gearType":"MANUAL","category":"PREMIUM"}'
                scheduledAt:
                  type: string
                  format: date-time
                  nullable: true
                  description: Scheduled trip date and time
                  example: "2024-01-20T14:30:00Z"
                isDetailsReconfirmed:
                  type: boolean
                  description: Details reconfirmed flag
                  example: true
                isFareDiscussed:
                  type: boolean
                  description: Fare discussed flag
                  example: true
                isPriceAccepted:
                  type: boolean
                  description: Price accepted flag
                  example: true
                baseAmount:
                  type: integer
                  description: Base amount (0 for Phase 1)
                  example: 0
                extraAmount:
                  type: integer
                  description: Extra amount (0 for Phase 1)
                  example: 0
                totalAmount:
                  type: integer
                  description: Total amount (0 for Phase 1)
                  example: 0
                finalAmount:
                  type: integer
                  description: Final amount (0 for Phase 1)
                  example: 0
                paymentStatus:
                  type: string
                  enum: [PENDING, COMPLETED, PAID, PARTIALLY_PAID]
                  description: Payment status (always PENDING for Phase 1)
                  example: "PENDING"
                createdAt:
                  type: string
                  format: date-time
                  description: Creation timestamp
                  example: "2024-01-20T10:00:00Z"
                updatedAt:
                  type: string
                  format: date-time
                  description: Last update timestamp
                  example: "2024-01-20T10:00:00Z"
            customer:
              type: object
              description: Customer information with existence flag
              properties:
                id:
                  type: integer
                  description: Customer ID
                  example: 1
                name:
                  type: string
                  description: Customer name
                  example: "John Doe"
                phone:
                  type: string
                  description: Customer phone number
                  example: "+1234567890"
                email:
                  type: string
                  nullable: true
                  description: Customer email
                  example: "john.doe@example.com"
                isExisting:
                  type: boolean
                  description: Whether the customer already existed (true) or was newly created (false)
                  example: false

    Trip:
      type: object
      properties:
        id:
          type: integer
        franchiseId:
          type: integer
        driverId:
          type: integer
          nullable: true
        customerId:
          type: integer
        customerName:
          type: string
        customerPhone:
          type: string
        tripType:
          type: string
        status:
          type: string
        pickupLocation:
          type: string
        pickupLat:
          type: number
          nullable: true
          description: Pickup latitude (if provided)
          example: 12.9716
        pickupLng:
          type: number
          nullable: true
          description: Pickup longitude (if provided)
          example: 77.5946
        dropLocation:
          type: string
          nullable: true
        dropLat:
          type: number
          nullable: true
          description: Drop latitude (if provided)
          example: 12.9352
        dropLng:
          type: number
          nullable: true
          description: Drop longitude (if provided)
          example: 77.6245
        scheduledAt:
          type: string
          format: date-time
          nullable: true
        startedAt:
          type: string
          format: date-time
          nullable: true
        endedAt:
          type: string
          format: date-time
          nullable: true
        baseAmount:
          type: number
        extraAmount:
          type: number
        totalAmount:
          type: number
        finalAmount:
          type: number
        paymentStatus:
          type: string
        paymentMode:
          type: string
          nullable: true
        paymentReference:
          type: string
          nullable: true
        startOdometer:
          type: number
          nullable: true
          description: Odometer reading at trip start (in km)
          example: 12345.5
        endOdometer:
          type: number
          nullable: true
          description: Odometer reading at trip end (in km)
          example: 12350.2
        carImageFront:
          type: string
          format: uri
          nullable: true
          description: URL to front car image
          example: "https://example.com/images/car-front.jpg"
        carImageBack:
          type: string
          format: uri
          nullable: true
          description: URL to back car image
          example: "https://example.com/images/car-back.jpg"

    TripResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/Trip"

    StartOtpResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            tripId:
              type: integer
            otp:
              type: string

    EndOtpResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            tripId:
              type: integer
            otp:
              type: string

    InitiateStartTripRequest:
      type: object
      description: |
        Request body for initiating trip start. Trip ID comes from the URL path (/trips/{id}/start-initiate).
        Driver and franchise are derived from the trip; do not send them in the body.
      properties:
        odometerValue:
          type: number
          description: Odometer reading at trip start (in km)
          example: 12345.5
          minimum: 0
        odometerPic:
          type: string
          format: uri
          description: URL to odometer picture
          example: "https://example.com/images/odometer.jpg"
        carFrontPic:
          type: string
          format: uri
          description: URL to front car image
          example: "https://example.com/images/car-front.jpg"
        carBackPic:
          type: string
          format: uri
          description: URL to back car image
          example: "https://example.com/images/car-back.jpg"
      required:
        - odometerValue
        - odometerPic
        - carFrontPic
        - carBackPic

    VerifyStartTripRequest:
      type: object
      description: |
        Request body for verifying token and OTP to start trip.
      properties:
        token:
          type: string
          description: JWT token received from /start-initiate endpoint
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        otp:
          type: string
          description: 4-digit OTP received from customer (sent via SMS/WhatsApp)
          example: "1234"
          pattern: "^[0-9]{4}$"
      required:
        - token
        - otp

    SubmitCashForSettlementRequest:
      type: object
      description: |
        Request body for submitting cash for settlement.
        Allows drivers to submit a specific amount of cash to the office.
      properties:
        driverId:
          type: string
          format: uuid
          description: Driver ID (UUID)
          example: "779a77f6-5704-4b00-8561-2892c58946a2"
        settlementAmount:
          type: number
          format: decimal
          description: Amount to submit for settlement (must be greater than zero and not exceed cash in hand)
          example: 500.50
          minimum: 0.01
      required:
        - driverId
        - settlementAmount

    InitiateEndTripRequest:
      type: object
      description: |
        Request body for initiating trip end. Trip ID comes from the URL path (/trips/{id}/end-initiate).
        Driver and franchise are derived from the trip; do not send them in the body.
      properties:
        odometerValue:
          type: number
          description: Odometer reading at trip end (in km)
          example: 12350.2
          minimum: 0
        odometerImage:
          type: string
          format: uri
          description: URL to odometer image at trip end
          example: "https://example.com/images/odometer-end.jpg"
      required:
        - odometerValue
        - odometerImage

    VerifyEndTripRequest:
      type: object
      description: |
        Request body for verifying token and OTP to end trip.
        After verification, the system calculates distance, time, and amount.
      properties:
        token:
          type: string
          description: JWT token received from /end-initiate endpoint
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        otp:
          type: string
          description: 4-digit OTP received from customer (sent via email)
          example: "5678"
          pattern: "^[0-9]{4}$"
      required:
        - token
        - otp

    CollectPaymentRequest:
      type: object
      description: |
        Request body for collecting payment information.
        Supports UPI, Cash, or both payment methods.
      properties:
        driverId:
          type: string
          format: uuid
          description: Driver ID (UUID)
          example: "779a77f6-5704-4b00-8561-2892c58946a2"
        paymentMethod:
          type: string
          enum: [UPI, CASH, BOTH]
          description: Payment method
          example: "BOTH"
        upiAmount:
          type: number
          description: Amount paid via UPI (required for UPI and BOTH methods)
          example: 300
          minimum: 0
        cashAmount:
          type: number
          description: Amount paid in cash (required for CASH and BOTH methods)
          example: 200
          minimum: 0
        upiReference:
          type: string
          description: UPI transaction reference/ID (optional)
          example: "TXN123456789"
      required:
        - driverId
        - paymentMethod
      allOf:
        - if:
            properties:
              paymentMethod:
                enum: [UPI]
          then:
            required:
              - upiAmount
        - if:
            properties:
              paymentMethod:
                enum: [CASH]
          then:
            required:
              - cashAmount
        - if:
            properties:
              paymentMethod:
                enum: [BOTH]
          then:
            required:
              - upiAmount
              - cashAmount

    TripTypeConfig:
      type: object
      description: Trip type configuration model
      properties:
        id:
          type: string
          format: uuid
          description: Configuration ID
          example: "550e8400-e29b-41d4-a716-446655440000"
        name:
          type: string
          description: Trip type name (user-defined, any string)
          example: "City Round Trip"
        description:
          type: string
          nullable: true
          description: Configuration description
          example: "City round trip pricing"
        specialPrice:
          type: boolean
          description: |
            If `true`, uses slab-based distance pricing (driver-negotiable).
            When `true`, `basePrice` and `extraPerHour` may be null.
          example: false
        basePrice:
          type: number
          nullable: true
          description: Base price (null when specialPrice = true)
          example: 400
        baseHour:
          type: number
          nullable: true
          description: Base hours included in the base price (null when specialPrice = true)
          example: 3
        distance:
          type: number
          nullable: true
          description: Base distance in km
          example: 20
        extraPerHour:
          type: number
          nullable: true
          description: Extra charge per hour (null when specialPrice = true)
          example: 100
        extraPerHalfHour:
          type: number
          nullable: true
          description: Extra charge per half hour (30 minutes)
          example: 50
        distanceSlabs:
          type: array
          nullable: true
          description: |
            Distance-based price slabs (present when specialPrice = true).
            Format: `[{from: 0, to: 50, price: 1000}, ...]`
          items:
            type: object
            properties:
              from:
                type: number
                description: Starting distance in km
                example: 0
              to:
                type: number
                nullable: true
                description: Ending distance in km (null for open-ended)
                example: 50
              price:
                type: number
                description: Price for this distance range
                example: 1000
          example:
            - from: 0
              to: 50
              price: 1000
            - from: 51
              to: 100
              price: 1500
        status:
          type: string
          enum: [ACTIVE, INACTIVE]
          description: Configuration status
          example: "ACTIVE"
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp

    CreateTripTypeRequest:
      type: object
      description: |
        Request body for creating a new trip type.
        
        **Two Pricing Modes:**
        
        1. **Standard Pricing** (`specialPrice: false` or omitted):
           - Requires: `basePrice`, `baseHour`, `extraPerHour`
           - Time-based pricing with predefined rates
        
        2. **Special Pricing** (`specialPrice: true`):
           - Requires: `distanceSlabs` (array of distance-based price slabs)
           - Distance-based slab pricing (driver-negotiable)
           - `basePrice`, `baseHour`, `extraPerHour` are NOT required
      required:
        - name
      properties:
        name:
          type: string
          description: Trip type name (user-defined, any string)
          example: "City Round Trip"
          minLength: 1
          maxLength: 100
        specialPrice:
          type: boolean
          default: false
          description: |
            If `true`, uses slab-based distance pricing (driver-negotiable).
            When `true`, `basePrice`, `baseHour`, and `extraPerHour` are NOT required.
            Instead, `distanceSlabs` is required.
          example: false
        basePrice:
          type: number
          nullable: true
          description: |
            Base price (required when `specialPrice = false`, not required when `specialPrice = true`).
            Must be positive if provided.
          example: 400
          minimum: 0
        baseHour:
          type: number
          nullable: true
          description: |
            Base hours included in the base price (required when `specialPrice = false`, not required when `specialPrice = true`).
            Must be positive if provided.
          example: 3
          minimum: 0
        extraPerHour:
          type: number
          nullable: true
          description: |
            Extra charge per hour (required when `specialPrice = false`, not required when `specialPrice = true`).
            Must be positive if provided.
          example: 100
          minimum: 0
        extraPerHalfHour:
          type: number
          nullable: true
          description: Extra charge for 30 minutes (optional)
          example: 50
          minimum: 0
        distance:
          type: number
          nullable: true
          description: Base distance in km (optional)
          example: 20
          minimum: 0
        description:
          type: string
          nullable: true
          description: Description of the trip type
          example: "City round trip pricing"
          maxLength: 500
        distanceSlabs:
          type: array
          nullable: true
          description: |
            Distance-based price slabs (required when `specialPrice = true`).
            Each slab defines a price for a distance range.
            Format: `[{from: 0, to: 50, price: 1000}, {from: 51, to: 100, price: 1500}, ...]`
            Use `null` for `to` in the last slab to indicate open-ended range.
          items:
            type: object
            required:
              - from
              - price
            properties:
              from:
                type: number
                description: Starting distance in km (must be >= 0)
                example: 0
                minimum: 0
              to:
                type: number
                nullable: true
                description: Ending distance in km (must be >= from, or null for open-ended)
                example: 50
                minimum: 0
              price:
                type: number
                description: Price for this distance range (must be >= 0)
                example: 1000
                minimum: 0
          example:
            - from: 0
              to: 50
              price: 1000
            - from: 51
              to: 100
              price: 1500
            - from: 101
              to: null
              price: 2000

    UpdateTripTypeRequest:
      type: object
      description: |
        Request body for updating a trip type. All fields are optional.
        
        **Note:** When updating `specialPrice` mode, ensure required fields are provided:
        - If switching to `specialPrice = true`, provide `distanceSlabs`
        - If switching to `specialPrice = false`, provide `basePrice`, `baseHour`, `extraPerHour`
      properties:
        name:
          type: string
          description: Trip type name (user-defined, any string)
          example: "City Round Trip"
          minLength: 1
          maxLength: 100
        specialPrice:
          type: boolean
          description: |
            If `true`, uses slab-based distance pricing.
            When updating, ensure required fields match the mode.
          example: false
        basePrice:
          type: number
          nullable: true
          description: Base price (required when `specialPrice = false`)
          example: 450
          minimum: 0
        baseHour:
          type: number
          nullable: true
          description: Base hours included in the base price (required when `specialPrice = false`)
          example: 3
          minimum: 0
        extraPerHour:
          type: number
          nullable: true
          description: Extra charge per hour (required when `specialPrice = false`)
          example: 120
          minimum: 0
        extraPerHalfHour:
          type: number
          nullable: true
          description: Extra charge for 30 minutes
          example: 60
          minimum: 0
        distance:
          type: number
          nullable: true
          description: Base distance in km (optional)
          example: 20
          minimum: 0
        description:
          type: string
          nullable: true
          description: Description of the trip type
          maxLength: 500
        distanceSlabs:
          type: array
          nullable: true
          description: |
            Distance-based price slabs (required when `specialPrice = true`).
            Format: `[{from: 0, to: 50, price: 1000}, ...]`
          items:
            type: object
            required:
              - from
              - price
            properties:
              from:
                type: number
                description: Starting distance in km
                example: 0
                minimum: 0
              to:
                type: number
                nullable: true
                description: Ending distance in km (null for open-ended)
                example: 50
                minimum: 0
              price:
                type: number
                description: Price for this distance range
                example: 1000
                minimum: 0

    CreateRoleRequest:
      type: object
      properties:
        name:
          type: string
          description: Role name (e.g., ADMIN, DRIVER, STAFF, CUSTOMER)
          example: ADMIN
        description:
          type: string
          description: Optional description of the role
          example: Administrator with full system access
        isActive:
          type: boolean
          description: Whether the role is active
          default: true
      required:
        - name

    UpdateRoleRequest:
      type: object
      properties:
        name:
          type: string
          description: Role name
          example: ADMIN
        description:
          type: string
          description: Optional description of the role
          example: Administrator with full system access
        isActive:
          type: boolean
          description: Whether the role is active
      required: []

    Role:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Role ID (UUID)
        name:
          type: string
          description: Role name
          example: ADMIN
        description:
          type: string
          nullable: true
          description: Role description
        isActive:
          type: boolean
          description: Whether the role is active
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp

    RoleResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/Role"

    RegisterAdminRequest:
      type: object
      properties:
        name:
          type: string
          description: Full name of the admin
          example: John Doe
          minLength: 1
          maxLength: 100
        email:
          type: string
          format: email
          description: Email address (must be unique)
          example: admin@drybros.com
        password:
          type: string
          format: password
          description: Password (minimum 8 characters)
          example: SecurePassword123
          minLength: 8
          maxLength: 100
        phone:
          type: string
          description: Phone number (optional)
          example: "+1234567890"
          nullable: true
      required:
        - name
        - email
        - password

    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          description: Email address
          example: admin@drybros.com
        password:
          type: string
          format: password
          description: Password
          example: SecurePassword123
      required:
        - email
        - password

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: User ID (UUID)
        fullName:
          type: string
          description: Full name
        email:
          type: string
          format: email
          description: Email address
        phone:
          type: string
          nullable: true
          description: Phone number
        role:
          type: string
          enum: [ADMIN, DRIVER, STAFF, CUSTOMER]
          description: User role
        isActive:
          type: boolean
          description: Whether the user is active

    RegisterAdminResponse:
      type: object
      properties:
        message:
          type: string
          description: Success message
          example: "Admin registered successfully"

    AuthResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            accessToken:
              type: string
              description: JWT access token (expires in 1 hour)
            refreshToken:
              type: string
              description: JWT refresh token (expires in 8 hours)
            user:
              $ref: "#/components/schemas/User"

    ForgotPasswordRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          description: Email address of the account
          example: admin@drybros.com
      required:
        - email

    ForgotPasswordResponse:
      type: object
      properties:
        message:
          type: string
          description: Success message
          example: "Password reset link has been sent to your email address."

    ChangePasswordRequest:
      type: object
      required:
        - id
        - previousPassword
        - newPassword
      properties:
        id:
          type: string
          format: uuid
          description: User/Staff/Driver ID (must match authenticated user)
          example: "550e8400-e29b-41d4-a716-446655440000"
        previousPassword:
          type: string
          format: password
          description: Current password (for verification)
          example: "oldPassword123"
        newPassword:
          type: string
          format: password
          minLength: 8
          maxLength: 100
          description: New password (minimum 8 characters)
          example: "newSecurePassword123"

    ResetPasswordRequest:
      type: object
      properties:
        token:
          type: string
          description: Password reset token received via email (expires in 1 hour)
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        password:
          type: string
          format: password
          description: New password (minimum 8 characters)
          example: "NewSecurePassword123"
          minLength: 8
          maxLength: 100
      required:
        - token
        - password

    ResetPasswordResponse:
      type: object
      properties:
        message:
          type: string
          description: Success message
          example: "Password has been reset successfully. Please check your email for confirmation."

    RefreshTokenRequest:
      type: object
      properties:
        refreshToken:
          type: string
          description: Refresh token received from login (expires in 8 hours)
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      required:
        - refreshToken

    CreateStaffRequest:
      type: object
      properties:
        name:
          type: string
          description: Full name of the staff member
          example: "John Doe"
          minLength: 1
          maxLength: 100
        email:
          type: string
          format: email
          description: Email address (must be unique, used for login)
          example: "john.doe@drybros.com"
          maxLength: 255
        phone:
          type: string
          description: Phone number (must be unique)
          example: "+1234567890"
          minLength: 10
          maxLength: 20
        password:
          type: string
          format: password
          description: Password (auto-generated from frontend, minimum 8 characters)
          example: "SecurePassword123"
          minLength: 8
          maxLength: 100
        franchiseId:
          type: string
          format: uuid
          description: Franchise ID (UUID)
          example: "550e8400-e29b-41d4-a716-446655440000"
        monthlySalary:
          type: number
          description: Monthly salary
          example: 50000
          minimum: 0
        address:
          type: string
          description: Full address
          example: "123 Main St, City, State 12345"
          minLength: 1
          maxLength: 500
        emergencyContact:
          type: string
          description: Emergency contact phone number
          example: "+1234567890"
          minLength: 10
          maxLength: 20
        emergencyContactRelation:
          type: string
          description: Relationship with emergency contact
          example: "Spouse"
          minLength: 1
          maxLength: 50
        govtId:
          type: boolean
          description: Whether government ID document is collected (checkbox)
          example: true
          default: false
        addressProof:
          type: boolean
          description: Whether address proof document is collected (checkbox)
          example: true
          default: false
        certificates:
          type: boolean
          description: Whether certificates are collected (checkbox)
          example: true
          default: false
        previousExperienceCert:
          type: boolean
          description: Whether previous experience certificate is collected (checkbox)
          example: true
          default: false
        profilePic:
          type: string
          nullable: true
          description: Profile picture URL (optional, for future use)
          example: "https://example.com/images/profile.jpg"
          maxLength: 500
          format: uri
        joinDate:
          type: string
          format: date-time
          description: Date when staff member joined (defaults to current date if not provided)
          example: "2024-01-15T00:00:00Z"
      required:
        - name
        - email
        - phone
        - password
        - franchiseId
        - monthlySalary
        - address
        - emergencyContact
        - emergencyContactRelation

    Staff:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Staff ID (UUID)
        name:
          type: string
          description: Full name
        email:
          type: string
          format: email
          description: Email address (used for login)
        phone:
          type: string
          description: Phone number
        franchiseId:
          type: string
          format: uuid
          description: Franchise ID
        monthlySalary:
          type: number
          description: Monthly salary
        address:
          type: string
          description: Full address
        emergencyContact:
          type: string
          description: Emergency contact phone number
        emergencyContactRelation:
          type: string
          description: Relationship with emergency contact
        govtId:
          type: boolean
          description: Whether government ID document is collected
        addressProof:
          type: boolean
          description: Whether address proof document is collected
        certificates:
          type: boolean
          description: Whether certificates are collected
        previousExperienceCert:
          type: boolean
          description: Whether previous experience certificate is collected
        profilePic:
          type: string
          nullable: true
          description: Profile picture URL
          format: uri
        status:
          type: string
          enum: [ACTIVE, FIRED, SUSPENDED, BLOCKED]
          description: Staff status
          example: ACTIVE
        suspendedUntil:
          type: string
          format: date-time
          nullable: true
          description: Suspension end date (only set when status is SUSPENDED)
        joinDate:
          type: string
          format: date-time
          description: Date when staff member joined the organization
          example: "2024-01-15T00:00:00Z"
        relieveDate:
          type: string
          format: date-time
          nullable: true
          description: Date when staff member was relieved/terminated
          example: "2024-12-31T00:00:00Z"
        relieveReason:
          type: string
          enum: [RESIGNATION, TERMINATION, RETIREMENT, CONTRACT_ENDED, PERFORMANCE_ISSUES, MISCONDUCT, OTHER]
          nullable: true
          description: Reason for relieving the staff member
          example: RESIGNATION
        isActive:
          type: boolean
          description: Whether the staff member is active
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp
        franchise:
          type: object
          nullable: true
          description: Franchise details (included in response)
          properties:
            id:
              type: string
              format: uuid
              description: Franchise ID
            code:
              type: string
              description: Franchise code
            name:
              type: string
              description: Franchise name
            city:
              type: string
              description: Franchise city
            region:
              type: string
              nullable: true
              description: Franchise region

    PersonnelBasicInfo:
      type: object
      description: Basic information for personnel (staff, drivers, manager)
      properties:
        id:
          type: string
          format: uuid
          description: Personnel ID
        name:
          type: string
          description: Full name (for staff and manager) or combined first and last name (for drivers)
        email:
          type: string
          format: email
          description: Email address
        phone:
          type: string
          nullable: true
          description: Phone number

    CreateStaffResponse:
      type: object
      properties:
        message:
          type: string
          description: Success message
          example: "Staff member created successfully"
        data:
          $ref: "#/components/schemas/Staff"

    UpdateStaffRequest:
      type: object
      description: All fields are optional. Only provided fields will be updated.
      properties:
        name:
          type: string
          description: Full name of the staff member
          example: "John Doe"
          minLength: 1
          maxLength: 100
        email:
          type: string
          format: email
          description: Email address (must be unique if changed)
          example: "john.doe@drybros.com"
          maxLength: 255
        phone:
          type: string
          description: Phone number (must be unique if changed)
          example: "+1234567890"
          minLength: 10
          maxLength: 20
        franchiseId:
          type: string
          format: uuid
          description: Franchise ID (UUID) - allows reassigning to different franchise
          example: "550e8400-e29b-41d4-a716-446655440000"
        monthlySalary:
          type: number
          description: Monthly salary
          example: 50000
          minimum: 0
        address:
          type: string
          description: Full address
          example: "123 Main St, City, State 12345"
          minLength: 1
          maxLength: 500
        emergencyContact:
          type: string
          description: Emergency contact phone number
          example: "+1234567890"
          minLength: 10
          maxLength: 20
        emergencyContactRelation:
          type: string
          description: Relationship with emergency contact
          example: "Spouse"
          minLength: 1
          maxLength: 50
        govtId:
          type: boolean
          description: Whether government ID document is collected
          example: true
        addressProof:
          type: boolean
          description: Whether address proof document is collected
          example: true
        certificates:
          type: boolean
          description: Whether certificates are collected
          example: true
        previousExperienceCert:
          type: boolean
          description: Whether previous experience certificate is collected
          example: true
        profilePic:
          type: string
          nullable: true
          description: Profile picture URL
          example: "https://example.com/images/profile.jpg"
          maxLength: 500
          format: uri
        relieveDate:
          type: string
          format: date-time
          nullable: true
          description: Date when staff member was relieved/terminated
          example: "2024-12-31T00:00:00Z"
        relieveReason:
          type: string
          enum: [RESIGNATION, TERMINATION, RETIREMENT, CONTRACT_ENDED, PERFORMANCE_ISSUES, MISCONDUCT, OTHER]
          nullable: true
          description: Reason for relieving the staff member
          example: RESIGNATION
        isActive:
          type: boolean
          description: Whether the staff member is active
          example: true

    UpdateStaffStatusRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: [FIRED, SUSPENDED, BLOCKED, ACTIVE]
          description: |
            The new status for the staff member.
            - FIRED: Terminates the staff member
            - SUSPENDED: Suspends the staff member (can optionally set suspendedUntil)
            - BLOCKED: Blocks the staff member from accessing the system
            - ACTIVE: Reactivates a previously suspended/blocked/fired staff member
          example: SUSPENDED
        suspendedUntil:
          type: string
          format: date-time
          nullable: true
          description: |
            Optional suspension end date. Only valid when status is SUSPENDED.
            If not provided when status is SUSPENDED, the suspension is indefinite.
          example: "2024-02-01T00:00:00Z"

    StaffStatusResponse:
      type: object
      properties:
        message:
          type: string
          description: Success message
          example: "Staff member has been fired"
        data:
          $ref: "#/components/schemas/Staff"

    StaffHistory:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: History entry ID
        staffId:
          type: string
          format: uuid
          description: Staff member ID
        action:
          type: string
          description: Action performed (e.g., CREATED, UPDATED, DELETED, STATUS_CHANGED)
          example: "UPDATED"
        description:
          type: string
          nullable: true
          description: Detailed description of the action
          example: "Staff member John Doe updated"
        changedBy:
          type: string
          nullable: true
          description: User ID who made the change
          example: "550e8400-e29b-41d4-a716-446655440000"
        oldValue:
          type: string
          nullable: true
          description: JSON string of old values before the change
          example: '{"name":"John Doe","email":"john@example.com"}'
        newValue:
          type: string
          nullable: true
          description: JSON string of new values after the change
          example: '{"name":"John Smith","email":"john.smith@example.com"}'
        createdAt:
          type: string
          format: date-time
          description: When the action was performed
          example: "2024-01-20T10:30:00Z"

    StaffHistoryResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/StaffHistory"
          description: List of staff history entries, ordered by most recent first

    PaginatedStaffResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Staff"
          description: List of staff members for the current page
        pagination:
          type: object
          properties:
            page:
              type: integer
              description: Current page number
              example: 1
            limit:
              type: integer
              description: Number of items per page
              example: 10
            total:
              type: integer
              description: Total number of staff members
              example: 50
            totalPages:
              type: integer
              description: Total number of pages
              example: 5
            hasNext:
              type: boolean
              description: Whether there is a next page
              example: true
            hasPrev:
              type: boolean
              description: Whether there is a previous page
              example: false
          required:
            - page
            - limit
            - total
            - totalPages
            - hasNext
            - hasPrev

    Franchise:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Franchise ID (UUID)
          example: "550e8400-e29b-41d4-a716-446655440000"
        code:
          type: string
          description: Auto-generated unique franchise code (format: FRN-XXXXXX)
          example: "FRN-A1B2C3"
        name:
          type: string
          description: Franchise name
          example: "Downtown Branch"
        city:
          type: string
          description: City (kept for backward compatibility)
          example: "New York"
        region:
          type: string
          nullable: true
          description: Region where franchise is located
          example: "New York"
        address:
          type: string
          nullable: true
          description: Physical address of the franchise
          example: "123 Main Street, New York, NY 10001"
        phone:
          type: string
          nullable: true
          description: Contact number
          example: "+1234567890"
        inchargeName:
          type: string
          nullable: true
          description: Name of the person in charge
          example: "John Smith"
        storeImage:
          type: string
          nullable: true
          description: Store image URL
          example: "https://example.com/images/store.jpg"
        legalDocumentsCollected:
          type: boolean
          description: Flag indicating if legal documents have been collected
          example: false
        status:
          type: string
          enum: [ACTIVE, BLOCKED, TEMPORARILY_CLOSED]
          description: Franchise status
          example: "ACTIVE"
        isActive:
          type: boolean
          description: Whether the franchise is active
          example: true
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2024-01-20T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp
          example: "2024-01-20T10:30:00Z"

    CreateFranchiseRequest:
      type: object
      required:
        - name
        - region
        - address
        - phone
        - inchargeName
        - managerEmail
        - managerPhone
      properties:
        name:
          type: string
          description: Franchise name
          example: "Downtown Branch"
          minLength: 1
          maxLength: 100
        region:
          type: string
          description: Region where franchise is located
          example: "New York"
          minLength: 1
          maxLength: 100
        address:
          type: string
          description: Physical address of the franchise
          example: "123 Main Street, New York, NY 10001"
          minLength: 1
          maxLength: 500
        phone:
          type: string
          description: Contact number
          example: "+1234567890"
          minLength: 10
          maxLength: 20
        inchargeName:
          type: string
          description: Name of the person in charge
          example: "John Smith"
          minLength: 1
          maxLength: 100
        managerEmail:
          type: string
          format: email
          description: Email address of the manager (will be used to create manager user account)
          example: "john.smith@drybros.com"
          maxLength: 255
        managerPhone:
          type: string
          description: Phone number of the manager
          example: "+1234567891"
          pattern: "^[+]?[(]?[0-9]{1,4}[)]?[-\\s.]?[(]?[0-9]{1,4}[)]?[-\\s.]?[0-9]{1,9}$"
          minLength: 10
          maxLength: 20
        storeImage:
          type: string
          format: uri
          nullable: true
          description: Store image URL (optional)
          example: "https://example.com/images/store.jpg"
          maxLength: 500
        legalDocumentsCollected:
          type: boolean
          description: Flag indicating if legal documents have been collected
          example: false
          default: false

    CreateFranchiseResponse:
      type: object
      properties:
        message:
          type: string
          description: Success message
          example: "Franchise created successfully"
        data:
          $ref: "#/components/schemas/Franchise"

    UpdateFranchiseRequest:
      type: object
      description: All fields are optional - only provide fields you want to update
      properties:
        name:
          type: string
          description: Franchise name
          example: "Updated Downtown Branch"
          minLength: 1
          maxLength: 100
        region:
          type: string
          description: Region where franchise is located
          example: "New York City"
          minLength: 1
          maxLength: 100
        address:
          type: string
          description: Physical address of the franchise
          example: "456 Updated Street, New York, NY 10002"
          minLength: 1
          maxLength: 500
        phone:
          type: string
          description: Contact number
          example: "+1234567891"
          pattern: "^[+]?[(]?[0-9]{1,4}[)]?[-\\s.]?[(]?[0-9]{1,4}[)]?[-\\s.]?[0-9]{1,9}$"
          minLength: 10
          maxLength: 20
        inchargeName:
          type: string
          description: Name of the person in charge
          example: "Jane Doe"
          minLength: 1
          maxLength: 100
        storeImage:
          type: string
          format: uri
          nullable: true
          description: Store image URL (optional)
          example: "https://example.com/images/store-updated.jpg"
          maxLength: 500
        legalDocumentsCollected:
          type: boolean
          description: Flag indicating if legal documents have been collected
          example: true

    UpdateFranchiseStatusRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: [ACTIVE, BLOCKED, TEMPORARILY_CLOSED]
          description: New franchise status
          example: "BLOCKED"

    PaginationMeta:
      type: object
      description: Pagination metadata
      properties:
        page:
          type: integer
          description: Current page number
          example: 1
        limit:
          type: integer
          description: Number of items per page
          example: 10
        total:
          type: integer
          description: Total number of items
          example: 25
        totalPages:
          type: integer
          description: Total number of pages
          example: 3
        hasNext:
          type: boolean
          description: Whether there is a next page
          example: true
        hasPrev:
          type: boolean
          description: Whether there is a previous page
          example: false

    CreateComplaintRequest:
      type: object
      required:
        - title
        - description
      properties:
        driverId:
          type: string
          format: uuid
          description: Driver ID (required if staffId not provided)
          example: "550e8400-e29b-41d4-a716-446655440000"
        staffId:
          type: string
          format: uuid
          description: Staff ID (required if driverId not provided)
          example: "660e8400-e29b-41d4-a716-446655440001"
        customerId:
          type: string
          format: uuid
          description: Customer who raised the complaint (optional, for customer history)
        title:
          type: string
          minLength: 1
          maxLength: 200
          example: "Rude behavior complaint"
        description:
          type: string
          minLength: 1
          maxLength: 1000
          example: "Driver was rude to customer during trip"
        severity:
          type: string
          enum: [LOW, MEDIUM, HIGH, CRITICAL]
          default: MEDIUM
          example: "MEDIUM"

    UpdateComplaintStatusRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: [OPEN, IN_PROGRESS, RESOLVED, CLOSED]
          example: "RESOLVED"
        resolution:
          type: string
          maxLength: 500
          nullable: true
          description: Optional summary of resolution
          example: "Issue resolved after discussion with driver"
        action:
          type: string
          enum: [WARNING, FIRE]
          description: Required when status is RESOLVED. WARNING = issue warning; 2+ warnings auto-fire. FIRE = terminate.
        reason:
          type: string
          minLength: 1
          maxLength: 500
          description: Required when status is RESOLVED. Reason for the action taken.

    Complaint:
      type: object
      properties:
        id:
          type: string
          format: uuid
        driverId:
          type: string
          format: uuid
          nullable: true
        staffId:
          type: string
          format: uuid
          nullable: true
        customerId:
          type: string
          format: uuid
          nullable: true
          description: Customer who raised the complaint
        title:
          type: string
        description:
          type: string
        reportedBy:
          type: string
          format: uuid
          nullable: true
        status:
          type: string
          enum: [OPEN, IN_PROGRESS, RESOLVED, CLOSED]
        severity:
          type: string
          enum: [LOW, MEDIUM, HIGH, CRITICAL]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        resolvedAt:
          type: string
          format: date-time
          nullable: true
        resolvedBy:
          type: string
          format: uuid
          nullable: true
        resolution:
          type: string
          nullable: true
        resolutionAction:
          type: string
          enum: [WARNING, FIRE]
          nullable: true
          description: Action taken when resolved (WARNING or FIRE)
        resolutionReason:
          type: string
          nullable: true
          description: Reason for the action when resolved

    PaginatedComplaintResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Complaint"
        pagination:
          $ref: "#/components/schemas/PaginationMeta"

    ClockInRequest:
      type: object
      required: []
      properties:
        id:
          type: string
          format: uuid
          description: Single ID (UUID). You can also use driverId/staffId/userId.
          example: "550e8400-e29b-41d4-a716-446655440000"
        driverId:
          type: string
          format: uuid
          description: Driver ID (exactly one of id, driverId, staffId, or userId must be provided)
          example: "550e8400-e29b-41d4-a716-446655440000"
        staffId:
          type: string
          format: uuid
          description: Staff ID (exactly one of id, driverId, staffId, or userId must be provided)
          example: "660e8400-e29b-41d4-a716-446655440001"
        userId:
          type: string
          format: uuid
          description: User ID for managers (exactly one of id, driverId, staffId, or userId must be provided)
          example: "770e8400-e29b-41d4-a716-446655440002"

    ClockOutRequest:
      type: object
      required: []
      properties:
        id:
          type: string
          format: uuid
          description: Single ID (UUID). You can also use driverId/staffId/userId.
          example: "550e8400-e29b-41d4-a716-446655440000"
        driverId:
          type: string
          format: uuid
          description: Driver ID (exactly one of id, driverId, staffId, or userId must be provided)
          example: "550e8400-e29b-41d4-a716-446655440000"
        staffId:
          type: string
          format: uuid
          description: Staff ID (exactly one of id, driverId, staffId, or userId must be provided)
          example: "660e8400-e29b-41d4-a716-446655440001"
        userId:
          type: string
          format: uuid
          description: User ID for managers (exactly one of id, driverId, staffId, or userId must be provided)
          example: "770e8400-e29b-41d4-a716-446655440002"
    
    AttendanceSession:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Attendance session ID
        clockIn:
          type: string
          format: date-time
          description: Session clock-in time
        clockOut:
          type: string
          format: date-time
          nullable: true
          description: Session clock-out time (null if still open)
        notes:
          type: string
          nullable: true
          description: Optional session notes

    ClockAttendanceResponse:
      type: object
      description: |
        Slim response for clock-in/clock-out endpoints.
        Includes only the relevant person id (driverId OR staffId OR userId).
      properties:
        id:
          type: string
          format: uuid
          description: Attendance record ID
        driverId:
          type: string
          format: uuid
          description: Driver ID (present only when the attendance belongs to a driver)
        staffId:
          type: string
          format: uuid
          description: Staff ID (present only when the attendance belongs to a staff member)
        userId:
          type: string
          format: uuid
          description: User ID (present only when the attendance belongs to a manager)
        date:
          type: string
          format: date
          description: Date of attendance
        loginTime:
          type: string
          format: date-time
          nullable: true
          description: Time when user logged in
        clockIn:
          type: string
          format: date-time
          nullable: true
          description: Last clock-in time recorded on the attendance header
        clockOut:
          type: string
          format: date-time
          nullable: true
          description: Last clock-out time recorded on the attendance header
        status:
          type: string
          enum: [PRESENT, ABSENT, LATE, HALF_DAY, ON_LEAVE]
          description: Attendance status

    CreateAttendanceRequest:
      type: object
      required:
        - date
      properties:
        driverId:
          type: string
          format: uuid
          description: Driver ID (exactly one of driverId, staffId, or userId must be provided)
          example: "550e8400-e29b-41d4-a716-446655440000"
        staffId:
          type: string
          format: uuid
          description: Staff ID (exactly one of driverId, staffId, or userId must be provided)
          example: "660e8400-e29b-41d4-a716-446655440001"
        userId:
          type: string
          format: uuid
          description: User ID for managers (exactly one of driverId, staffId, or userId must be provided)
          example: "770e8400-e29b-41d4-a716-446655440002"
        date:
          type: string
          format: date-time
          description: Date for the attendance record
          example: "2024-01-25T00:00:00Z"
        loginTime:
          type: string
          format: date-time
          nullable: true
          description: Time when user logged in
          example: "2024-01-25T09:00:00Z"
        clockIn:
          type: string
          format: date-time
          nullable: true
          description: Time when user clocked in
          example: "2024-01-25T09:30:00Z"
        clockOut:
          type: string
          format: date-time
          nullable: true
          description: Time when user clocked out
          example: "2024-01-25T18:00:00Z"
        status:
          type: string
          enum: [PRESENT, ABSENT, LATE, HALF_DAY, ON_LEAVE]
          default: PRESENT
          description: Attendance status
          example: "PRESENT"
        notes:
          type: string
          maxLength: 500
          nullable: true
          description: Optional notes
          example: "Regular attendance"

    UpdateAttendanceRequest:
      type: object
      required: []
      properties:
        loginTime:
          type: string
          format: date-time
          nullable: true
          description: Time when user logged in
          example: "2024-01-25T09:00:00Z"
        clockIn:
          type: string
          format: date-time
          nullable: true
          description: Time when user clocked in
          example: "2024-01-25T09:30:00Z"
        clockOut:
          type: string
          format: date-time
          nullable: true
          description: Time when user clocked out
          example: "2024-01-25T18:00:00Z"
        status:
          type: string
          enum: [PRESENT, ABSENT, LATE, HALF_DAY, ON_LEAVE]
          description: Attendance status
          example: "PRESENT"
        notes:
          type: string
          maxLength: 500
          nullable: true
          description: Optional notes
          example: "Updated notes"

    UpdateAttendanceStatusRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: [PRESENT, ABSENT, LATE, HALF_DAY, ON_LEAVE]
          description: Attendance status
          example: "PRESENT"
        description:
          type: string
          maxLength: 500
          nullable: true
          description: Optional description explaining the status change (max 500 characters)
          example: "Employee arrived late due to traffic"

    Attendance:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Attendance record ID
        driverId:
          type: string
          format: uuid
          nullable: true
          description: Driver ID (if attendance is for a driver)
        staffId:
          type: string
          format: uuid
          nullable: true
          description: Staff ID (if attendance is for a staff member)
        userId:
          type: string
          format: uuid
          nullable: true
          description: User ID (if attendance is for a manager)
        date:
          type: string
          format: date
          description: Date of attendance
        loginTime:
          type: string
          format: date-time
          nullable: true
          description: Time when user logged in
        clockIn:
          type: string
          format: date-time
          nullable: true
          description: Time when user clocked in
        clockOut:
          type: string
          format: date-time
          nullable: true
          description: Time when user clocked out
        status:
          type: string
          enum: [PRESENT, ABSENT, LATE, HALF_DAY, ON_LEAVE]
          description: Attendance status
        notes:
          type: string
          nullable: true
          description: Optional notes
        sessions:
          type: array
          description: List of clock-in/clock-out sessions for this date (history)
          items:
            $ref: "#/components/schemas/AttendanceSession"
        createdAt:
          type: string
          format: date-time
          description: Record creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Record last update timestamp

    PaginatedAttendanceResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Attendance"
        pagination:
          $ref: "#/components/schemas/PaginationMeta"

    CreateLeaveRequestRequest:
      type: object
      required:
        - startDate
        - endDate
        - reason
        - leaveType
      properties:
        driverId:
          type: string
          format: uuid
          description: Driver ID (required if staffId not provided)
          example: "550e8400-e29b-41d4-a716-446655440000"
        staffId:
          type: string
          format: uuid
          description: Staff ID (required if driverId not provided)
          example: "660e8400-e29b-41d4-a716-446655440001"
        startDate:
          type: string
          format: date-time
          example: "2024-02-01T00:00:00Z"
        endDate:
          type: string
          format: date-time
          example: "2024-02-05T00:00:00Z"
        reason:
          type: string
          minLength: 1
          maxLength: 500
          example: "Family emergency"
        leaveType:
          type: string
          enum: [SICK_LEAVE, CASUAL_LEAVE, EARNED_LEAVE, EMERGENCY_LEAVE, OTHER]
          example: "EMERGENCY_LEAVE"

    UpdateLeaveRequestStatusRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: [PENDING, APPROVED, REJECTED, CANCELLED]
          example: "APPROVED"
        rejectionReason:
          type: string
          maxLength: 500
          nullable: true
          example: "Insufficient leave balance"

    LeaveRequest:
      type: object
      properties:
        id:
          type: string
          format: uuid
        driverId:
          type: string
          format: uuid
          nullable: true
        staffId:
          type: string
          format: uuid
          nullable: true
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        reason:
          type: string
        leaveType:
          type: string
          enum: [SICK_LEAVE, CASUAL_LEAVE, EARNED_LEAVE, EMERGENCY_LEAVE, OTHER]
        status:
          type: string
          enum: [PENDING, APPROVED, REJECTED, CANCELLED]
        requestedBy:
          type: string
          format: uuid
          nullable: true
        approvedBy:
          type: string
          format: uuid
          nullable: true
        approvedAt:
          type: string
          format: date-time
          nullable: true
        rejectionReason:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PaginatedLeaveRequestResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/LeaveRequest"
        pagination:
          $ref: "#/components/schemas/PaginationMeta"

    CreateDriverRatingRequest:
      type: object
      required:
        - driverId
        - customerName
        - customerPhone
        - overallRating
        - drivingSafety
        - drivingSmoothness
        - behaviorPoliteness
      properties:
        driverId:
          type: string
          format: uuid
          description: Driver ID
          example: "550e8400-e29b-41d4-a716-446655440000"
        tripId:
          type: string
          format: uuid
          description: Trip ID (optional, but if provided, only one rating per trip is allowed)
          example: "660e8400-e29b-41d4-a716-446655440001"
        customerName:
          type: string
          minLength: 1
          maxLength: 100
          example: "John Doe"
        customerPhone:
          type: string
          minLength: 10
          maxLength: 20
          example: "+1234567890"
        customerEmail:
          type: string
          format: email
          maxLength: 255
          example: "john.doe@example.com"
        overallRating:
          type: number
          minimum: 1
          maximum: 5
          description: Overall rating (1-5)
          example: 4.5
        experience:
          type: string
          maxLength: 1000
          nullable: true
          description: How was the experience (text feedback)
          example: "Great driver, very professional and safe. Smooth ride throughout."
        drivingSafety:
          type: number
          minimum: 1
          maximum: 5
          description: Safety rating (1-5)
          example: 5
        drivingSmoothness:
          type: number
          minimum: 1
          maximum: 5
          description: Smoothness rating (1-5)
          example: 4
        behaviorPoliteness:
          type: number
          minimum: 1
          maximum: 5
          description: Politeness rating (1-5)
          example: 5

    DriverRating:
      type: object
      properties:
        id:
          type: string
          format: uuid
        driverId:
          type: string
          format: uuid
        tripId:
          type: string
          format: uuid
          nullable: true
        customerName:
          type: string
        customerPhone:
          type: string
        customerEmail:
          type: string
          nullable: true
        overallRating:
          type: number
          description: Overall rating (1-5)
        experience:
          type: string
          nullable: true
          description: Experience feedback
        drivingSafety:
          type: number
          description: Safety rating (1-5)
        drivingSmoothness:
          type: number
          description: Smoothness rating (1-5)
        behaviorPoliteness:
          type: number
          description: Politeness rating (1-5)
        isVerified:
          type: boolean
          description: Whether rating is verified
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PaginatedDriverRatingResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/DriverRating"
        pagination:
          $ref: "#/components/schemas/PaginationMeta"

    ActivityLog:
      type: object
      properties:
        id:
          type: string
          format: uuid
        action:
          type: string
          enum: [TRIP_CREATED, TRIP_ASSIGNED, TRIP_ACCEPTED, TRIP_REJECTED, TRIP_STARTED, TRIP_ENDED, TRIP_CANCELLED, TRIP_STATUS_CHANGED, TRIP_UPDATED, DRIVER_CREATED, DRIVER_UPDATED, DRIVER_STATUS_CHANGED, DRIVER_CLOCK_IN, DRIVER_CLOCK_OUT, STAFF_CREATED, STAFF_UPDATED, STAFF_STATUS_CHANGED, STAFF_CLOCK_IN, STAFF_CLOCK_OUT, COMPLAINT_CREATED, COMPLAINT_RESOLVED, COMPLAINT_STATUS_CHANGED, LEAVE_REQUESTED, LEAVE_APPROVED, LEAVE_REJECTED, LEAVE_CANCELLED, RATING_SUBMITTED, ATTENDANCE_RECORDED, CUSTOMER_CREATED, CUSTOMER_UPDATED, FRANCHISE_CREATED, FRANCHISE_UPDATED, FRANCHISE_STATUS_CHANGED]
        entityType:
          type: string
          enum: [TRIP, DRIVER, STAFF, CUSTOMER, FRANCHISE, COMPLAINT, LEAVE_REQUEST, RATING, ATTENDANCE, OTHER]
        entityId:
          type: string
          nullable: true
        franchiseId:
          type: string
          format: uuid
          nullable: true
        driverId:
          type: string
          format: uuid
          nullable: true
        staffId:
          type: string
          format: uuid
          nullable: true
        tripId:
          type: string
          format: uuid
          nullable: true
        userId:
          type: string
          format: uuid
          nullable: true
        description:
          type: string
        metadata:
          type: object
          nullable: true
          description: Additional data about the activity
        createdAt:
          type: string
          format: date-time
        user:
          type: object
          nullable: true
          properties:
            id:
              type: string
              format: uuid
            fullName:
              type: string
            email:
              type: string
            role:
              type: string
        franchise:
          type: object
          nullable: true
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
            code:
              type: string
        driver:
          type: object
          nullable: true
          properties:
            id:
              type: string
              format: uuid
            firstName:
              type: string
            lastName:
              type: string
            driverCode:
              type: string
        staff:
          type: object
          nullable: true
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
            email:
              type: string
        trip:
          type: object
          nullable: true
          properties:
            id:
              type: string
              format: uuid
            customerName:
              type: string
            status:
              type: string

    PaginatedActivityLogResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/ActivityLog"
        pagination:
          $ref: "#/components/schemas/PaginationMeta"

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error message
          example: "Account is temporarily locked due to multiple failed login attempts. Please try again in 5 minute(s)."

    CreateDriverRequest:
      type: object
      required:
        - firstName
        - lastName
        - phone
        - email
        - password
        - emergencyContactName
        - emergencyContactPhone
        - emergencyContactRelation
        - address
        - city
        - state
        - pincode
        - licenseNumber
        - licenseExpDate
        - bankAccountName
        - bankAccountNumber
        - bankIfscCode
        - carTypes
        - franchiseId
      properties:
        firstName:
          type: string
          description: Driver's first name
          example: "John"
        lastName:
          type: string
          description: Driver's last name
          example: "Doe"
        phone:
          type: string
          description: Primary phone number (must be unique)
          example: "+1234567890"
        email:
          type: string
          format: email
          description: Email address (must be unique)
          example: "john.doe@example.com"
        altPhone:
          type: string
          description: Alternate phone number (optional)
          example: "+1234567891"
        password:
          type: string
          minLength: 6
          description: Password for web login (auto-generated from frontend, will be used for both app and web login)
          example: "SecurePass123!"
        emergencyContactName:
          type: string
          description: Emergency contact person's name
          example: "Jane Doe"
        emergencyContactPhone:
          type: string
          description: Emergency contact phone number
          example: "+1234567892"
        emergencyContactRelation:
          type: string
          description: Relationship with emergency contact
          example: "Spouse"
        address:
          type: string
          description: Street address
          example: "123 Main Street"
        city:
          type: string
          description: City
          example: "New York"
        state:
          type: string
          description: State
          example: "NY"
        pincode:
          type: string
          minLength: 6
          description: Postal/ZIP code
          example: "10001"
        licenseNumber:
          type: string
          description: Driving license number
          example: "DL1234567890"
        licenseExpDate:
          type: string
          format: date-time
          description: License expiration date (must be in future)
          example: "2025-12-31T00:00:00Z"
        bankAccountName:
          type: string
          description: Bank account holder name
          example: "John Doe"
        bankAccountNumber:
          type: string
          description: Bank account number
          example: "1234567890"
        bankIfscCode:
          type: string
          description: Bank IFSC code
          example: "BANK0001234"
        aadharCard:
          type: boolean
          default: false
          description: Aadhar card collected
          example: true
        license:
          type: boolean
          default: false
          description: License document collected
          example: true
        educationCert:
          type: boolean
          default: false
          description: Education certificate collected
          example: false
        previousExp:
          type: boolean
          default: false
          description: Previous experience certificate collected
          example: true
        carTypes:
          type: array
          items:
            type: string
            enum: [MANUAL, AUTOMATIC, PREMIUM_CARS, LUXURY_CARS, SPORTY_CARS]
          minItems: 1
          description: Types of cars the driver can drive
          example: ["MANUAL", "AUTOMATIC"]
        franchiseId:
          type: string
          format: uuid
          description: Franchise ID (UUID)
          example: "74ce561e-fa14-47d1-b9b0-e991db4ced48"

    Driver:
      type: object
      properties:
        id:
          type: integer
          description: Driver ID
          example: 1
        franchiseId:
          type: integer
          description: Franchise ID
          example: 1
        firstName:
          type: string
          description: Driver's first name
          example: "John"
        lastName:
          type: string
          description: Driver's last name
          example: "Doe"
        phone:
          type: string
          description: Primary phone number
          example: "+1234567890"
        email:
          type: string
          format: email
          description: Email address
          example: "john.doe@example.com"
        altPhone:
          type: string
          nullable: true
          description: Alternate phone number
          example: "+1234567891"
        driverCode:
          type: string
          description: Auto-generated unique driver code for app login (format: DRV-XXXXXX)
          example: "DRV-A1B2C3"
        emergencyContactName:
          type: string
          description: Emergency contact person's name
          example: "Jane Doe"
        emergencyContactPhone:
          type: string
          description: Emergency contact phone number
          example: "+1234567892"
        emergencyContactRelation:
          type: string
          description: Relationship with emergency contact
          example: "Spouse"
        address:
          type: string
          description: Street address
          example: "123 Main Street"
        city:
          type: string
          description: City
          example: "New York"
        state:
          type: string
          description: State
          example: "NY"
        pincode:
          type: string
          description: Postal/ZIP code
          example: "10001"
        licenseNumber:
          type: string
          description: Driving license number
          example: "DL1234567890"
        licenseExpDate:
          type: string
          format: date-time
          description: License expiration date
          example: "2025-12-31T00:00:00Z"
        employmentType:
          type: string
          enum: ["part time", "full time", "contract"]
          description: Driver's employment type (API-facing string values)
          example: "full time"
        bankAccountName:
          type: string
          description: Bank account holder name
          example: "John Doe"
        bankAccountNumber:
          type: string
          description: Bank account number
          example: "1234567890"
        bankIfscCode:
          type: string
          description: Bank IFSC code
          example: "BANK0001234"
        aadharCard:
          type: boolean
          description: Aadhar card collected
          example: true
        license:
          type: boolean
          description: License document collected
          example: true
        educationCert:
          type: boolean
          description: Education certificate collected
          example: false
        previousExp:
          type: boolean
          description: Previous experience certificate collected
          example: true
        carTypes:
          type: array
          items:
            type: string
            enum: [MANUAL, AUTOMATIC, PREMIUM_CARS, LUXURY_CARS, SPORTY_CARS]
          description: Types of cars the driver can drive
          example: ["MANUAL", "AUTOMATIC"]
        status:
          type: string
          enum: [ACTIVE, INACTIVE, BLOCKED, TERMINATED]
          description: Driver status
          example: "ACTIVE"
        complaintCount:
          type: integer
          description: Number of complaints against the driver
          example: 0
        bannedGlobally:
          type: boolean
          description: Whether the driver is banned globally
          example: false
        dailyTargetAmount:
          type: integer
          nullable: true
          description: Daily target amount for the driver
          example: 5000
        cashInHand:
          type: number
          format: decimal
          description: Cash amount currently in driver's hand
          example: 0
        dailyStatus:
          type: object
          nullable: true
          description: Snapshot of today's driver daily status (limit + earnings)
          properties:
            dailyLimit:
              type: object
              properties:
                driverId:
                  type: string
                  description: Driver ID
                driverName:
                  type: string
                  description: Driver name
                dailyTargetAmount:
                  type: number
                  description: Effective daily target amount
                remainingDailyLimit:
                  type: number
                  description: Remaining daily limit
                usedDailyLimit:
                  type: number
                  description: Used daily limit
                cashInHand:
                  type: number
                  description: Current cash in hand
            dailyEarnings:
              type: object
              properties:
                driverId:
                  type: string
                  description: Driver ID
                date:
                  type: string
                  format: date
                  description: Date (YYYY-MM-DD)
                dailyTargetAmount:
                  type: number
                  description: Daily target amount used for earnings calculation
                amountRunToday:
                  type: number
                  description: Total amount earned today from completed trips
                tripsCountToday:
                  type: number
                  description: Number of completed trips today
                incentiveToday:
                  type: number
                  description: Calculated daily incentive
                incentiveType:
                  type: string
                  nullable: true
                  description: Type of incentive (full_extra or percentage)
                remainingToAchieve:
                  type: number
                  description: Remaining amount to achieve daily target
        incentive:
          type: number
          format: decimal
          nullable: true
          description: Incentive amount (e.g. daily/monthly)
          example: 500.00
        bonus:
          type: number
          format: decimal
          nullable: true
          description: Bonus amount
          example: 1000.00
        currentRating:
          type: number
          format: float
          nullable: true
          description: Current rating of the driver
          example: 4.5
        currentLat:
          type: number
          nullable: true
          description: Driver live latitude (updated by mobile app)
          example: 12.9716
        currentLng:
          type: number
          nullable: true
          description: Driver live longitude (updated by mobile app)
          example: 77.5946
        locationAccuracyM:
          type: number
          nullable: true
          description: GPS accuracy in meters
          example: 18
        locationUpdatedAt:
          type: string
          format: date-time
          nullable: true
          description: Timestamp of last live location update
          example: "2026-02-01T10:15:30Z"
        createdBy:
          type: integer
          nullable: true
          description: User ID who created this driver
          example: 1
        createdAt:
          type: string
          format: date-time
          description: When the driver was created
          example: "2024-01-20T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          description: When the driver was last updated
          example: "2024-01-20T10:30:00Z"

    DriverPerformanceMetrics:
      type: object
      description: Calculated performance metrics for a driver
      properties:
        category:
          type: string
          enum: [GREEN, YELLOW, RED]
          description: Performance category
          example: "GREEN"
        score:
          type: number
          format: float
          description: Performance score (0–100)
          example: 85
        rating:
          type: number
          format: float
          nullable: true
          description: Current driver rating
          example: 4.8
        complaintCount:
          type: integer
          description: Number of complaints
          example: 0
        totalTrips:
          type: integer
          description: Total trips in performance window
          example: 50
        completedTrips:
          type: integer
          description: Completed trips
          example: 48
        rejectedTrips:
          type: integer
          description: Trips rejected by driver
          example: 1
        completionRate:
          type: number
          format: float
          description: Completion rate (percentage)
          example: 96.0
        rejectionRate:
          type: number
          format: float
          description: Rejection rate (percentage)
          example: 2.0

    CreateDriverResponse:
      type: object
      properties:
        message:
          type: string
          description: Success message
          example: "Driver created successfully"
        data:
          $ref: "#/components/schemas/Driver"

    UpdateDriverRequest:
      type: object
      description: All fields are optional for partial updates. At least one field must be provided.
      properties:
        firstName:
          type: string
          description: Driver's first name
          example: "John"
        lastName:
          type: string
          description: Driver's last name
          example: "Smith"
        phone:
          type: string
          description: Primary phone number
          example: "+1234567890"
        email:
          type: string
          format: email
          description: Email address
          example: "john.smith@example.com"
        altPhone:
          type: string
          nullable: true
          description: Alternate phone number
          example: "+1234567891"
        password:
          type: string
          format: password
          description: Password (will be hashed before storage)
          example: "NewSecurePass123!"
        emergencyContactName:
          type: string
          description: Emergency contact person's name
          example: "Jane Smith"
        emergencyContactPhone:
          type: string
          description: Emergency contact phone number
          example: "+1234567892"
        emergencyContactRelation:
          type: string
          description: Relationship with emergency contact
          example: "Spouse"
        address:
          type: string
          description: Street address
          example: "456 Oak Avenue"
        city:
          type: string
          description: City
          example: "Los Angeles"
        state:
          type: string
          description: State
          example: "CA"
        pincode:
          type: string
          description: Postal/ZIP code
          example: "90001"
        licenseNumber:
          type: string
          description: Driving license number
          example: "DL9876543210"
        licenseExpDate:
          type: string
          format: date-time
          description: License expiration date (must be in the future)
          example: "2026-12-31T00:00:00Z"
        bankAccountName:
          type: string
          description: Bank account holder name
          example: "John Smith"
        bankAccountNumber:
          type: string
          description: Bank account number
          example: "9876543210"
        bankIfscCode:
          type: string
          description: Bank IFSC code
          example: "BANK0005678"
        aadharCard:
          type: boolean
          description: Aadhar card collected
          example: true
        license:
          type: boolean
          description: License document collected
          example: true
        educationCert:
          type: boolean
          description: Education certificate collected
          example: false
        previousExp:
          type: boolean
          description: Previous experience certificate collected
          example: true
        carTypes:
          type: array
          items:
            type: string
            enum: [MANUAL, AUTOMATIC, PREMIUM_CARS, LUXURY_CARS, SPORTY_CARS]
          description: Types of cars the driver can drive
          example: ["MANUAL", "AUTOMATIC"]
        franchiseId:
          type: string
          format: uuid
          description: Franchise ID (for reassigning driver to different franchise)
          example: "550e8400-e29b-41d4-a716-446655440001"
        status:
          type: string
          enum: [ACTIVE, INACTIVE, BLOCKED, TERMINATED]
          description: Driver status
          example: "ACTIVE"
        dailyTargetAmount:
          type: integer
          nullable: true
          description: Daily target amount for the driver
        incentive:
          type: number
          format: decimal
          nullable: true
          description: Incentive amount (e.g. daily/monthly)
          example: 500.00
        bonus:
          type: number
          format: decimal
          nullable: true
          description: Bonus amount
          example: 1000.00

    UpdateDriverResponse:
      type: object
      properties:
        message:
          type: string
          description: Success message
          example: "Driver updated successfully"
        data:
          $ref: "#/components/schemas/Driver"

    UpdateDriverStatusRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: [ACTIVE, INACTIVE, BLOCKED, TERMINATED]
          description: |
            Driver status:
            - ACTIVE: Reactivate driver
            - INACTIVE: Suspend driver (temporarily disable)
            - BLOCKED: Block driver (prevent access)
            - TERMINATED: Fire/terminate driver (permanent removal)
          example: "INACTIVE"

    UpdateDriverStatusResponse:
      type: object
      properties:
        message:
          type: string
          description: Success message with status change description
          example: "Driver has been suspended (inactive)"
        data:
          $ref: "#/components/schemas/Driver"

    PaginationInfo:
      type: object
      properties:
        page:
          type: integer
          description: Current page number
          example: 1
        limit:
          type: integer
          description: Number of items per page
          example: 10
        total:
          type: integer
          description: Total number of items
          example: 50
        totalPages:
          type: integer
          description: Total number of pages
          example: 5
        hasNext:
          type: boolean
          description: Whether there is a next page
          example: true
        hasPrev:
          type: boolean
          description: Whether there is a previous page
          example: false

    DriverLoginRequest:
      type: object
      required:
        - driverCode
        - password
      properties:
        driverCode:
          type: string
          description: Driver code (format: DRV-XXXXXX)
          example: "DRV-3ZSQIA"
        password:
          type: string
          format: password
          description: Driver password
          example: "SecurePass123!"

    DriverLoginResponse:
      type: object
      properties:
        accessToken:
          type: string
          description: JWT access token (expires in 1 hour)
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refreshToken:
          type: string
          description: JWT refresh token (expires in 8 hours)
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        driver:
          type: object
          properties:
            id:
              type: string
              format: uuid
              description: Driver ID
              example: "550e8400-e29b-41d4-a716-446655440000"
            driverCode:
              type: string
              description: Driver code
              example: "DRV-3ZSQIA"
            firstName:
              type: string
              description: Driver's first name
              example: "John"
            lastName:
              type: string
              description: Driver's last name
              example: "Doe"
            email:
              type: string
              format: email
              description: Driver's email address
              example: "john.doe@example.com"
            phone:
              type: string
              description: Driver's phone number
              example: "+1234567890"
            status:
              type: string
              enum: [ACTIVE, INACTIVE, BLOCKED, TERMINATED]
              description: Driver status
              example: "ACTIVE"

    DriverLocationUpdateRequest:
      type: object
      required:
        - lat
        - lng
      properties:
        lat:
          type: number
          minimum: -90
          maximum: 90
          description: Latitude
          example: 12.9716
        lng:
          type: number
          minimum: -180
          maximum: 180
          description: Longitude
          example: 77.5946
        accuracyM:
          type: number
          nullable: true
          minimum: 0
          description: Optional GPS accuracy in meters
          example: 18
        capturedAt:
          type: string
          format: date-time
          nullable: true
          description: Optional timestamp when location was captured on device
          example: "2026-02-01T10:15:30Z"

    DriverLocationUpdateResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/Driver"

    DriverLiveLocation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        firstName:
          type: string
        lastName:
          type: string
        phone:
          type: string
        driverCode:
          type: string
        franchiseId:
          type: string
          format: uuid
        currentLat:
          type: number
        currentLng:
          type: number
        locationUpdatedAt:
          type: string
          format: date-time
        driverTripStatus:
          type: string
    CreatePenaltyRequest:
      type: object
      required:
        - name
        - amount
        - type
      properties:
        name:
          type: string
          description: Penalty name
          minLength: 1
          maxLength: 200
        description:
          type: string
          description: Optional description
          maxLength: 500
          nullable: true
        amount:
          type: integer
          description: Penalty amount
          minimum: 1
        type:
          type: string
          enum: [PENALTY, DEDUCTION]
          description: Penalty type
        isActive:
          type: boolean
          description: Whether the penalty is active
          default: true
    UpdatePenaltyRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 200
        description:
          type: string
          maxLength: 500
          nullable: true
        amount:
          type: integer
          minimum: 1
        type:
          type: string
          enum: [PENALTY, DEDUCTION]
        isActive:
          type: boolean
    Penalty:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
          nullable: true
        amount:
          type: integer
        type:
          type: string
          enum: [PENALTY, DEDUCTION]
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    PaginatedPenaltyResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/Penalty"
        pagination:
          $ref: "#/components/schemas/PaginationMeta"
    ApplyPenaltyToDriverRequest:
      type: object
      required:
        - penaltyId
      properties:
        penaltyId:
          type: string
          format: uuid
        amount:
          type: integer
          minimum: 1
          nullable: true
        reason:
          type: string
          maxLength: 500
          nullable: true
        violationDate:
          type: string
          format: date-time
          nullable: true
    ApplyPenaltyToDriversRequest:
      type: object
      required:
        - penaltyId
      properties:
        penaltyId:
          type: string
          format: uuid
        driverIds:
          type: array
          nullable: true
          items:
            type: string
            format: uuid
        amount:
          type: integer
          minimum: 1
          nullable: true
        reason:
          type: string
          maxLength: 500
          nullable: true
        violationDate:
          type: string
          format: date-time
          nullable: true
    DriverPenalty:
      type: object
      properties:
        id:
          type: string
          format: uuid
        driverId:
          type: string
          format: uuid
        penaltyId:
          type: string
          format: uuid
        amount:
          type: integer
        reason:
          type: string
          nullable: true
        violationDate:
          type: string
          format: date-time
        appliedAt:
          type: string
          format: date-time
        appliedBy:
          type: string
          format: uuid
          nullable: true
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        driver:
          type: object
          nullable: true
          properties:
            id:
              type: string
              format: uuid
            firstName:
              type: string
            lastName:
              type: string
            driverCode:
              type: string
        penalty:
          $ref: "#/components/schemas/Penalty"
        appliedByUser:
          type: object
          nullable: true
          properties:
            id:
              type: string
              format: uuid
            fullName:
              type: string
            email:
              type: string
              format: email
    PaginatedDriverPenaltyResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/DriverPenalty"
        pagination:
          $ref: "#/components/schemas/PaginationMeta"
    SetDriverDailyLimitRequest:
      type: object
      required:
        - dailyTargetAmount
      properties:
        dailyTargetAmount:
          type: integer
          minimum: 1
    SetDriversDailyLimitRequest:
      type: object
      required:
        - dailyTargetAmount
      properties:
        driverIds:
          type: array
          nullable: true
          items:
            type: string
            format: uuid
        franchiseId:
          type: string
          format: uuid
          nullable: true
        dailyTargetAmount:
          type: integer
          minimum: 1
    TripOffer:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Offer ID
        tripId:
          type: string
          format: uuid
          description: Trip ID
        driverId:
          type: string
          format: uuid
          description: Driver ID
        status:
          type: string
          enum: [OFFERED, ACCEPTED, REJECTED, EXPIRED, CANCELLED]
          description: Offer status
        offeredAt:
          type: string
          format: date-time
        expiresAt:
          type: string
          format: date-time
        acceptedAt:
          type: string
          format: date-time
          nullable: true
        rejectedAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        Trip:
          description: Trip details (included in some endpoints)
          nullable: true
          $ref: "#/components/schemas/Trip"

    LogoutResponse:
      type: object
      properties:
        message:
          type: string
          description: Success message
          example: "Logged out successfully"

    CurrentUserResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            id:
              type: string
              format: uuid
              description: User ID
            fullName:
              type: string
              description: User's full name
            email:
              type: string
              format: email
              description: User's email address
            phone:
              type: string
              nullable: true
              description: User's phone number
            role:
              type: string
              enum: [ADMIN, DRIVER, STAFF, CUSTOMER, OFFICE_STAFF]
              description: User role
            isActive:
              type: boolean
              description: Whether the user account is active

    UpdateEarningsConfigRequest:
      type: object
      description: Request body for updating driver earnings configuration
      properties:
        dailyTargetDefault:
          type: number
          description: Default daily target amount
          example: 1250
          minimum: 0
        incentiveTier1Min:
          type: number
          description: Minimum amount for tier 1 incentive
          example: 1250
          minimum: 0
        incentiveTier1Max:
          type: number
          description: Maximum amount for tier 1 incentive
          example: 1550
          minimum: 0
        incentiveTier1Type:
          type: string
          enum: [full_extra, percent]
          description: Type of tier 1 incentive
          example: "full_extra"
        incentiveTier2Min:
          type: number
          description: Minimum amount for tier 2 incentive
          example: 1550
          minimum: 0
        incentiveTier2Percent:
          type: number
          description: Percentage for tier 2 incentive (e.g., 20 for 20%)
          example: 20
          minimum: 0
          maximum: 100
        monthlyBonusTiers:
          type: array
          description: Monthly bonus tiers
          items:
            type: object
            properties:
              minEarnings:
                type: number
                description: Minimum earnings to qualify for this bonus tier
                example: 25000
              bonus:
                type: number
                description: Bonus amount for this tier
                example: 3000
            required:
              - minEarnings
              - bonus
        monthlyDeductionTiers:
          type: array
          description: Monthly deduction policy tiers
          items:
            type: object
            properties:
              maxEarnings:
                type: number
                description: Maximum earnings for this deduction tier
                example: 26000
              cutPercent:
                type: number
                description: Percentage cut for this tier (e.g., 25 for 25%)
                example: 25
            required:
              - maxEarnings
              - cutPercent

    DriverEarningsConfigResponse:
      type: object
      description: Driver earnings configuration response
      properties:
        id:
          type: string
          format: uuid
        franchiseId:
          type: string
          format: uuid
          nullable: true
        driverId:
          type: string
          format: uuid
          nullable: true
        dailyTargetDefault:
          type: number
          example: 1250
        incentiveTier1Min:
          type: number
        incentiveTier1Max:
          type: number
        incentiveTier1Type:
          type: string
          enum: [full_extra, percent]
        incentiveTier2Min:
          type: number
        incentiveTier2Percent:
          type: number
        monthlyBonusTiers:
          type: array
          nullable: true
          items:
            type: object
            properties:
              minEarnings:
                type: number
              bonus:
                type: number
          example:
            - minEarnings: 25000
              bonus: 3000
            - minEarnings: 28000
              bonus: 500
        monthlyDeductionTiers:
          type: array
          nullable: true
          items:
            type: object
            properties:
              maxEarnings:
                type: number
              cutPercent:
                type: number
          example:
            - maxEarnings: 26000
              cutPercent: 25
            - maxEarnings: 22000
              cutPercent: 20
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: "2024-01-20T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-20T10:00:00Z"

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from login endpoint
