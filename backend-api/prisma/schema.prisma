enum DriverStatus {
  ACTIVE
  INACTIVE
  BLOCKED
  TERMINATED
}

enum TripType {
  CITY_ROUND
  CITY_DROPOFF
  LONG_ROUND
  LONG_DROPOFF
}

enum TripStatus {
  REQUESTED
  ASSIGNED
  DRIVER_ACCEPTED
  DRIVER_ON_THE_WAY
  IN_PROGRESS
  COMPLETED
  CANCELLED_BY_CUSTOMER
  CANCELLED_BY_OFFICE
  REJECTED_BY_DRIVER
}

enum PaymentStatus {
  PENDING
  PAID
  PARTIALLY_PAID
}

enum PaymentMode {
  CASH
  UPI
  CARD
  OTHER
}

enum UserRole {
  ADMIN
  OFFICE_STAFF
  DRIVER
}

enum CarType {
  MANUAL
  AUTOMATIC
  PREMIUM_CARS
  LUXURY_CARS
  SPORTY_CARS
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Franchise {
  id        Int       @id @default(autoincrement())
  code      String    @unique
  name      String
  city      String
  address   String?
  phone     String?

  isActive  Boolean   @default(true)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  drivers   Driver[]
  customers Customer[]
  trips     Trip[]
}


model Driver {
  id               Int           @id @default(autoincrement())
  franchiseId      Int
  franchise        Franchise     @relation(fields: [franchiseId], references: [id])

  // Basic Information
  firstName        String
  lastName         String
  phone            String        @unique
  email            String        @unique
  altPhone         String?
  driverCode       String        @unique
  password         String        // hashed password for web login

  // Emergency Contact
  emergencyContactName      String
  emergencyContactPhone     String
  emergencyContactRelation  String

  // Address
  address          String
  city             String
  state            String
  pincode          String

  // License Details
  licenseNumber    String
  licenseExpDate   DateTime

  // Bank Account Details
  bankAccountName  String
  bankAccountNumber String
  bankIfscCode     String

  // Documents Collected (Boolean flags)
  aadharCard       Boolean       @default(false)
  license          Boolean       @default(false)
  educationCert    Boolean       @default(false)
  previousExp      Boolean       @default(false)

  // Car Types Driver Can Drive (Array stored as comma-separated or JSON)
  carTypes         String        // JSON array of CarType enum values

  // Status and Rating
  status           DriverStatus  @default(ACTIVE)
  complaintCount   Int           @default(0)
  bannedGlobally   Boolean       @default(false)
  dailyTargetAmount Int?
  currentRating     Float?

  // Audit Fields
  createdBy        Int?          // User ID who created this driver
  creator         User?         @relation(fields: [createdBy], references: [id])
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  trips            Trip[]
}



model Customer {
  id        Int       @id @default(autoincrement())
  fullName  String
  phone     String    @unique
  email     String?
  city      String?
  notes     String?

  franchiseId Int
  franchise   Franchise @relation(fields: [franchiseId], references: [id])

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  trips     Trip[]
}

model Trip {
  id           Int          @id @default(autoincrement())

  franchiseId  Int
  franchise    Franchise    @relation(fields: [franchiseId], references: [id])

  driverId     Int?
  driver       Driver?      @relation(fields: [driverId], references: [id])

  customerId    Int
  customer      Customer     @relation(fields: [customerId], references: [id])

  customerName  String
  customerPhone String

  tripType     TripType
  status       TripStatus    @default(REQUESTED)

  pickupLocation String
  dropLocation   String?

  scheduledAt   DateTime?
  startedAt     DateTime?
  endedAt       DateTime?

  startOtp      String?
  endOtp        String?

  baseAmount       Int
  extraAmount      Int         @default(0)
  totalAmount      Int
  finalAmount      Int
  isAmountOverridden Boolean   @default(false)
  overrideReason    String?

  paymentStatus     PaymentStatus @default(PENDING)
  paymentMode       PaymentMode?
  paymentReference  String?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String   // hashed
  fullName  String
  role      UserRole
  isActive  Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  createdDrivers Driver[]
}
