generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Customer {
  id          String       @id @default(uuid()) @db.Uuid
  fullName    String
  phone       String       @unique
  email       String?
  city        String?
  notes       String?
  franchiseId String       @db.Uuid
  createdAt   DateTime     @default(now())
  updatedAt   DateTime
  Complaints  Complaint[]
  Franchise   Franchise    @relation(fields: [franchiseId], references: [id])
  Trip        Trip[]
  TripReviews TripReview[]
}

model Driver {
  id                       String                     @id @default(uuid()) @db.Uuid
  franchiseId              String                     @db.Uuid
  firstName                String
  lastName                 String
  phone                    String                     @unique
  email                    String                     @unique
  altPhone                 String?
  driverCode               String                     @unique
  password                 String
  emergencyContactName     String
  emergencyContactPhone    String
  emergencyContactRelation String
  address                  String
  city                     String
  state                    String
  pincode                  String
  licenseNumber            String
  licenseExpDate           DateTime
  licenseType              String?
  employmentType           DriverEmploymentType?
  bankAccountName          String
  bankAccountNumber        String
  bankIfscCode             String
  aadharCard               Boolean                    @default(false)
  license                  Boolean                    @default(false)
  educationCert            Boolean                    @default(false)
  previousExp              Boolean                    @default(false)
  status                   DriverStatus               @default(ACTIVE)
  driverTripStatus         DriverTripStatus           @default(AVAILABLE)
  complaintCount           Int                        @default(0)
  warningCount             Int                        @default(0)
  blacklisted              Boolean                    @default(false)
  bannedGlobally           Boolean                    @default(false)
  dailyTargetAmount        Int?
  remainingDailyLimit      Decimal?                   @db.Decimal(10, 2)
  cashInHand               Decimal                    @default(0) @db.Decimal(10, 2)
  incentive                Decimal?                   @db.Decimal(10, 2)
  bonus                    Decimal?                   @db.Decimal(10, 2)
  currentRating            Float?
  currentLat               Float?
  currentLng               Float?
  locationAccuracyM        Float?
  locationUpdatedAt        DateTime?
  isActive                 Boolean                    @default(true)
  createdBy                String?                    @db.Uuid
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @updatedAt
  lastStatusChange         DateTime?
  onlineStatus             Boolean                    @default(false)
  failedAttempts           Int                        @default(0)
  lockedUntil              DateTime?
  ActivityLogs             ActivityLog[]
  Attendances              Attendance[]
  Complaints               Complaint[]
  Cars                     DriverCar[]
  DriverDailyMetrics       DriverDailyMetrics[]
  DriverMonthlyPerformance DriverMonthlyPerformance[]
  DriverPayroll            DriverPayroll[]
  DriverRatings            DriverRating[]
  DriverTransactions       DriverTransaction[]
  LeaveRequests            LeaveRequest[]
  PickupRequest            PickupRequest[]
  Trip                     Trip[]
  TripOffers               TripOffer[]
  TripReviews              TripReview[]
  TripStatusHistories      TripStatusHistory[]
  Warnings                 Warning[]
}

model DriverCar {
  id             String       @id @default(uuid()) @db.Uuid
  driverId       String       @db.Uuid
  carType        CarType
  transmission   Transmission
  brand          String?
  model          String?
  registrationNo String       @unique
  color          String?
  isPrimary      Boolean      @default(false)
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  Driver         Driver       @relation(fields: [driverId], references: [id], onDelete: Cascade)
  Trips          Trip[]

  @@index([driverId])
  @@index([carType])
  @@index([transmission])
}

model Franchise {
  id                          String                        @id @default(uuid()) @db.Uuid
  code                        String                        @unique
  name                        String
  city                        String
  region                      String?
  averageRating               Float?
  address                     String?
  phone                       String?
  email                       String?
  inchargeName                String?
  storeImage                  String?
  legalDocumentsCollected     Boolean                       @default(false)
  status                      FranchiseStatus               @default(ACTIVE)
  isActive                    Boolean                       @default(true)
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime                      @updatedAt
  managerEmail                String?
  managerPhone                String?
  ActivityLogs                ActivityLog[]
  Customer                    Customer[]
  DriverMonthlyPerformance    DriverMonthlyPerformance[]
  DriverPayroll               DriverPayroll[]
  FranchiseMonthlyPerformance FranchiseMonthlyPerformance[]
  Holidays                    Holiday[]
  ManagerMonthlyPerformance   ManagerMonthlyPerformance[]
  Staff                       Staff[]
  StaffMonthlyPerformance     StaffMonthlyPerformance[]
  Trip                        Trip[]
  TripReviews                 TripReview[]
  WorkingTimeConfigs          WorkingTimeConfig[]
}

model Role {
  name        String   @unique
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  id          String   @id @default(uuid()) @db.Uuid
}

model Staff {
  id                       String                    @id @default(uuid()) @db.Uuid
  name                     String
  phone                    String                    @unique
  password                 String
  franchiseId              String                    @db.Uuid
  monthlySalary            Decimal                   @db.Decimal(10, 2)
  address                  String
  emergencyContact         String
  emergencyContactRelation String
  profilePic               String?
  isActive                 Boolean                   @default(true)
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime
  govtId                   Boolean                   @default(false)
  addressProof             Boolean                   @default(false)
  certificates             Boolean                   @default(false)
  previousExperienceCert   Boolean                   @default(false)
  email                    String                    @unique
  status                   StaffStatus               @default(ACTIVE)
  warningCount             Int                       @default(0)
  suspendedUntil           DateTime?
  joinDate                 DateTime                  @default(now())
  relieveDate              DateTime?
  relieveReason            RelieveReason?
  lastStatusChange         DateTime?
  onlineStatus             Boolean                   @default(false)
  failedAttempts           Int                       @default(0)
  lockedUntil              DateTime?
  ActivityLog              ActivityLog[]
  Attendances              Attendance[]
  Complaints               Complaint[]
  LeaveRequests            LeaveRequest[]
  Franchise                Franchise                 @relation(fields: [franchiseId], references: [id])
  StaffHistory             StaffHistory[]
  StaffMonthlyPerformance  StaffMonthlyPerformance[]
  Warnings                 Warning[]

  @@index([franchiseId, isActive])
  @@index([franchiseId, status])
}

model StaffHistory {
  id          String   @id @default(uuid()) @db.Uuid
  staffId     String   @db.Uuid
  action      String
  description String?
  changedBy   String?
  oldValue    String?
  newValue    String?
  createdAt   DateTime @default(now())
  Staff       Staff    @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([staffId])
}

model Trip {
  franchiseId           String              @db.Uuid
  driverId              String?             @db.Uuid
  customerId            String?             @db.Uuid
  customerName          String
  customerPhone         String
  tripType              String
  status                TripStatus          @default(NOT_ASSIGNED)
  pickupLocation        String
  pickupLat             Float?
  pickupLng             Float?
  dropLocation          String?
  dropLat               Float?
  dropLng               Float?
  destinationLat        Float?
  destinationLng        Float?
  scheduledAt           DateTime?
  startedAt             DateTime?
  endedAt               DateTime?
  startOtp              String?
  endOtp                String?
  baseAmount            Int
  extraAmount           Int                 @default(0)
  totalAmount           Int
  finalAmount           Int
  isAmountOverridden    Boolean             @default(false)
  overrideReason        String?
  paymentStatus         PaymentStatus       @default(PENDING)
  paymentMode           PaymentMode?
  paymentReference      String?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime
  alternativePhone      String?
  customerEmail         String?
  dropLocationNote      String?
  isDetailsReconfirmed  Boolean             @default(false)
  isFareDiscussed       Boolean             @default(false)
  isPriceAccepted       Boolean             @default(false)
  pickupLocationNote    String?
  id                    String              @id @default(uuid()) @db.Uuid
  tripPlacedDate        DateTime            @default(now())
  createdBy             String?             @db.Uuid
  dropAddress           String?
  pickupAddress         String?
  startOdometer         Float?
  endOdometer           Float?
  carImageFront         String?
  carImageBack          String?
  driverSelfieUrl       String?
  endTime               DateTime?
  liveLocationLat       Float?
  liveLocationLng       Float?
  odometerEndImageUrl   String?
  odometerStartImageUrl String?
  startTime             DateTime?
  assignedCarId         String?             @db.Uuid
  requiredCarType       CarType?
  requiredTransmission  Transmission?
  ActivityLogs          ActivityLog[]
  Complaints            Complaint[]
  DriverRatings         DriverRating[]
  DriverTransactions    DriverTransaction[]
  PickupRequest         PickupRequest[]
  AssignedCar           DriverCar?          @relation(fields: [assignedCarId], references: [id])
  User                  User?               @relation(fields: [createdBy], references: [id])
  Customer              Customer?           @relation(fields: [customerId], references: [id])
  Driver                Driver?             @relation(fields: [driverId], references: [id])
  Franchise             Franchise           @relation(fields: [franchiseId], references: [id])
  TripOffers            TripOffer[]
  TripReassignment      TripReassignment[]
  TripReschedule        TripReschedule[]
  TripReviews           TripReview[]
  TripStatusHistories   TripStatusHistory[]

  @@index([assignedCarId])
}

model TripOffer {
  id         String          @id @default(uuid()) @db.Uuid
  tripId     String          @db.Uuid
  driverId   String          @db.Uuid
  status     TripOfferStatus @default(OFFERED)
  offeredAt  DateTime        @default(now())
  expiresAt  DateTime
  acceptedAt DateTime?
  rejectedAt DateTime?
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
  Driver     Driver          @relation(fields: [driverId], references: [id], onDelete: Cascade)
  Trip       Trip            @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@unique([tripId, driverId])
  @@index([driverId, status, expiresAt])
  @@index([tripId, status])
  @@index([expiresAt])
}

model TripTypeConfig {
  id               String          @id @default(uuid()) @db.Uuid
  baseDistance     Float?
  extraPerHour     Float?
  extraPerHalfHour Float?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  baseHour         Float?
  baseAmount       Float
  carCategory      CarCategory
  distanceSlab     Json?
  extraPerDistance Float?
  timeSlab         Json?
  type             TripPricingType
  description      String?
  name             String

  @@unique([name, carCategory])
  @@index([type])
  @@index([carCategory])
  @@index([name])
}

model User {
  email                     String                      @unique
  password                  String
  fullName                  String
  role                      UserRole
  isActive                  Boolean                     @default(true)
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
  phone                     String?
  id                        String                      @id @default(uuid()) @db.Uuid
  failedAttempts            Int                         @default(0)
  lockedUntil               DateTime?
  franchiseId               String?                     @db.Uuid
  ActivityLogs              ActivityLog[]
  Attendances               Attendance[]
  AppliedTransactions       DriverTransaction[]         @relation("AppliedTransactions")
  Holidays                  Holiday[]
  LeaveRequests             LeaveRequest[]
  ManagerMonthlyPerformance ManagerMonthlyPerformance[]
  Trip                      Trip[]
  TripStatusHistories       TripStatusHistory[]
  CreatedWarnings           Warning[]
  WorkingTimeConfigs        WorkingTimeConfig[]

  @@index([lockedUntil])
  @@index([franchiseId])
  @@index([role, franchiseId])
}

model DriverEarningsConfig {
  id                    String   @id @default(uuid()) @db.Uuid
  franchiseId           String?  @db.Uuid
  driverId              String?  @db.Uuid
  dailyTargetDefault    Int      @default(1250)
  incentiveTier1Min     Int      @default(1250)
  incentiveTier1Max     Int      @default(1550)
  incentiveTier1Type    String   @default("full_extra")
  incentiveTier2Min     Int      @default(1550)
  incentiveTier2Percent Int      @default(20)
  monthlyBonusTiers     Json?
  monthlyDeductionTiers Json?
  isActive              Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  updatedBy             String?  @db.Uuid

  @@index([franchiseId])
  @@index([driverId])
  @@index([franchiseId, driverId])
}

model Complaint {
  id               String                     @id @default(uuid()) @db.Uuid
  driverId         String?                    @db.Uuid
  staffId          String?                    @db.Uuid
  customerId       String?                    @db.Uuid
  title            String
  description      String
  reportedBy       String?                    @db.Uuid
  status           ComplaintStatus            @default(RECEIVED)
  createdAt        DateTime                   @default(now())
  updatedAt        DateTime                   @updatedAt
  resolvedAt       DateTime?
  resolvedBy       String?                    @db.Uuid
  resolution       String?
  resolutionAction ComplaintResolutionAction?
  resolutionReason String?
  customerName     String
  priority         ComplaintPriority          @default(MEDIUM)
  tripId           String?                    @db.Uuid
  Customer         Customer?                  @relation(fields: [customerId], references: [id])
  Driver           Driver?                    @relation(fields: [driverId], references: [id], onDelete: Cascade)
  Staff            Staff?                     @relation(fields: [staffId], references: [id], onDelete: Cascade)
  Trip             Trip?                      @relation(fields: [tripId], references: [id])

  @@index([driverId])
  @@index([staffId])
  @@index([customerId])
  @@index([tripId])
  @@index([status])
  @@index([createdAt])
}

model Warning {
  id            String          @id @default(uuid()) @db.Uuid
  driverId      String?         @db.Uuid
  staffId       String?         @db.Uuid
  reason        String
  priority      WarningPriority @default(MEDIUM)
  createdBy     String?         @db.Uuid
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  CreatedByUser User?           @relation(fields: [createdBy], references: [id])
  Driver        Driver?         @relation(fields: [driverId], references: [id], onDelete: Cascade)
  Staff         Staff?          @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@index([driverId])
  @@index([staffId])
  @@index([createdAt])
}

model Attendance {
  id                    String              @id @default(uuid()) @db.Uuid
  driverId              String?             @db.Uuid
  staffId               String?             @db.Uuid
  userId                String?             @db.Uuid
  date                  DateTime            @db.Date
  loginTime             DateTime?
  clockIn               DateTime?
  clockOut              DateTime?
  status                AttendanceStatus    @default(PRESENT)
  notes                 String?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  firstOnlineAt         DateTime?
  lastOfflineAt         DateTime?
  totalOnlineMinutes    Int?
  tripsCompleted        Int                 @default(0)
  earlyDepartureMinutes Int                 @default(0)
  isHalfDay             Boolean             @default(false)
  isLate                Boolean             @default(false)
  lateByMinutes         Int                 @default(0)
  logoutTime            DateTime?
  lunchBreakEnd         DateTime?
  lunchBreakStart       DateTime?
  snackBreakEnd         DateTime?
  snackBreakStart       DateTime?
  totalWorkMinutes      Int?
  Driver                Driver?             @relation(fields: [driverId], references: [id], onDelete: Cascade)
  Staff                 Staff?              @relation(fields: [staffId], references: [id], onDelete: Cascade)
  User                  User?               @relation(fields: [userId], references: [id], onDelete: Cascade)
  sessions              AttendanceSession[]

  @@unique([driverId, date])
  @@unique([staffId, date])
  @@unique([userId, date])
  @@index([date])
  @@index([driverId, date])
  @@index([staffId, date])
  @@index([userId, date], map: "Attendance_userId_date_custom_idx")
}

model AttendanceSession {
  id           String     @id @default(uuid()) @db.Uuid
  attendanceId String     @db.Uuid
  clockIn      DateTime   @default(now())
  clockOut     DateTime?
  notes        String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  Attendance   Attendance @relation(fields: [attendanceId], references: [id], onDelete: Cascade)

  @@index([attendanceId, clockIn])
  @@index([attendanceId, clockOut])
}

model LeaveRequest {
  id              String             @id @default(uuid()) @db.Uuid
  driverId        String?            @db.Uuid
  staffId         String?            @db.Uuid
  userId          String?            @db.Uuid
  startDate       DateTime           @db.Date
  endDate         DateTime           @db.Date
  reason          String
  leaveType       LeaveType
  status          LeaveRequestStatus @default(PENDING)
  requestedBy     String?            @db.Uuid
  approvedBy      String?            @db.Uuid
  approvedAt      DateTime?
  rejectionReason String?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  Driver          Driver?            @relation(fields: [driverId], references: [id], onDelete: Cascade)
  Staff           Staff?             @relation(fields: [staffId], references: [id], onDelete: Cascade)
  User            User?              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([driverId])
  @@index([staffId])
  @@index([userId])
  @@index([status])
  @@index([startDate])
}

model Holiday {
  id          String      @id @default(uuid()) @db.Uuid
  franchiseId String?     @db.Uuid
  name        String
  date        DateTime    @db.Date
  type        HolidayType @default(PUBLIC)
  description String?
  isRecurring Boolean     @default(false)
  createdBy   String      @db.Uuid
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  User        User        @relation(fields: [createdBy], references: [id])
  Franchise   Franchise?  @relation(fields: [franchiseId], references: [id], onDelete: Cascade)

  @@unique([franchiseId, date])
  @@index([date])
  @@index([franchiseId])
}

model WorkingTimeConfig {
  id                 String    @id @default(uuid()) @db.Uuid
  franchiseId        String    @db.Uuid
  roleType           String
  minimumWorkHours   Int       @default(8)
  lunchBreakMinutes  Int       @default(60)
  snackBreakMinutes  Int       @default(15)
  gracePeriodMinutes Int       @default(15)
  isActive           Boolean   @default(true)
  createdBy          String    @db.Uuid
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  User               User      @relation(fields: [createdBy], references: [id])
  Franchise          Franchise @relation(fields: [franchiseId], references: [id], onDelete: Cascade)

  @@unique([franchiseId, roleType])
  @@index([franchiseId])
}

model DriverRating {
  id                 String   @id @default(uuid()) @db.Uuid
  driverId           String   @db.Uuid
  tripId             String?  @db.Uuid
  customerName       String
  customerPhone      String
  customerEmail      String?
  overallRating      Float
  experience         String?
  drivingSafety      Float
  drivingSmoothness  Float
  behaviorPoliteness Float
  isVerified         Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  Driver             Driver   @relation(fields: [driverId], references: [id], onDelete: Cascade)
  Trip               Trip?    @relation(fields: [tripId], references: [id])

  @@index([driverId])
  @@index([tripId])
  @@index([createdAt])
}

model TripReview {
  id            String    @id @default(uuid()) @db.Uuid
  tripId        String    @db.Uuid
  driverId      String    @db.Uuid
  franchiseId   String    @db.Uuid
  customerId    String    @db.Uuid
  tripRating    Int
  overallRating Int
  driverRating  Int
  comment       String
  createdAt     DateTime  @default(now())
  Customer      Customer  @relation(fields: [customerId], references: [id], onDelete: Cascade)
  Driver        Driver    @relation(fields: [driverId], references: [id], onDelete: Cascade)
  Franchise     Franchise @relation(fields: [franchiseId], references: [id], onDelete: Cascade)
  Trip          Trip      @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@index([tripId])
  @@index([driverId])
  @@index([customerId])
  @@index([franchiseId])
}

model ActivityLog {
  id          String             @id @default(uuid()) @db.Uuid
  action      ActivityAction
  entityType  ActivityEntityType
  entityId    String?
  franchiseId String?            @db.Uuid
  driverId    String?            @db.Uuid
  staffId     String?            @db.Uuid
  tripId      String?            @db.Uuid
  userId      String?            @db.Uuid
  description String
  metadata    Json?
  latitude    Float?
  longitude   Float?
  createdAt   DateTime           @default(now())
  Driver      Driver?            @relation(fields: [driverId], references: [id])
  Franchise   Franchise?         @relation(fields: [franchiseId], references: [id])
  Staff       Staff?             @relation(fields: [staffId], references: [id])
  Trip        Trip?              @relation(fields: [tripId], references: [id])
  User        User?              @relation(fields: [userId], references: [id])

  @@index([franchiseId, createdAt])
  @@index([driverId, createdAt])
  @@index([staffId, createdAt])
  @@index([tripId, createdAt])
  @@index([userId, createdAt])
  @@index([entityType, entityId])
  @@index([action, createdAt])
  @@index([createdAt])
}

model Penalty {
  id                 String              @id @default(uuid()) @db.Uuid
  name               String
  description        String?
  amount             Int
  type               PenaltyType         @default(PENALTY)
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  blockDriver        Boolean             @default(false)
  category           PenaltyCategory     @default(OPERATIONAL)
  isAutomatic        Boolean             @default(false)
  notifyAdmin        Boolean             @default(true)
  notifyDriver       Boolean             @default(false)
  notifyManager      Boolean             @default(true)
  severity           PenaltySeverity     @default(MEDIUM)
  triggerConfig      Json?
  triggerType        PenaltyTriggerType  @default(MANUAL)
  DriverTransactions DriverTransaction[]

  @@index([isActive])
  @@index([type])
  @@index([triggerType])
  @@index([category])
  @@index([severity])
}

model DriverDailyMetrics {
  id                  String   @id @default(uuid()) @db.Uuid
  driverId            String   @db.Uuid
  date                DateTime @db.Date
  numberOfTrips       Int      @default(0)
  numberOfComplaints  Int      @default(0)
  distanceTraveled    Decimal  @default(0) @db.Decimal(10, 2)
  tripAverageRating   Float?
  overallRating       Float?
  dailyLimit          Decimal? @db.Decimal(10, 2)
  remainingLimit      Decimal? @db.Decimal(10, 2)
  incentive           Decimal? @db.Decimal(10, 2)
  bonus               Decimal? @db.Decimal(10, 2)
  cashInHand          Decimal  @default(0) @db.Decimal(10, 2)
  cashSubmittedOnDate Decimal  @default(0) @db.Decimal(10, 2)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  Driver              Driver   @relation(fields: [driverId], references: [id], onDelete: Cascade)

  @@unique([driverId, date])
  @@index([driverId, date])
  @@index([date])
}

model TripStatusHistory {
  id          String        @id @default(uuid()) @db.Uuid
  tripId      String        @db.Uuid
  driverId    String?       @db.Uuid
  eventType   TripEventType
  status      TripStatus?
  description String?
  metadata    Json?
  occurredAt  DateTime      @default(now())
  createdBy   String?       @db.Uuid
  User        User?         @relation(fields: [createdBy], references: [id])
  Driver      Driver?       @relation(fields: [driverId], references: [id])
  Trip        Trip          @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@index([tripId, occurredAt])
  @@index([driverId, occurredAt])
  @@index([eventType, occurredAt])
  @@index([occurredAt])
}

model DriverTransaction {
  id              String                @id @default(uuid()) @db.Uuid
  driverId        String                @db.Uuid
  amount          Decimal               @db.Decimal(10, 2)
  transactionType TransactionType
  tripId          String?               @db.Uuid
  type            DriverTransactionType
  description     String?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  appliedBy       String?               @db.Uuid
  metadata        Json?
  penaltyId       String?               @db.Uuid
  AppliedByUser   User?                 @relation("AppliedTransactions", fields: [appliedBy], references: [id])
  Driver          Driver                @relation(fields: [driverId], references: [id], onDelete: Cascade)
  Penalty         Penalty?              @relation(fields: [penaltyId], references: [id])
  Trip            Trip?                 @relation(fields: [tripId], references: [id])

  @@index([driverId, createdAt])
  @@index([transactionType])
  @@index([type])
  @@index([tripId])
  @@index([penaltyId])
  @@index([appliedBy])
}

model DriverMonthlyPerformance {
  id                   String    @id @default(uuid()) @db.Uuid
  driverId             String    @db.Uuid
  franchiseId          String    @db.Uuid
  month                Int
  year                 Int
  totalTrips           Int       @default(0)
  acceptedTrips        Int       @default(0)
  cancelledTrips       Int       @default(0)
  totalDistance        Decimal   @default(0) @db.Decimal(10, 2)
  totalEarnings        Decimal   @default(0) @db.Decimal(14, 2)
  totalIncentive       Decimal   @default(0) @db.Decimal(14, 2)
  totalPenalty         Decimal   @default(0) @db.Decimal(14, 2)
  monthlyDeduction     Decimal   @default(0) @db.Decimal(14, 2)
  avgRating            Float?
  complaintCount       Int       @default(0)
  warningCount         Int       @default(0)
  attendancePercentage Float?
  performanceScore     Float?
  grade                String?
  isFinalized          Boolean   @default(false)
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  Driver               Driver    @relation(fields: [driverId], references: [id], onDelete: Cascade)
  Franchise            Franchise @relation(fields: [franchiseId], references: [id], onDelete: Cascade)

  @@unique([driverId, month, year])
  @@index([franchiseId, month, year])
}

model StaffMonthlyPerformance {
  id                   String    @id @default(uuid()) @db.Uuid
  staffId              String    @db.Uuid
  franchiseId          String    @db.Uuid
  month                Int
  year                 Int
  totalBookingsCreated Int       @default(0)
  totalAssignments     Int       @default(0)
  reassignmentCount    Int       @default(0)
  complaintsHandled    Int       @default(0)
  unresolvedComplaints Int       @default(0)
  attendancePercentage Float?
  warningCount         Int       @default(0)
  performanceScore     Float?
  grade                String?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  Franchise            Franchise @relation(fields: [franchiseId], references: [id], onDelete: Cascade)
  Staff                Staff     @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@unique([staffId, month, year])
  @@index([franchiseId, month, year])
}

model ManagerMonthlyPerformance {
  id                  String    @id @default(uuid()) @db.Uuid
  managerId           String    @db.Uuid
  franchiseId         String    @db.Uuid
  month               Int
  year                Int
  totalRevenue        Decimal   @default(0) @db.Decimal(14, 2)
  totalTrips          Int       @default(0)
  driverRetentionRate Float?
  staffRetentionRate  Float?
  totalComplaints     Int       @default(0)
  resolvedComplaints  Int       @default(0)
  avgDriverRating     Float?
  payrollAccuracy     Float?
  performanceScore    Float?
  grade               String?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  Franchise           Franchise @relation(fields: [franchiseId], references: [id], onDelete: Cascade)
  User                User      @relation(fields: [managerId], references: [id], onDelete: Cascade)

  @@unique([managerId, month, year])
  @@index([franchiseId, month, year])
}

model FranchiseMonthlyPerformance {
  id               String    @id @default(uuid()) @db.Uuid
  franchiseId      String    @db.Uuid
  month            Int
  year             Int
  totalRevenue     Decimal   @default(0) @db.Decimal(14, 2)
  totalTrips       Int       @default(0)
  activeDrivers    Int       @default(0)
  activeStaff      Int       @default(0)
  totalComplaints  Int       @default(0)
  avgRating        Float?
  netProfit        Decimal?  @db.Decimal(14, 2)
  performanceScore Float?
  grade            String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  Franchise        Franchise @relation(fields: [franchiseId], references: [id], onDelete: Cascade)

  @@unique([franchiseId, month, year])
}

model PickupRequest {
  id             String       @id @default(uuid()) @db.Uuid
  originalTripId String       @db.Uuid
  pickupDriverId String?      @db.Uuid
  distanceKm     Decimal?     @db.Decimal(10, 2)
  payoutAmount   Decimal?     @db.Decimal(10, 2)
  status         PickupStatus @default(PENDING)
  createdAt      DateTime     @default(now())
  acceptedAt     DateTime?
  completedAt    DateTime?
  Trip           Trip         @relation(fields: [originalTripId], references: [id], onDelete: Cascade)
  Driver         Driver?      @relation(fields: [pickupDriverId], references: [id])

  @@index([status])
}

model TripReassignment {
  id           String   @id @default(uuid()) @db.Uuid
  tripId       String   @db.Uuid
  oldDriverId  String?
  newDriverId  String?
  reason       String?
  reassignedBy String?  @db.Uuid
  createdAt    DateTime @default(now())
  Trip         Trip     @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@index([tripId])
}

model TripReschedule {
  id            String   @id @default(uuid()) @db.Uuid
  tripId        String   @db.Uuid
  oldDate       DateTime
  newDate       DateTime
  reason        String?
  rescheduledBy String?  @db.Uuid
  createdAt     DateTime @default(now())
  Trip          Trip     @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@index([tripId])
}

model DriverPayroll {
  id               String    @id @default(uuid()) @db.Uuid
  driverId         String    @db.Uuid
  franchiseId      String    @db.Uuid
  month            Int
  year             Int
  totalTrips       Int
  totalEarnings    Decimal   @db.Decimal(14, 2)
  totalIncentives  Decimal   @db.Decimal(14, 2)
  totalPenalties   Decimal   @db.Decimal(14, 2)
  monthlyDeduction Decimal   @db.Decimal(14, 2)
  finalPayout      Decimal   @db.Decimal(14, 2)
  isPaid           Boolean   @default(false)
  paidAt           DateTime?
  createdAt        DateTime  @default(now())
  Driver           Driver    @relation(fields: [driverId], references: [id])
  Franchise        Franchise @relation(fields: [franchiseId], references: [id])

  @@unique([driverId, month, year])
}

model PasswordResetOTP {
  id        String   @id @default(uuid()) @db.Uuid
  email     String
  otp       String
  expiresAt DateTime
  verified  Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([email, expiresAt])
}

enum CarType {
  HATCHBACK
  SEDAN
  SUV
  LUXURY
}

enum Transmission {
  MANUAL
  AUTOMATIC
}

enum CarCategory {
  NORMAL
  PREMIUM
  LUXURY
  SPORTS
}

enum TripOfferStatus {
  OFFERED
  ACCEPTED
  REJECTED
  EXPIRED
  CANCELLED
}

enum TripPricingType {
  DISTANCE
  TIME
  SLAB
}

enum DriverStatus {
  ACTIVE
  INACTIVE
  BLOCKED
  TERMINATED
}

enum DriverEmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
}

enum DriverTripStatus {
  AVAILABLE
  ON_TRIP
}

enum PaymentMode {
  UPI
  IN_HAND
  CASH
  CARD
  OTHER
}

enum PaymentStatus {
  PENDING
  COMPLETED
  PAID
  PARTIALLY_PAID
}

enum RelieveReason {
  RESIGNATION
  TERMINATION
  RETIREMENT
  CONTRACT_ENDED
  PERFORMANCE_ISSUES
  MISCONDUCT
  OTHER
}

enum StaffStatus {
  ACTIVE
  FIRED
  SUSPENDED
  BLOCKED
}

enum TripStatus {
  NOT_ASSIGNED
  ASSIGNED
  TRIP_STARTED
  TRIP_PROGRESS
  TRIP_ENDED
  COMPLETED
  PAYMENT_DONE
  REQUESTED
  DRIVER_ON_THE_WAY
  IN_PROGRESS
  CANCELLED_BY_CUSTOMER
  CANCELLED_BY_OFFICE
  REJECTED_BY_DRIVER
  DRIVER_ACCEPTED
}

enum TripType {
  CITY_ROUND
  CITY_DROPOFF
  LONG_ROUND
  LONG_DROPOFF
}

enum UserRole {
  ADMIN
  MANAGER
  OFFICE_STAFF
  DRIVER
  STAFF
  CUSTOMER
}

enum FranchiseStatus {
  ACTIVE
  BLOCKED
  TEMPORARILY_CLOSED
}

enum ComplaintStatus {
  RECEIVED
  IN_PROCESS
  RESOLVED
}

enum ComplaintPriority {
  LOW
  MEDIUM
  HIGH
}

enum ComplaintResolutionAction {
  WARNING
  FIRE
}

enum WarningPriority {
  LOW
  MEDIUM
  HIGH
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  HALF_DAY
  ON_LEAVE
  PARTIAL
}

enum LeaveType {
  SICK_LEAVE
  CASUAL_LEAVE
  EARNED_LEAVE
  EMERGENCY_LEAVE
  OTHER
}

enum LeaveRequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum HolidayType {
  PUBLIC
  COMPANY
  OPTIONAL
}

enum ActivityAction {
  TRIP_CREATED
  TRIP_ASSIGNED
  TRIP_ACCEPTED
  TRIP_REJECTED
  TRIP_STARTED
  TRIP_ENDED
  TRIP_CANCELLED
  TRIP_STATUS_CHANGED
  TRIP_UPDATED
  DRIVER_CREATED
  DRIVER_UPDATED
  DRIVER_STATUS_CHANGED
  DRIVER_CLOCK_IN
  DRIVER_CLOCK_OUT
  STAFF_CREATED
  STAFF_UPDATED
  STAFF_STATUS_CHANGED
  STAFF_CLOCK_IN
  STAFF_CLOCK_OUT
  COMPLAINT_CREATED
  COMPLAINT_RESOLVED
  COMPLAINT_STATUS_CHANGED
  LEAVE_REQUESTED
  LEAVE_APPROVED
  LEAVE_REJECTED
  LEAVE_CANCELLED
  RATING_SUBMITTED
  ATTENDANCE_RECORDED
  LOGIN
  LOGOUT
  CHECK_IN
  CHECK_OUT
  CUSTOMER_CREATED
  CUSTOMER_UPDATED
  FRANCHISE_CREATED
  FRANCHISE_UPDATED
  FRANCHISE_STATUS_CHANGED
  WARNING_ISSUED
}

enum ActivityEntityType {
  TRIP
  DRIVER
  STAFF
  CUSTOMER
  FRANCHISE
  COMPLAINT
  LEAVE_REQUEST
  RATING
  ATTENDANCE
  OTHER
  USER
}

enum PenaltyType {
  PENALTY
  DEDUCTION
}

enum PenaltyTriggerType {
  MANUAL
  LATE_REPORT
  THREE_COMPLAINTS
  CANCELLED_TRIP
  PHONE_NOT_ANSWERED
  DRESS_CODE_VIOLATION
  CUSTOMER_COMPLAINT
}

enum PenaltyCategory {
  OPERATIONAL
  BEHAVIORAL
  FINANCIAL
  SAFETY
}

enum PenaltySeverity {
  LOW
  MEDIUM
  HIGH
}

enum TripEventType {
  ARRIVED_ON_LOCATION
  TRIP_INITIATED
  TRIP_STARTED
  TRIP_LOCATION_REACHED
  TRIP_DESTINATION_REACHED
  TRIP_END_INITIATED
  TRIP_ENDED
  TRIP_AMOUNT_COLLECTED
  PAYMENT_COLLECTED
  PAYMENT_SUBMITTED_TO_BRANCH
  STATUS_CHANGED
}

enum TransactionType {
  CREDIT
  DEBIT
}

enum DriverTransactionType {
  PENALTY
  TRIP
  GIFT
}

enum PickupStatus {
  PENDING
  ACCEPTED
  COMPLETED
  CANCELLED
}
